[0m21:49:46.966581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000275E0D82510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000275DEBEC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000275E2EE3ED0>]}


============================== 21:49:46.971114 | 00d8590d-a2a7-4c16-a8fa-4c0992b47c1a ==============================
[0m21:49:46.971114 [info ] [MainThread]: Running with dbt=1.10.3
[0m21:49:46.971836 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:49:46.992296 [info ] [MainThread]: dbt version: 1.10.3
[0m21:49:46.993158 [info ] [MainThread]: python version: 3.13.3
[0m21:49:46.993663 [info ] [MainThread]: python path: C:\Users\micha\AppData\Local\Programs\Python\Python313\python.exe
[0m21:49:46.994153 [info ] [MainThread]: os info: Windows-11-10.0.26100-SP0
[0m21:49:49.963844 [info ] [MainThread]: Using profiles dir at C:\Users\micha\.dbt
[0m21:49:49.964391 [info ] [MainThread]: Using profiles.yml file at C:\Users\micha\.dbt\profiles.yml
[0m21:49:49.964677 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\dbt_project.yml
[0m21:49:49.965012 [info ] [MainThread]: adapter type: bigquery
[0m21:49:49.965528 [info ] [MainThread]: adapter version: 1.9.2
[0m21:49:50.056800 [info ] [MainThread]: Configuration:
[0m21:49:50.057457 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:49:50.057768 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:49:50.058064 [info ] [MainThread]: Required dependencies:
[0m21:49:50.058385 [debug] [MainThread]: Executing "git --help"
[0m21:49:50.065235 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m21:49:50.065754 [info ] [MainThread]: Connection:
[0m21:49:50.066162 [info ] [MainThread]:   method: service-account
[0m21:49:50.066483 [info ] [MainThread]:   database: astrafy-464919
[0m21:49:50.066744 [info ] [MainThread]:   execution_project: astrafy-464919
[0m21:49:50.067048 [info ] [MainThread]:   schema: raw
[0m21:49:50.067373 [info ] [MainThread]:   location: EU
[0m21:49:50.067638 [info ] [MainThread]:   priority: interactive
[0m21:49:50.067871 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:49:50.068185 [info ] [MainThread]:   impersonate_service_account: None
[0m21:49:50.068508 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:49:50.068832 [info ] [MainThread]:   job_retries: 1
[0m21:49:50.069106 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:49:50.069374 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m21:49:50.069615 [info ] [MainThread]:   timeout_seconds: 300
[0m21:49:50.069864 [info ] [MainThread]:   client_id: None
[0m21:49:50.070094 [info ] [MainThread]:   token_uri: None
[0m21:49:50.070321 [info ] [MainThread]:   compute_region: None
[0m21:49:50.070549 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:49:50.070868 [info ] [MainThread]:   gcs_bucket: None
[0m21:49:50.071121 [info ] [MainThread]:   dataproc_batch: None
[0m21:49:50.071998 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m21:49:50.582401 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:49:50.582867 [debug] [MainThread]: On debug: select 1 as id
[0m21:49:50.583152 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:49:51.158282 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:c7d7cd0e-5064-4c56-adef-d1d70dd0568e&page=queryresults
[0m21:49:51.485845 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:49:51.486507 [info ] [MainThread]: [31m1 check failed:[0m
[0m21:49:51.487203 [info ] [MainThread]: Error from git --help: Could not find command, ensure it is in the user's PATH and that the user has permissions to run it: "git"

[0m21:49:51.488130 [debug] [MainThread]: Command `dbt debug` failed at 21:49:51.488028 after 4.64 seconds
[0m21:49:51.488376 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:49:51.488634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002758F1F1CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002758F221250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002758F0CC490>]}
[0m21:49:51.488922 [debug] [MainThread]: Flushing usage events
[0m21:49:51.902352 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:51:51.275192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000284892D2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002848712C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002848B423ED0>]}


============================== 21:51:51.279457 | c35fe82b-0af0-4082-9b4d-af828c39a79e ==============================
[0m21:51:51.279457 [info ] [MainThread]: Running with dbt=1.10.3
[0m21:51:51.280053 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:51:51.298254 [info ] [MainThread]: dbt version: 1.10.3
[0m21:51:51.298772 [info ] [MainThread]: python version: 3.13.3
[0m21:51:51.299079 [info ] [MainThread]: python path: C:\Users\micha\AppData\Local\Programs\Python\Python313\python.exe
[0m21:51:51.299405 [info ] [MainThread]: os info: Windows-11-10.0.26100-SP0
[0m21:51:53.948036 [info ] [MainThread]: Using profiles dir at C:\Users\micha\.dbt
[0m21:51:53.948689 [info ] [MainThread]: Using profiles.yml file at C:\Users\micha\.dbt\profiles.yml
[0m21:51:53.949144 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\dbt_project.yml
[0m21:51:53.949577 [info ] [MainThread]: adapter type: bigquery
[0m21:51:53.949872 [info ] [MainThread]: adapter version: 1.9.2
[0m21:51:54.034629 [info ] [MainThread]: Configuration:
[0m21:51:54.035434 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:51:54.036017 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:51:54.036690 [info ] [MainThread]: Required dependencies:
[0m21:51:54.037190 [debug] [MainThread]: Executing "git --help"
[0m21:51:54.042636 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m21:51:54.043233 [info ] [MainThread]: Connection:
[0m21:51:54.043657 [info ] [MainThread]:   method: service-account
[0m21:51:54.044053 [info ] [MainThread]:   database: astrafy-464919
[0m21:51:54.044326 [info ] [MainThread]:   execution_project: astrafy-464919
[0m21:51:54.044638 [info ] [MainThread]:   schema: raw
[0m21:51:54.044869 [info ] [MainThread]:   location: EU
[0m21:51:54.045225 [info ] [MainThread]:   priority: interactive
[0m21:51:54.045600 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:51:54.045892 [info ] [MainThread]:   impersonate_service_account: None
[0m21:51:54.046279 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:51:54.046714 [info ] [MainThread]:   job_retries: 1
[0m21:51:54.047140 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:51:54.047491 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m21:51:54.047737 [info ] [MainThread]:   timeout_seconds: 300
[0m21:51:54.047959 [info ] [MainThread]:   client_id: None
[0m21:51:54.048188 [info ] [MainThread]:   token_uri: None
[0m21:51:54.048428 [info ] [MainThread]:   compute_region: None
[0m21:51:54.048649 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:51:54.048963 [info ] [MainThread]:   gcs_bucket: None
[0m21:51:54.049353 [info ] [MainThread]:   dataproc_batch: None
[0m21:51:54.049932 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m21:51:54.522760 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:51:54.523129 [debug] [MainThread]: On debug: select 1 as id
[0m21:51:54.523411 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:51:55.107761 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:3529cf3b-c6a1-4052-8b10-bfe5e5b9ed94&page=queryresults
[0m21:51:55.444332 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:51:55.445029 [info ] [MainThread]: [31m1 check failed:[0m
[0m21:51:55.445552 [info ] [MainThread]: Error from git --help: Could not find command, ensure it is in the user's PATH and that the user has permissions to run it: "git"

[0m21:51:55.446477 [debug] [MainThread]: Command `dbt debug` failed at 21:51:55.446376 after 4.31 seconds
[0m21:51:55.446725 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:51:55.446957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000284B7021F30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000284B7051250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000284B6EFC490>]}
[0m21:51:55.447233 [debug] [MainThread]: Flushing usage events
[0m21:51:55.880517 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:54:41.899643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001840F632510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001840D48C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018411783ED0>]}


============================== 21:54:41.904800 | d5a954f3-2d5f-40d6-9b88-ed1ec2bc58fa ==============================
[0m21:54:41.904800 [info ] [MainThread]: Running with dbt=1.10.3
[0m21:54:41.905383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:54:41.923698 [info ] [MainThread]: dbt version: 1.10.3
[0m21:54:41.924203 [info ] [MainThread]: python version: 3.13.3
[0m21:54:41.924546 [info ] [MainThread]: python path: C:\Users\micha\AppData\Local\Programs\Python\Python313\python.exe
[0m21:54:41.924860 [info ] [MainThread]: os info: Windows-11-10.0.26100-SP0
[0m21:54:44.597512 [info ] [MainThread]: Using profiles dir at C:\Users\micha\.dbt
[0m21:54:44.598319 [info ] [MainThread]: Using profiles.yml file at C:\Users\micha\.dbt\profiles.yml
[0m21:54:44.598688 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\dbt_project.yml
[0m21:54:44.599008 [info ] [MainThread]: adapter type: bigquery
[0m21:54:44.599283 [info ] [MainThread]: adapter version: 1.9.2
[0m21:54:44.686262 [info ] [MainThread]: Configuration:
[0m21:54:44.687193 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:54:44.687930 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:54:44.688309 [info ] [MainThread]: Required dependencies:
[0m21:54:44.688696 [debug] [MainThread]: Executing "git --help"
[0m21:54:44.722473 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:54:44.722937 [debug] [MainThread]: STDERR: "b''"
[0m21:54:44.723315 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:54:44.723663 [info ] [MainThread]: Connection:
[0m21:54:44.723962 [info ] [MainThread]:   method: service-account
[0m21:54:44.724252 [info ] [MainThread]:   database: astrafy-464919
[0m21:54:44.724544 [info ] [MainThread]:   execution_project: astrafy-464919
[0m21:54:44.724794 [info ] [MainThread]:   schema: raw
[0m21:54:44.725045 [info ] [MainThread]:   location: EU
[0m21:54:44.725386 [info ] [MainThread]:   priority: interactive
[0m21:54:44.725694 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:54:44.725964 [info ] [MainThread]:   impersonate_service_account: None
[0m21:54:44.726308 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:54:44.726622 [info ] [MainThread]:   job_retries: 1
[0m21:54:44.726893 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:54:44.727168 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m21:54:44.727432 [info ] [MainThread]:   timeout_seconds: 300
[0m21:54:44.727683 [info ] [MainThread]:   client_id: None
[0m21:54:44.727966 [info ] [MainThread]:   token_uri: None
[0m21:54:44.728272 [info ] [MainThread]:   compute_region: None
[0m21:54:44.728604 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:54:44.728953 [info ] [MainThread]:   gcs_bucket: None
[0m21:54:44.729305 [info ] [MainThread]:   dataproc_batch: None
[0m21:54:44.729906 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m21:54:45.209742 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:54:45.210090 [debug] [MainThread]: On debug: select 1 as id
[0m21:54:45.210335 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:54:45.783577 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:88c4f184-e4bd-417a-82e1-cd83a800ab90&page=queryresults
[0m21:54:46.143774 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:54:46.144488 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:54:46.145634 [debug] [MainThread]: Command `dbt debug` succeeded at 21:54:46.145507 after 4.37 seconds
[0m21:54:46.145889 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:54:46.146155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001843D390E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001843D3C1130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001843D26C490>]}
[0m21:54:46.146455 [debug] [MainThread]: Flushing usage events
[0m21:54:46.602529 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:55:24.560563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A124D2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A1032C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A14623ED0>]}


============================== 10:55:24.566224 | db28a7e4-e6da-4291-b404-3456c4221bda ==============================
[0m10:55:24.566224 [info ] [MainThread]: Running with dbt=1.10.3
[0m10:55:24.566763 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:55:24.596400 [info ] [MainThread]: dbt version: 1.10.3
[0m10:55:24.597104 [info ] [MainThread]: python version: 3.13.3
[0m10:55:24.597655 [info ] [MainThread]: python path: C:\Users\micha\AppData\Local\Programs\Python\Python313\python.exe
[0m10:55:24.597979 [info ] [MainThread]: os info: Windows-11-10.0.26100-SP0
[0m10:55:30.338383 [info ] [MainThread]: Using profiles dir at C:\Users\micha\.dbt
[0m10:55:30.339036 [info ] [MainThread]: Using profiles.yml file at C:\Users\micha\.dbt\profiles.yml
[0m10:55:30.339500 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\dbt_project.yml
[0m10:55:30.339833 [info ] [MainThread]: adapter type: bigquery
[0m10:55:30.340129 [info ] [MainThread]: adapter version: 1.9.2
[0m10:55:30.432236 [info ] [MainThread]: Configuration:
[0m10:55:30.432814 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:55:30.433172 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:55:30.433442 [info ] [MainThread]: Required dependencies:
[0m10:55:30.433767 [debug] [MainThread]: Executing "git --help"
[0m10:55:30.466565 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:55:30.467063 [debug] [MainThread]: STDERR: "b''"
[0m10:55:30.467468 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:55:30.467931 [info ] [MainThread]: Connection:
[0m10:55:30.468264 [info ] [MainThread]:   method: service-account
[0m10:55:30.468555 [info ] [MainThread]:   database: astrafy-464919
[0m10:55:30.468798 [info ] [MainThread]:   execution_project: astrafy-464919
[0m10:55:30.469038 [info ] [MainThread]:   schema: raw
[0m10:55:30.469265 [info ] [MainThread]:   location: EU
[0m10:55:30.469528 [info ] [MainThread]:   priority: interactive
[0m10:55:30.469959 [info ] [MainThread]:   maximum_bytes_billed: None
[0m10:55:30.470586 [info ] [MainThread]:   impersonate_service_account: None
[0m10:55:30.470896 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m10:55:30.471189 [info ] [MainThread]:   job_retries: 1
[0m10:55:30.471449 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m10:55:30.471682 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m10:55:30.471920 [info ] [MainThread]:   timeout_seconds: 300
[0m10:55:30.472145 [info ] [MainThread]:   client_id: None
[0m10:55:30.472374 [info ] [MainThread]:   token_uri: None
[0m10:55:30.472600 [info ] [MainThread]:   compute_region: None
[0m10:55:30.472818 [info ] [MainThread]:   dataproc_cluster_name: None
[0m10:55:30.473140 [info ] [MainThread]:   gcs_bucket: None
[0m10:55:30.473460 [info ] [MainThread]:   dataproc_batch: None
[0m10:55:30.474015 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m10:55:31.046151 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m10:55:31.046687 [debug] [MainThread]: On debug: select 1 as id
[0m10:55:31.047031 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:55:31.691293 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:92da4453-85ef-4f2b-9e8a-1d89341ef954&page=queryresults
[0m10:55:34.239413 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:55:34.240215 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:55:34.241333 [debug] [MainThread]: Command `dbt debug` succeeded at 10:55:34.241222 after 9.83 seconds
[0m10:55:34.241574 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:55:34.241831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A40280E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A402B1130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026A4015C490>]}
[0m10:55:34.242136 [debug] [MainThread]: Flushing usage events
[0m10:55:34.679164 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:57:04.227536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016819B62510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000168179CC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001681BCD3ED0>]}


============================== 10:57:04.231907 | c21b6436-c454-48e5-89d0-5e3285631cc2 ==============================
[0m10:57:04.231907 [info ] [MainThread]: Running with dbt=1.10.3
[0m10:57:04.232478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:57:07.139547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001681A049A70>]}
[0m10:57:07.189050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000168476D97B0>]}
[0m10:57:07.189780 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m10:57:07.700128 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m10:57:07.701110 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:57:07.701636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000168476A2550>]}
[0m10:57:09.602088 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m10:57:09.603784 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m10:57:09.703140 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.unique_my_first_dbt_model_id.16e066b321' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m10:57:09.703950 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.not_null_my_first_dbt_model_id.5fb22c2710' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m10:57:09.704424 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.unique_my_second_dbt_model_id.57a0f8c493' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m10:57:09.704842 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.not_null_my_second_dbt_model_id.151b76d778' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m10:57:09.768771 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.example
[0m10:57:09.772871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016847BD3B60>]}
[0m10:57:09.830738 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m10:57:09.844749 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m10:57:09.870839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016847CE42F0>]}
[0m10:57:09.871253 [info ] [MainThread]: Found 1 model, 493 macros
[0m10:57:09.871691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001684786CFC0>]}
[0m10:57:09.873904 [info ] [MainThread]: 
[0m10:57:09.874293 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:57:09.874611 [info ] [MainThread]: 
[0m10:57:09.875095 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:57:09.876269 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m10:57:09.876782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:10.214225 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m10:57:10.214723 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:10.498008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016847DE8D10>]}
[0m10:57:10.498418 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:57:10.504484 [debug] [Thread-1 (]: Began running node model.astrafy_project.model_test
[0m10:57:10.504940 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.model_test ..................................... [RUN]
[0m10:57:10.505742 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.model_test'
[0m10:57:10.506184 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.model_test
[0m10:57:10.511041 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.model_test"
[0m10:57:10.513139 [debug] [Thread-1 (]: Began executing node model.astrafy_project.model_test
[0m10:57:10.538200 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.model_test"
[0m10:57:10.540165 [debug] [Thread-1 (]: On model.astrafy_project.model_test: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.model_test"} */


  create or replace view `astrafy-464919`.`raw`.`model_test`
  OPTIONS()
  as select 1 as id;


[0m10:57:10.540614 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:57:10.922200 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:55352296-c757-4c82-9118-057e52fd762e&page=queryresults
[0m10:57:10.923570 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:EU:55352296-c757-4c82-9118-057e52fd762e&page=queryresults
[0m10:57:11.048217 [debug] [Thread-1 (]: Database Error in model model_test (models\model_test.sql)
  Not found: Dataset astrafy-464919:raw was not found in location EU
  compiled code at target\run\astrafy_project\models\model_test.sql
[0m10:57:11.050186 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c21b6436-c454-48e5-89d0-5e3285631cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016848009180>]}
[0m10:57:11.050777 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.model_test ............................ [[31mERROR[0m in 0.54s]
[0m10:57:11.051519 [debug] [Thread-1 (]: Finished running node model.astrafy_project.model_test
[0m10:57:11.052142 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.model_test' to be skipped because of status 'error'.  Reason: Database Error in model model_test (models\model_test.sql)
  Not found: Dataset astrafy-464919:raw was not found in location EU
  compiled code at target\run\astrafy_project\models\model_test.sql.
[0m10:57:11.053904 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:57:11.055154 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:57:11.055376 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m10:57:11.055579 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m10:57:11.055757 [debug] [MainThread]: Connection 'model.astrafy_project.model_test' was properly closed.
[0m10:57:11.055954 [info ] [MainThread]: 
[0m10:57:11.056484 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m10:57:11.057429 [debug] [MainThread]: Command end result
[0m10:57:11.255255 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m10:57:11.257127 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m10:57:11.261932 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m10:57:11.262297 [info ] [MainThread]: 
[0m10:57:11.262786 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m10:57:11.263266 [info ] [MainThread]: 
[0m10:57:11.263841 [error] [MainThread]: [31mFailure in model model_test (models\model_test.sql)[0m
[0m10:57:11.264410 [error] [MainThread]:   Database Error in model model_test (models\model_test.sql)
  Not found: Dataset astrafy-464919:raw was not found in location EU
  compiled code at target\run\astrafy_project\models\model_test.sql
[0m10:57:11.264840 [info ] [MainThread]: 
[0m10:57:11.265223 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\model_test.sql
[0m10:57:11.265532 [info ] [MainThread]: 
[0m10:57:11.265992 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m10:57:11.267028 [debug] [MainThread]: Command `dbt run` failed at 10:57:11.266925 after 7.16 seconds
[0m10:57:11.267337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016847EBC5F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001681A5F24E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016847DC0DD0>]}
[0m10:57:11.267637 [debug] [MainThread]: Flushing usage events
[0m10:57:11.650294 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:59:06.966644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ED8BE62510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ED89CCC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ED8DFC3ED0>]}


============================== 10:59:06.970619 | e01e753d-b709-411c-a43d-801c59449eed ==============================
[0m10:59:06.970619 [info ] [MainThread]: Running with dbt=1.10.3
[0m10:59:06.971213 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:59:09.652865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ED8C34DA70>]}
[0m10:59:09.705302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDB99D97B0>]}
[0m10:59:09.706038 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m10:59:10.167264 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m10:59:10.247344 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:59:10.248039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDB99A3250>]}
[0m10:59:11.054988 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_first_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m10:59:11.056604 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'my_second_dbt_model' in the 'models' section of file 'models\example\schema.yml'
[0m10:59:11.134120 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.unique_my_first_dbt_model_id.16e066b321' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m10:59:11.134832 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.not_null_my_first_dbt_model_id.5fb22c2710' (models\example\schema.yml) depends on a node named 'my_first_dbt_model' in package '' which was not found
[0m10:59:11.135303 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.unique_my_second_dbt_model_id.57a0f8c493' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m10:59:11.135816 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.astrafy_project.not_null_my_second_dbt_model_id.151b76d778' (models\example\schema.yml) depends on a node named 'my_second_dbt_model' in package '' which was not found
[0m10:59:11.201602 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.example
[0m10:59:11.206022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDB9F79E50>]}
[0m10:59:11.258999 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m10:59:11.261484 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m10:59:11.287297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA22DD30>]}
[0m10:59:11.287886 [info ] [MainThread]: Found 1 model, 493 macros
[0m10:59:11.288379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA273EE0>]}
[0m10:59:11.289773 [info ] [MainThread]: 
[0m10:59:11.290275 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:59:11.290779 [info ] [MainThread]: 
[0m10:59:11.291637 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:59:11.293239 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m10:59:11.293594 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:11.625644 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m10:59:11.626437 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:11.893958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA229A90>]}
[0m10:59:11.894404 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:59:11.900330 [debug] [Thread-1 (]: Began running node model.astrafy_project.model_test
[0m10:59:11.900990 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.model_test ..................................... [RUN]
[0m10:59:11.901664 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.model_test'
[0m10:59:11.901991 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.model_test
[0m10:59:11.908197 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.model_test"
[0m10:59:11.908969 [debug] [Thread-1 (]: Began executing node model.astrafy_project.model_test
[0m10:59:11.941056 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.model_test"
[0m10:59:11.942428 [debug] [Thread-1 (]: On model.astrafy_project.model_test: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.model_test"} */


  create or replace view `astrafy-464919`.`raw`.`model_test`
  OPTIONS()
  as select 1 as id;


[0m10:59:11.943166 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:59:12.674318 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:959fa651-cf94-457b-bce9-7e63f6507926&page=queryresults
[0m10:59:12.973233 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e01e753d-b709-411c-a43d-801c59449eed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA2BA8E0>]}
[0m10:59:12.973832 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.model_test ................................ [[32mCREATE VIEW (0 processed)[0m in 1.07s]
[0m10:59:12.974604 [debug] [Thread-1 (]: Finished running node model.astrafy_project.model_test
[0m10:59:12.975797 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:59:12.977067 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:12.977287 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m10:59:12.977489 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m10:59:12.977671 [debug] [MainThread]: Connection 'model.astrafy_project.model_test' was properly closed.
[0m10:59:12.977868 [info ] [MainThread]: 
[0m10:59:12.978322 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m10:59:12.979068 [debug] [MainThread]: Command end result
[0m10:59:12.995643 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m10:59:12.998033 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m10:59:13.003141 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m10:59:13.003484 [info ] [MainThread]: 
[0m10:59:13.004134 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:59:13.004829 [info ] [MainThread]: 
[0m10:59:13.005508 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m10:59:13.006559 [debug] [MainThread]: Command `dbt run` succeeded at 10:59:13.006460 after 6.16 seconds
[0m10:59:13.006853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA068D70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA74D880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002EDBA265550>]}
[0m10:59:13.007136 [debug] [MainThread]: Flushing usage events
[0m10:59:13.467547 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:01:52.612659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7D6D62510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7D4BCC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7D8EC3ED0>]}


============================== 11:01:52.617030 | 49596bf4-4d67-45c2-a0de-dd0ff7e94029 ==============================
[0m11:01:52.617030 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:01:52.617636 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:01:55.370123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7D7249A70>]}
[0m11:01:55.420543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7849397B0>]}
[0m11:01:55.421243 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:01:55.886607 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:01:56.025353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:01:56.026024 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\model_test.sql
[0m11:01:56.233916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E784E05E50>]}
[0m11:01:56.285660 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:01:56.287993 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:01:56.311527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7849223F0>]}
[0m11:01:56.312012 [info ] [MainThread]: Found 1 model, 493 macros
[0m11:01:56.312423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E78509D7F0>]}
[0m11:01:56.313940 [info ] [MainThread]: 
[0m11:01:56.314385 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:01:56.314731 [info ] [MainThread]: 
[0m11:01:56.315206 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:01:56.316975 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:01:56.317458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:01:56.649086 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:01:56.650377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:01:56.872827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E785083EE0>]}
[0m11:01:56.874321 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:01:56.883591 [debug] [Thread-1 (]: Began running node model.astrafy_project.model_test
[0m11:01:56.884228 [info ] [Thread-1 (]: 1 of 1 START sql table model raw.model_test .................................... [RUN]
[0m11:01:56.885331 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.model_test'
[0m11:01:56.885797 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.model_test
[0m11:01:56.892292 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.model_test"
[0m11:01:56.893389 [debug] [Thread-1 (]: Began executing node model.astrafy_project.model_test
[0m11:01:56.904485 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:01:57.219513 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.model_test"
[0m11:01:57.220565 [debug] [Thread-1 (]: On model.astrafy_project.model_test: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.model_test"} */

  
    

    create or replace table `astrafy-464919`.`raw`.`model_test`
      
    
    

    OPTIONS()
    as (
      

select 1 as id
    );
  
[0m11:01:57.657740 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:651c612f-5e1d-4085-9340-a75734752cc3&page=queryresults
[0m11:01:58.955834 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49596bf4-4d67-45c2-a0de-dd0ff7e94029', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E78503B290>]}
[0m11:01:58.956525 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw.model_test ............................... [[32mCREATE TABLE (1.0 rows, 0 processed)[0m in 2.07s]
[0m11:01:58.957288 [debug] [Thread-1 (]: Finished running node model.astrafy_project.model_test
[0m11:01:58.958819 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:01:58.960308 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:01:58.960563 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:01:58.960785 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:01:58.960976 [debug] [MainThread]: Connection 'model.astrafy_project.model_test' was properly closed.
[0m11:01:58.961215 [info ] [MainThread]: 
[0m11:01:58.961574 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.65 seconds (2.65s).
[0m11:01:58.962281 [debug] [MainThread]: Command end result
[0m11:01:58.979434 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:01:58.982466 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:01:58.987885 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:01:58.988241 [info ] [MainThread]: 
[0m11:01:58.988762 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:01:58.989230 [info ] [MainThread]: 
[0m11:01:58.989605 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:01:58.990630 [debug] [MainThread]: Command `dbt run` succeeded at 11:01:58.990504 after 6.50 seconds
[0m11:01:58.990957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7850AC050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E785116030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E785115590>]}
[0m11:01:58.991235 [debug] [MainThread]: Flushing usage events
[0m11:01:59.453461 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:15:56.093272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3D87A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3D65FC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3D9933ED0>]}


============================== 11:15:56.097188 | d552f1cb-3d94-483a-b6a8-3cdbdbc91057 ==============================
[0m11:15:56.097188 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:15:56.097782 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:15:58.868102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3D8C89A70>]}
[0m11:15:58.918063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3864097B0>]}
[0m11:15:58.918746 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:15:59.384200 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:15:59.528307 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 2 files added, 0 files changed.
[0m11:15:59.528793 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\staging\stg_orders.sql
[0m11:15:59.529108 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\staging\sources.yml
[0m11:15:59.529363 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\model_test.sql
[0m11:15:59.830750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3868D3050>]}
[0m11:15:59.892415 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:15:59.894949 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:15:59.919021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3863F23F0>]}
[0m11:15:59.919449 [info ] [MainThread]: Found 1 model, 2 sources, 493 macros
[0m11:15:59.919889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3865582F0>]}
[0m11:15:59.921793 [info ] [MainThread]: 
[0m11:15:59.922169 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:15:59.922482 [info ] [MainThread]: 
[0m11:15:59.922983 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:15:59.924104 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:15:59.924521 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:16:00.257429 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:16:00.258157 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:16:00.482596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F386CF3EE0>]}
[0m11:16:00.483587 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:16:00.495230 [debug] [Thread-1 (]: Began running node model.astrafy_project.stg_orders
[0m11:16:00.495760 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.stg_orders ..................................... [RUN]
[0m11:16:00.496649 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.stg_orders'
[0m11:16:00.496971 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.stg_orders
[0m11:16:00.502865 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.stg_orders"
[0m11:16:00.504308 [debug] [Thread-1 (]: Began executing node model.astrafy_project.stg_orders
[0m11:16:00.529869 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.stg_orders"
[0m11:16:00.531225 [debug] [Thread-1 (]: On model.astrafy_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.stg_orders"} */


  create or replace view `astrafy-464919`.`raw`.`stg_orders`
  OPTIONS()
  as select *
from `astrafy-464919`.`raw`.`orders_recrutement`;


[0m11:16:00.531631 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:16:00.961872 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:af0210e0-d2a8-4434-a85d-00f28a1b8f06&page=queryresults
[0m11:16:01.350080 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd552f1cb-3d94-483a-b6a8-3cdbdbc91057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F386C93D10>]}
[0m11:16:01.350976 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.stg_orders ................................ [[32mCREATE VIEW (0 processed)[0m in 0.85s]
[0m11:16:01.351675 [debug] [Thread-1 (]: Finished running node model.astrafy_project.stg_orders
[0m11:16:01.353035 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:16:01.354805 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:16:01.355069 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:16:01.355273 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:16:01.355467 [debug] [MainThread]: Connection 'model.astrafy_project.stg_orders' was properly closed.
[0m11:16:01.355722 [info ] [MainThread]: 
[0m11:16:01.356187 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.43 seconds (1.43s).
[0m11:16:01.356851 [debug] [MainThread]: Command end result
[0m11:16:01.374094 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:16:01.376323 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:16:01.381575 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:16:01.382009 [info ] [MainThread]: 
[0m11:16:01.382869 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:16:01.383571 [info ] [MainThread]: 
[0m11:16:01.383959 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:16:01.385080 [debug] [MainThread]: Command `dbt run` succeeded at 11:16:01.384950 after 5.42 seconds
[0m11:16:01.385397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F386B7FEE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F3D6247890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F386B5D630>]}
[0m11:16:01.385684 [debug] [MainThread]: Flushing usage events
[0m11:16:01.810006 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:53:28.665868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7879E2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D78584C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D789B43ED0>]}


============================== 11:53:28.670671 | ba42f99c-9b95-47f3-a246-f0e275a73a5a ==============================
[0m11:53:28.670671 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:53:28.671318 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:53:31.540273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D787ECDA70>]}
[0m11:53:31.595265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B55497B0>]}
[0m11:53:31.596133 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:53:32.099252 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:53:32.256341 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 2 files added, 0 files changed.
[0m11:53:32.256933 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\total_orders_2023.sql
[0m11:53:32.257301 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\sources.yml
[0m11:53:32.257601 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\staging\stg_orders.sql
[0m11:53:32.575334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5A17250>]}
[0m11:53:32.641553 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:53:32.644161 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:53:32.670675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B55323F0>]}
[0m11:53:32.671221 [info ] [MainThread]: Found 1 model, 2 sources, 493 macros
[0m11:53:32.671745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B55F1D30>]}
[0m11:53:32.673975 [info ] [MainThread]: 
[0m11:53:32.674431 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:53:32.674829 [info ] [MainThread]: 
[0m11:53:32.675471 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:53:32.676651 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:53:32.677053 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:53:33.090098 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:53:33.090543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:53:33.322137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5E3BEE0>]}
[0m11:53:33.322643 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:53:33.328288 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m11:53:33.328900 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m11:53:33.329718 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.total_orders_2023'
[0m11:53:33.330087 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m11:53:33.335808 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m11:53:33.337026 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m11:53:33.362984 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m11:53:33.364399 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where year( order_date) = 2023;


[0m11:53:33.364796 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:53:33.803581 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9fc061d3-32ef-48b0-875c-91344a5b5747&page=queryresults
[0m11:53:33.941853 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9fc061d3-32ef-48b0-875c-91344a5b5747&page=queryresults
[0m11:53:33.949786 [debug] [Thread-1 (]: Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Function not found: year at [12:7]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql
[0m11:53:33.951919 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba42f99c-9b95-47f3-a246-f0e275a73a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5E06BD0>]}
[0m11:53:33.952505 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.total_orders_2023 ..................... [[31mERROR[0m in 0.62s]
[0m11:53:33.953182 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m11:53:33.953649 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.total_orders_2023' to be skipped because of status 'error'.  Reason: Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Function not found: year at [12:7]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql.
[0m11:53:33.955427 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:53:33.956771 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:53:33.957067 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:53:33.957264 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:53:33.957458 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m11:53:33.957676 [info ] [MainThread]: 
[0m11:53:33.958288 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m11:53:33.959186 [debug] [MainThread]: Command end result
[0m11:53:33.975645 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:53:33.978568 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:53:33.983635 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:53:33.983966 [info ] [MainThread]: 
[0m11:53:33.984520 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:53:33.985126 [info ] [MainThread]: 
[0m11:53:33.985614 [error] [MainThread]: [31mFailure in model total_orders_2023 (models\marts\total_orders_2023.sql)[0m
[0m11:53:33.985969 [error] [MainThread]:   Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Function not found: year at [12:7]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql
[0m11:53:33.986234 [info ] [MainThread]: 
[0m11:53:33.986532 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\total_orders_2023.sql
[0m11:53:33.986790 [info ] [MainThread]: 
[0m11:53:33.987475 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:53:33.988478 [debug] [MainThread]: Command `dbt run` failed at 11:53:33.988361 after 5.44 seconds
[0m11:53:33.989098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5DBA0A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5C8C230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D7B5C8C4B0>]}
[0m11:53:33.989452 [debug] [MainThread]: Flushing usage events
[0m11:53:34.434783 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:54:07.403728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1AC842510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1AA6EC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1AE99FED0>]}


============================== 11:54:07.408151 | 24c020c3-6f6e-4723-8d11-3394c3704695 ==============================
[0m11:54:07.408151 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:54:07.408754 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:54:10.170989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1ACD2DA70>]}
[0m11:54:10.224498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DA3B97B0>]}
[0m11:54:10.225386 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:54:10.713710 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:54:10.872998 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:54:10.873594 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\total_orders_2023.sql
[0m11:54:11.130650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DA856150>]}
[0m11:54:11.198964 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:54:11.201634 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:54:11.228357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DA3A23F0>]}
[0m11:54:11.228789 [info ] [MainThread]: Found 1 model, 2 sources, 493 macros
[0m11:54:11.229270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DAB61550>]}
[0m11:54:11.230670 [info ] [MainThread]: 
[0m11:54:11.231150 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:54:11.231607 [info ] [MainThread]: 
[0m11:54:11.232097 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:54:11.233034 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:54:11.233386 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:54:11.596533 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:54:11.597173 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:54:11.834472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DAB0FEE0>]}
[0m11:54:11.834906 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:54:11.839631 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m11:54:11.840149 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m11:54:11.841171 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.total_orders_2023'
[0m11:54:11.841635 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m11:54:11.847712 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m11:54:11.848632 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m11:54:11.874523 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m11:54:11.875792 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from order_date) = 2023;


[0m11:54:11.876269 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:54:12.302852 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:69fa92ab-aee9-4536-921b-0d4e7d1d1fd6&page=queryresults
[0m11:54:12.435527 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:69fa92ab-aee9-4536-921b-0d4e7d1d1fd6&page=queryresults
[0m11:54:12.445432 [debug] [Thread-1 (]: Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:25]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql
[0m11:54:12.447946 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24c020c3-6f6e-4723-8d11-3394c3704695', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DAAE6ED0>]}
[0m11:54:12.448823 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.total_orders_2023 ..................... [[31mERROR[0m in 0.61s]
[0m11:54:12.449990 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m11:54:12.450927 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.total_orders_2023' to be skipped because of status 'error'.  Reason: Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:25]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql.
[0m11:54:12.453651 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:54:12.456231 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:54:12.456950 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:54:12.457209 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:54:12.457483 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m11:54:12.457830 [info ] [MainThread]: 
[0m11:54:12.458447 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m11:54:12.459456 [debug] [MainThread]: Command end result
[0m11:54:12.487479 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:54:12.491472 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:54:12.498003 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:54:12.498563 [info ] [MainThread]: 
[0m11:54:12.499207 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:54:12.499684 [info ] [MainThread]: 
[0m11:54:12.500232 [error] [MainThread]: [31mFailure in model total_orders_2023 (models\marts\total_orders_2023.sql)[0m
[0m11:54:12.500769 [error] [MainThread]:   Database Error in model total_orders_2023 (models\marts\total_orders_2023.sql)
  Unrecognized name: order_date; Did you mean date_date? at [12:25]
  compiled code at target\run\astrafy_project\models\marts\total_orders_2023.sql
[0m11:54:12.501142 [info ] [MainThread]: 
[0m11:54:12.501828 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\total_orders_2023.sql
[0m11:54:12.502297 [info ] [MainThread]: 
[0m11:54:12.502781 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:54:12.504173 [debug] [MainThread]: Command `dbt run` failed at 11:54:12.504005 after 5.21 seconds
[0m11:54:12.504694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DAA9F800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DA5B5A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B1DA5B5D10>]}
[0m11:54:12.505262 [debug] [MainThread]: Flushing usage events
[0m11:54:12.979906 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:55:09.591652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B710492510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B70E2FC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B7125F3ED0>]}


============================== 11:55:09.595858 | a0bf178f-7bec-46a9-88f0-e9574d88bfec ==============================
[0m11:55:09.595858 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:55:09.596417 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:55:12.528190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B71097DA70>]}
[0m11:55:12.578493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73DFF97B0>]}
[0m11:55:12.579253 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:55:13.043586 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:55:13.190255 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:55:13.190857 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\total_orders_2023.sql
[0m11:55:13.411967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E4C6150>]}
[0m11:55:13.477803 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:55:13.480228 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:55:13.503081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73DFE23F0>]}
[0m11:55:13.503588 [info ] [MainThread]: Found 1 model, 2 sources, 493 macros
[0m11:55:13.504173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E7A1550>]}
[0m11:55:13.505671 [info ] [MainThread]: 
[0m11:55:13.506186 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:55:13.506570 [info ] [MainThread]: 
[0m11:55:13.507033 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:55:13.508668 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:55:13.509282 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:55:13.906989 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:55:13.907391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:55:14.136216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E74FEE0>]}
[0m11:55:14.136653 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:55:14.143062 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m11:55:14.143615 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m11:55:14.144342 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.total_orders_2023'
[0m11:55:14.144640 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m11:55:14.151139 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m11:55:14.152375 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m11:55:14.176715 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m11:55:14.177736 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m11:55:14.178188 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:55:14.557080 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4d19cf4a-b7eb-464e-babf-3bde24357515&page=queryresults
[0m11:55:14.968063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a0bf178f-7bec-46a9-88f0-e9574d88bfec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E727B90>]}
[0m11:55:14.968785 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.82s]
[0m11:55:14.969647 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m11:55:14.971068 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:55:14.972588 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:55:14.972851 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:55:14.973056 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:55:14.973302 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m11:55:14.973546 [info ] [MainThread]: 
[0m11:55:14.973998 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.47 seconds (1.47s).
[0m11:55:14.974675 [debug] [MainThread]: Command end result
[0m11:55:14.996323 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:55:14.999020 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:55:15.004501 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:55:15.004811 [info ] [MainThread]: 
[0m11:55:15.005309 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:55:15.005739 [info ] [MainThread]: 
[0m11:55:15.006256 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:55:15.007233 [debug] [MainThread]: Command `dbt run` succeeded at 11:55:15.007115 after 5.53 seconds
[0m11:55:15.007554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E6FB3E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E7D91D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B73E7DA490>]}
[0m11:55:15.007842 [debug] [MainThread]: Flushing usage events
[0m11:55:15.437970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:56:24.769380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000201608F2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002015E7BC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020162A53ED0>]}


============================== 11:56:24.773704 | b603d5fa-ef9d-418c-a6a3-0712b3588921 ==============================
[0m11:56:24.773704 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:56:24.774468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:56:27.686166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020160DDDA70>]}
[0m11:56:27.744173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010E4697B0>]}
[0m11:56:27.744921 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:56:28.215176 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:56:28.368810 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m11:56:28.369332 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m11:56:28.590152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010E932150>]}
[0m11:56:28.651628 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:56:28.654078 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:56:28.681809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010E92B200>]}
[0m11:56:28.682243 [info ] [MainThread]: Found 2 models, 2 sources, 493 macros
[0m11:56:28.682661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010EC15550>]}
[0m11:56:28.684026 [info ] [MainThread]: 
[0m11:56:28.684407 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:56:28.684755 [info ] [MainThread]: 
[0m11:56:28.685194 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:56:28.688516 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:56:28.688925 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:29.079327 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:56:29.079750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:29.300240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010EBC3EE0>]}
[0m11:56:29.300746 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:56:29.305724 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m11:56:29.306291 [info ] [Thread-1 (]: 1 of 2 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m11:56:29.307189 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_per_month_2023'
[0m11:56:29.307521 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m11:56:29.313618 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m11:56:29.314626 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m11:56:29.340943 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m11:56:29.342433 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m11:56:29.342901 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:56:29.800349 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:683df172-fc11-4471-9d91-18e9edf27fb9&page=queryresults
[0m11:56:30.036201 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010EB5BE90>]}
[0m11:56:30.037070 [info ] [Thread-1 (]: 1 of 2 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.73s]
[0m11:56:30.038351 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m11:56:30.038838 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m11:56:30.039563 [info ] [Thread-1 (]: 2 of 2 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m11:56:30.040374 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.total_orders_2023)
[0m11:56:30.040997 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m11:56:30.044101 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m11:56:30.045033 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m11:56:30.047576 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m11:56:30.048345 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m11:56:30.048690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:56:30.405627 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e76f968b-1b17-417f-bd86-71a38b3a3aff&page=queryresults
[0m11:56:30.623155 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b603d5fa-ef9d-418c-a6a3-0712b3588921', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010F2D0050>]}
[0m11:56:30.623828 [info ] [Thread-1 (]: 2 of 2 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.58s]
[0m11:56:30.624721 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m11:56:30.626219 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:56:30.627964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:56:30.628416 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:56:30.628675 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:56:30.628908 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m11:56:30.629205 [info ] [MainThread]: 
[0m11:56:30.629774 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m11:56:30.630748 [debug] [MainThread]: Command end result
[0m11:56:30.647587 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:56:30.649914 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:56:30.655125 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:56:30.655464 [info ] [MainThread]: 
[0m11:56:30.655925 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:56:30.656232 [info ] [MainThread]: 
[0m11:56:30.656549 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m11:56:30.657436 [debug] [MainThread]: Command `dbt run` succeeded at 11:56:30.657338 after 6.01 seconds
[0m11:56:30.657770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010EC519F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010EBD9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002010E62E4D0>]}
[0m11:56:30.658093 [debug] [MainThread]: Flushing usage events
[0m11:56:31.167232 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:58:14.100758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A87262510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A850BC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A893D3ED0>]}


============================== 11:58:14.104918 | 8df779bd-e171-4115-9f48-8d33da518780 ==============================
[0m11:58:14.104918 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:58:14.105493 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select orders_per_month_2023', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:58:16.882600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020A8774DA70>]}
[0m11:58:16.933752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB4DC97B0>]}
[0m11:58:16.934438 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:58:17.416108 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:58:17.565491 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:58:17.566012 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m11:58:17.783524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB5296150>]}
[0m11:58:17.844581 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:58:17.847204 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:58:17.871017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB4DB23F0>]}
[0m11:58:17.871556 [info ] [MainThread]: Found 2 models, 2 sources, 493 macros
[0m11:58:17.872192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB5575470>]}
[0m11:58:17.873752 [info ] [MainThread]: 
[0m11:58:17.874424 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:58:17.874879 [info ] [MainThread]: 
[0m11:58:17.875573 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:58:17.876753 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:58:17.877285 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:18.258397 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:58:18.258800 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:18.482497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB551FEE0>]}
[0m11:58:18.482919 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:58:18.489701 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m11:58:18.490261 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m11:58:18.491168 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_per_month_2023'
[0m11:58:18.491506 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m11:58:18.497117 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m11:58:18.497919 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m11:58:18.523041 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m11:58:18.524241 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  format_date('%B - %Y', date_trunc(date_date, month)) as month_year,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month_year
order by date_trunc(date_date, month);


[0m11:58:18.524719 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:58:18.961300 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6856b5f0-973e-47bc-b5c9-f5c3717e6ff6&page=queryresults
[0m11:58:19.017995 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6856b5f0-973e-47bc-b5c9-f5c3717e6ff6&page=queryresults
[0m11:58:19.026674 [debug] [Thread-1 (]: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [14:21]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:19.029280 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8df779bd-e171-4115-9f48-8d33da518780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB54CE750>]}
[0m11:58:19.029920 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.orders_per_month_2023 ................. [[31mERROR[0m in 0.54s]
[0m11:58:19.031024 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m11:58:19.032008 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_per_month_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [14:21]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql.
[0m11:58:19.034085 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:58:19.035596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:19.036068 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:58:19.036454 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:58:19.036686 [debug] [MainThread]: Connection 'model.astrafy_project.orders_per_month_2023' was properly closed.
[0m11:58:19.036950 [info ] [MainThread]: 
[0m11:58:19.037436 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m11:58:19.038230 [debug] [MainThread]: Command end result
[0m11:58:19.056978 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:58:19.059542 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:58:19.064778 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:58:19.065099 [info ] [MainThread]: 
[0m11:58:19.065649 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:58:19.066141 [info ] [MainThread]: 
[0m11:58:19.066717 [error] [MainThread]: [31mFailure in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)[0m
[0m11:58:19.067211 [error] [MainThread]:   Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [14:21]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:19.067644 [info ] [MainThread]: 
[0m11:58:19.068110 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:19.068527 [info ] [MainThread]: 
[0m11:58:19.068981 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:58:19.070352 [debug] [MainThread]: Command `dbt run` failed at 11:58:19.070243 after 5.09 seconds
[0m11:58:19.070669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB54CB280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB53D54F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AB53D5090>]}
[0m11:58:19.070975 [debug] [MainThread]: Flushing usage events
[0m11:58:19.494114 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:58:49.478206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A30AA2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A2E90C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A32C03ED0>]}


============================== 11:58:49.482393 | 63c0d35b-32e9-4e9a-af70-0ada5282b8d1 ==============================
[0m11:58:49.482393 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:58:49.483096 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select orders_per_month_2023', 'send_anonymous_usage_stats': 'True'}
[0m11:58:52.139514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A30F8DA70>]}
[0m11:58:52.189433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5E6197B0>]}
[0m11:58:52.190298 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:58:52.657237 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:58:52.801035 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:58:52.801609 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m11:58:53.026188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5EAE2150>]}
[0m11:58:53.088076 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:58:53.090074 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:58:53.116180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5E6023F0>]}
[0m11:58:53.116605 [info ] [MainThread]: Found 2 models, 2 sources, 493 macros
[0m11:58:53.117043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5EDBD470>]}
[0m11:58:53.118204 [info ] [MainThread]: 
[0m11:58:53.118643 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:58:53.118969 [info ] [MainThread]: 
[0m11:58:53.119490 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:58:53.120448 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:58:53.120891 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:53.524334 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:58:53.524797 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:53.755959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5ED6FEE0>]}
[0m11:58:53.756383 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:58:53.762262 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m11:58:53.762816 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m11:58:53.764025 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_per_month_2023'
[0m11:58:53.764390 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m11:58:53.770070 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m11:58:53.770955 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m11:58:53.795767 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m11:58:53.796957 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  format_date('%B - %Y', date_trunc(date_date, month)) as month_year,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month_year
order by date_trunc(month_year, month);


[0m11:58:53.797438 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:58:54.146403 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2df949d3-3789-45b9-971f-6caa825fd309&page=queryresults
[0m11:58:54.197922 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2df949d3-3789-45b9-971f-6caa825fd309&page=queryresults
[0m11:58:54.205636 [debug] [Thread-1 (]: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:54.207890 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63c0d35b-32e9-4e9a-af70-0ada5282b8d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5ED0A750>]}
[0m11:58:54.208669 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.orders_per_month_2023 ................. [[31mERROR[0m in 0.44s]
[0m11:58:54.209609 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m11:58:54.210216 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_per_month_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql.
[0m11:58:54.212560 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:58:54.214120 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:54.214398 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:58:54.214620 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:58:54.214868 [debug] [MainThread]: Connection 'model.astrafy_project.orders_per_month_2023' was properly closed.
[0m11:58:54.215132 [info ] [MainThread]: 
[0m11:58:54.215661 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m11:58:54.216539 [debug] [MainThread]: Command end result
[0m11:58:54.235867 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:58:54.238118 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:58:54.243689 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:58:54.244016 [info ] [MainThread]: 
[0m11:58:54.244654 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:58:54.245515 [info ] [MainThread]: 
[0m11:58:54.246135 [error] [MainThread]: [31mFailure in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)[0m
[0m11:58:54.246767 [error] [MainThread]:   Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:54.247316 [info ] [MainThread]: 
[0m11:58:54.247688 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:58:54.248119 [info ] [MainThread]: 
[0m11:58:54.248531 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:58:54.250163 [debug] [MainThread]: Command `dbt run` failed at 11:58:54.249968 after 4.89 seconds
[0m11:58:54.250607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5ECFF280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A2E557890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024A5E7E3ED0>]}
[0m11:58:54.250976 [debug] [MainThread]: Flushing usage events
[0m11:58:54.652236 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:59:31.254119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE58BE2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE56A4C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE5AD43ED0>]}


============================== 11:59:31.258171 | 401ea17e-24ef-4e9e-a3d3-7a5e26a28996 ==============================
[0m11:59:31.258171 [info ] [MainThread]: Running with dbt=1.10.3
[0m11:59:31.258862 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select orders_per_month_2023', 'send_anonymous_usage_stats': 'True'}
[0m11:59:33.937555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE590CDA70>]}
[0m11:59:33.991129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE068097B0>]}
[0m11:59:33.991800 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m11:59:34.455617 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m11:59:34.601354 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:34.601822 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:34.626695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE06CD1050>]}
[0m11:59:34.707824 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:59:34.710219 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:59:34.733015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE067F23F0>]}
[0m11:59:34.733533 [info ] [MainThread]: Found 2 models, 2 sources, 493 macros
[0m11:59:34.734114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE068B2970>]}
[0m11:59:34.736280 [info ] [MainThread]: 
[0m11:59:34.736786 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:59:34.737097 [info ] [MainThread]: 
[0m11:59:34.737615 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:59:34.738681 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m11:59:34.739069 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:35.137898 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m11:59:35.138272 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:35.371228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE068176C0>]}
[0m11:59:35.371873 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:59:35.378682 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m11:59:35.379243 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m11:59:35.380289 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_per_month_2023'
[0m11:59:35.380606 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m11:59:35.387439 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m11:59:35.388243 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m11:59:35.415140 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m11:59:35.416198 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  format_date('%B - %Y', date_trunc(date_date, month)) as month_year,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month_year
order by date_trunc(month_year, month);


[0m11:59:35.416662 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:59:35.945006 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:93a3f323-8e5a-41bb-9a2e-56768aea5b76&page=queryresults
[0m11:59:36.007800 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:93a3f323-8e5a-41bb-9a2e-56768aea5b76&page=queryresults
[0m11:59:36.015442 [debug] [Thread-1 (]: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:59:36.017353 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '401ea17e-24ef-4e9e-a3d3-7a5e26a28996', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE06E36210>]}
[0m11:59:36.017908 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.orders_per_month_2023 ................. [[31mERROR[0m in 0.64s]
[0m11:59:36.018669 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m11:59:36.019453 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_per_month_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql.
[0m11:59:36.021420 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:59:36.022643 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:36.022859 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m11:59:36.023083 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m11:59:36.023266 [debug] [MainThread]: Connection 'model.astrafy_project.orders_per_month_2023' was properly closed.
[0m11:59:36.023465 [info ] [MainThread]: 
[0m11:59:36.024013 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.29 seconds (1.29s).
[0m11:59:36.024970 [debug] [MainThread]: Command end result
[0m11:59:36.041145 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m11:59:36.043566 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m11:59:36.048747 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m11:59:36.049267 [info ] [MainThread]: 
[0m11:59:36.050000 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:59:36.050473 [info ] [MainThread]: 
[0m11:59:36.050965 [error] [MainThread]: [31mFailure in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)[0m
[0m11:59:36.051442 [error] [MainThread]:   Database Error in model orders_per_month_2023 (models\marts\orders_per_month_2023.sql)
  No matching signature for function DATE_TRUNC
    Argument types: STRING, DATE_TIME_PART
    Signature: DATE_TRUNC(DATE, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: DATE_TRUNC(DATETIME, DATE_TIME_PART)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: DATE_TRUNC(TIMESTAMP, DATE_TIME_PART, [STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP at [14:10]
  compiled code at target\run\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:59:36.051976 [info ] [MainThread]: 
[0m11:59:36.052348 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_per_month_2023.sql
[0m11:59:36.052642 [info ] [MainThread]: 
[0m11:59:36.052955 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m11:59:36.053829 [debug] [MainThread]: Command `dbt run` failed at 11:59:36.053722 after 4.91 seconds
[0m11:59:36.054139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE06E52D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE06E8E210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BE06E8D590>]}
[0m11:59:36.054431 [debug] [MainThread]: Flushing usage events
[0m11:59:36.456709 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:00:02.978243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9FABE2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F8A3C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9FCD43ED0>]}


============================== 12:00:02.982784 | 12ed6f54-3f51-4956-b74b-f9e434921bf7 ==============================
[0m12:00:02.982784 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:00:02.983432 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select orders_per_month_2023', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:00:05.786104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9FB0CDA70>]}
[0m12:00:05.836834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A78997B0>]}
[0m12:00:05.837554 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:00:06.307888 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:00:06.441987 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:00:06.442572 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m12:00:06.659188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A8D36150>]}
[0m12:00:06.720023 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:00:06.722337 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:00:06.747170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A78823F0>]}
[0m12:00:06.747609 [info ] [MainThread]: Found 2 models, 2 sources, 493 macros
[0m12:00:06.748008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A9011470>]}
[0m12:00:06.749140 [info ] [MainThread]: 
[0m12:00:06.749489 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:00:06.749743 [info ] [MainThread]: 
[0m12:00:06.750176 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:00:06.751277 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:00:06.751709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:00:07.125006 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:00:07.125442 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:00:07.362988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A8FBFEE0>]}
[0m12:00:07.363386 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:00:07.368328 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:00:07.368755 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:00:07.369297 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_per_month_2023'
[0m12:00:07.369572 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:00:07.375363 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:00:07.376166 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:00:07.411365 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:00:07.412702 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:00:07.413293 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:00:07.830302 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4c74ea2c-9594-42b2-82d1-0c10128ce254&page=queryresults
[0m12:00:08.048412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12ed6f54-3f51-4956-b74b-f9e434921bf7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A8F6FF50>]}
[0m12:00:08.048980 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.68s]
[0m12:00:08.049752 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:00:08.051198 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:00:08.052418 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:00:08.052633 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:00:08.052821 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:00:08.052986 [debug] [MainThread]: Connection 'model.astrafy_project.orders_per_month_2023' was properly closed.
[0m12:00:08.053186 [info ] [MainThread]: 
[0m12:00:08.053928 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.30 seconds (1.30s).
[0m12:00:08.054869 [debug] [MainThread]: Command end result
[0m12:00:08.071506 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:00:08.073773 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:00:08.079656 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:00:08.080133 [info ] [MainThread]: 
[0m12:00:08.080802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:00:08.081298 [info ] [MainThread]: 
[0m12:00:08.081820 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:00:08.082832 [debug] [MainThread]: Command `dbt run` succeeded at 12:00:08.082727 after 5.22 seconds
[0m12:00:08.083136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A8F4D7B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F8687890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A8FEB4D0>]}
[0m12:00:08.083416 [debug] [MainThread]: Flushing usage events
[0m12:00:08.537688 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:07:16.144235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F742510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551D5AC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002552189FED0>]}


============================== 12:07:16.148408 | db3f02f2-d268-4d2a-8680-05f3830ee3c4 ==============================
[0m12:07:16.148408 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:07:16.149003 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select avg_products_per_order_2023', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:07:18.863167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FC2DA70>]}
[0m12:07:18.913990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D2A97B0>]}
[0m12:07:18.914687 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:07:19.376751 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:07:19.519462 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:07:19.520028 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\avg_products_per_order_2023.sql
[0m12:07:19.733151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D776150>]}
[0m12:07:19.796834 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:07:19.799991 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:07:19.824295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D2923F0>]}
[0m12:07:19.824792 [info ] [MainThread]: Found 3 models, 2 sources, 493 macros
[0m12:07:19.825229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554DA5D550>]}
[0m12:07:19.826474 [info ] [MainThread]: 
[0m12:07:19.827128 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:07:19.827513 [info ] [MainThread]: 
[0m12:07:19.828243 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:07:19.829465 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:07:19.829875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:20.246141 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:07:20.246500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:20.496628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554DA03EE0>]}
[0m12:07:20.497107 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:07:20.502785 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:07:20.503265 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:07:20.504008 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:07:20.504307 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:07:20.509653 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:07:20.511040 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:07:20.535308 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:07:20.536587 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:07:20.537010 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:07:20.997489 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8fc329d7-d3b4-43c0-a619-9c21a6499c9d&page=queryresults
[0m12:07:21.297063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db3f02f2-d268-4d2a-8680-05f3830ee3c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D956E10>]}
[0m12:07:21.297988 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.79s]
[0m12:07:21.298938 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:07:21.300561 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:07:21.302111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:07:21.302396 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:07:21.302592 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:07:21.302774 [debug] [MainThread]: Connection 'model.astrafy_project.avg_products_per_order_2023' was properly closed.
[0m12:07:21.302985 [info ] [MainThread]: 
[0m12:07:21.303385 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m12:07:21.304184 [debug] [MainThread]: Command end result
[0m12:07:21.320557 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:07:21.322963 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:07:21.328517 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:07:21.328890 [info ] [MainThread]: 
[0m12:07:21.329439 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:07:21.329905 [info ] [MainThread]: 
[0m12:07:21.330308 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:07:21.331321 [debug] [MainThread]: Command `dbt run` succeeded at 12:07:21.331182 after 5.34 seconds
[0m12:07:21.331645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D9C55A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551D1F7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002554D4A47D0>]}
[0m12:07:21.331942 [debug] [MainThread]: Flushing usage events
[0m12:07:21.782596 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:12:22.922618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016514632510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001651248C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016516793ED0>]}


============================== 12:12:22.927036 | ee426fcf-73e7-44d1-b319-43a68f44916d ==============================
[0m12:12:22.927036 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:12:22.927716 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:12:25.763849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016514B1DA70>]}
[0m12:12:25.816415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000165421A97B0>]}
[0m12:12:25.817121 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:12:26.335510 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:12:26.496132 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:12:26.496683 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\orders_with_products.sql
[0m12:12:26.739072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001654267A250>]}
[0m12:12:26.806775 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:12:26.809938 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:12:26.836490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000165421923F0>]}
[0m12:12:26.836920 [info ] [MainThread]: Found 4 models, 2 sources, 493 macros
[0m12:12:26.837454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016542965630>]}
[0m12:12:26.839097 [info ] [MainThread]: 
[0m12:12:26.839546 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:12:26.839840 [info ] [MainThread]: 
[0m12:12:26.840292 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:12:26.844243 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:12:26.844794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:27.261075 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:12:27.261989 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:27.482535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016542873040>]}
[0m12:12:27.483082 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:12:27.487410 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:12:27.487936 [info ] [Thread-1 (]: 1 of 4 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:12:27.488551 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:12:27.488859 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:12:27.495688 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:12:27.496858 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:12:27.524346 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:12:27.525593 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:12:27.526111 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:12:27.928099 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:bd5a2e96-bbc9-4118-a1f4-7f1e99cdd440&page=queryresults
[0m12:12:28.242374 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000165428AEA50>]}
[0m12:12:28.243363 [info ] [Thread-1 (]: 1 of 4 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.75s]
[0m12:12:28.244406 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:12:28.244829 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:12:28.245469 [info ] [Thread-1 (]: 2 of 4 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:12:28.246276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.orders_per_month_2023)
[0m12:12:28.246581 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:12:28.249107 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:12:28.250016 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:12:28.252844 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:12:28.254084 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:12:28.254482 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:28.645884 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e200f4fe-14cf-42d4-af50-3ccc63ba3e7b&page=queryresults
[0m12:12:28.876281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016542FF07E0>]}
[0m12:12:28.876907 [info ] [Thread-1 (]: 2 of 4 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.63s]
[0m12:12:28.877535 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:12:28.877837 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:12:28.878252 [info ] [Thread-1 (]: 3 of 4 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:12:28.878636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:12:28.878917 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:12:28.881013 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:12:28.882030 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:12:28.884305 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:12:28.885497 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:12:28.886307 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:29.223630 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4dd28953-16e7-48c0-b409-aa9294e2616a&page=queryresults
[0m12:12:29.400875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016542FCFB10>]}
[0m12:12:29.401637 [info ] [Thread-1 (]: 3 of 4 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:12:29.402731 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:12:29.403292 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:12:29.403973 [info ] [Thread-1 (]: 4 of 4 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:12:29.404599 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:12:29.404910 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:12:29.407506 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:12:29.409186 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:12:29.411126 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:12:29.411843 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:12:29.412171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:12:29.751465 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:fbf1b405-3df0-48c7-80e0-b222673a8a68&page=queryresults
[0m12:12:29.976078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee426fcf-73e7-44d1-b319-43a68f44916d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016516761ED0>]}
[0m12:12:29.976711 [info ] [Thread-1 (]: 4 of 4 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.57s]
[0m12:12:29.977473 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:12:29.978781 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:12:29.980214 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:12:29.980478 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:12:29.980689 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:12:29.980878 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m12:12:29.981151 [info ] [MainThread]: 
[0m12:12:29.981484 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.14 seconds (3.14s).
[0m12:12:29.982483 [debug] [MainThread]: Command end result
[0m12:12:30.000125 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:12:30.003181 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:12:30.009878 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:12:30.010266 [info ] [MainThread]: 
[0m12:12:30.010813 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:12:30.011173 [info ] [MainThread]: 
[0m12:12:30.011526 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=4
[0m12:12:30.012384 [debug] [MainThread]: Command `dbt run` succeeded at 12:12:30.012279 after 7.21 seconds
[0m12:12:30.012697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000165167D17F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001650EF95E80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016542FFBD70>]}
[0m12:12:30.013006 [debug] [MainThread]: Flushing usage events
[0m12:12:30.461146 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:14:22.479022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266726B2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002667051C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002667481FED0>]}


============================== 12:14:22.483705 | 39181ea8-1d1f-4ddc-ab87-c427cb62ca1d ==============================
[0m12:14:22.483705 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:14:22.484325 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:14:25.296180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026672B99A70>]}
[0m12:14:25.351396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266202A97B0>]}
[0m12:14:25.352437 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:14:25.870994 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:14:26.031459 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:14:26.032080 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\order_segmentation.sql
[0m12:14:26.268791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026620776350>]}
[0m12:14:26.340723 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:14:26.343812 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:14:26.369833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266202923F0>]}
[0m12:14:26.370279 [info ] [MainThread]: Found 5 models, 2 sources, 493 macros
[0m12:14:26.371230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026620A79630>]}
[0m12:14:26.373087 [info ] [MainThread]: 
[0m12:14:26.373590 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:14:26.373929 [info ] [MainThread]: 
[0m12:14:26.374454 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:14:26.378740 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:14:26.379204 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:14:26.743640 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:14:26.744146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:14:26.961903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002662096E820>]}
[0m12:14:26.962396 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:14:26.967071 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:14:26.967552 [info ] [Thread-1 (]: 1 of 5 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:14:26.968116 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:14:26.968411 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:14:26.974557 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:14:26.975715 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:14:27.001135 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:14:27.002233 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:14:27.002647 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:14:27.428534 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:5f777930-d7a7-4212-b8de-d733745ccc64&page=queryresults
[0m12:14:27.635268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266209C7590>]}
[0m12:14:27.635876 [info ] [Thread-1 (]: 1 of 5 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.67s]
[0m12:14:27.636558 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:14:27.636916 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m12:14:27.637684 [info ] [Thread-1 (]: 2 of 5 START sql view model raw.order_segmentation ............................. [RUN]
[0m12:14:27.638751 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m12:14:27.639062 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m12:14:27.641396 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m12:14:27.642770 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m12:14:27.645894 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m12:14:27.647032 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        -- Cantidad de órdenes del cliente en los 12 meses previos a esta orden (excluyendo la orden actual)
        countif(date_date < current.date_date and date_date >= date_sub(current.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as current
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m12:14:27.647482 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:14:27.939930 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0a08b4f3-d983-4ffe-93a3-237c3a30679a&page=queryresults
[0m12:14:27.941034 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0a08b4f3-d983-4ffe-93a3-237c3a30679a&page=queryresults
[0m12:14:27.950073 [debug] [Thread-1 (]: Database Error in model order_segmentation (models\marts\order_segmentation.sql)
  Syntax error: Unexpected keyword CURRENT at [13:29]
  compiled code at target\run\astrafy_project\models\marts\order_segmentation.sql
[0m12:14:27.950752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266210F43C0>]}
[0m12:14:27.951406 [error] [Thread-1 (]: 2 of 5 ERROR creating sql view model raw.order_segmentation .................... [[31mERROR[0m in 0.31s]
[0m12:14:27.952125 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m12:14:27.952527 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:14:27.953060 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.order_segmentation' to be skipped because of status 'error'.  Reason: Database Error in model order_segmentation (models\marts\order_segmentation.sql)
  Syntax error: Unexpected keyword CURRENT at [13:29]
  compiled code at target\run\astrafy_project\models\marts\order_segmentation.sql.
[0m12:14:27.953592 [info ] [Thread-1 (]: 3 of 5 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:14:27.954828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m12:14:27.955175 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:14:27.958590 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:14:27.959648 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:14:27.962089 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:14:27.962828 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:14:27.963163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:14:28.305141 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0773dc9b-4792-4de4-8d79-8778a2d538d1&page=queryresults
[0m12:14:28.533602 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266210D3890>]}
[0m12:14:28.534320 [info ] [Thread-1 (]: 3 of 5 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.58s]
[0m12:14:28.535156 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:14:28.535602 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:14:28.536200 [info ] [Thread-1 (]: 4 of 5 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:14:28.536863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:14:28.537166 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:14:28.539279 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:14:28.540134 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:14:28.542552 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:14:28.543537 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:14:28.543933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:14:28.857156 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6b3f964c-a101-4761-abb3-7d38dfdeef2f&page=queryresults
[0m12:14:29.034596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002662100F450>]}
[0m12:14:29.035312 [info ] [Thread-1 (]: 4 of 5 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.50s]
[0m12:14:29.036014 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:14:29.036348 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:14:29.036867 [info ] [Thread-1 (]: 5 of 5 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:14:29.037459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:14:29.037815 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:14:29.040701 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:14:29.041771 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:14:29.045278 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:14:29.046546 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:14:29.047024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:14:29.417252 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:272b18db-ccfe-47cd-a391-bffc1cfc95c8&page=queryresults
[0m12:14:29.609243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '39181ea8-1d1f-4ddc-ab87-c427cb62ca1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266211BC050>]}
[0m12:14:29.609952 [info ] [Thread-1 (]: 5 of 5 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.57s]
[0m12:14:29.610665 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:14:29.612114 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:14:29.613775 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:14:29.614050 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:14:29.614260 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:14:29.614463 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m12:14:29.614741 [info ] [MainThread]: 
[0m12:14:29.615138 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 3.24 seconds (3.24s).
[0m12:14:29.616242 [debug] [MainThread]: Command end result
[0m12:14:29.633307 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:14:29.635763 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:14:29.641564 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:14:29.641913 [info ] [MainThread]: 
[0m12:14:29.642795 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:14:29.643584 [info ] [MainThread]: 
[0m12:14:29.644018 [error] [MainThread]: [31mFailure in model order_segmentation (models\marts\order_segmentation.sql)[0m
[0m12:14:29.644379 [error] [MainThread]:   Database Error in model order_segmentation (models\marts\order_segmentation.sql)
  Syntax error: Unexpected keyword CURRENT at [13:29]
  compiled code at target\run\astrafy_project\models\marts\order_segmentation.sql
[0m12:14:29.644694 [info ] [MainThread]: 
[0m12:14:29.645017 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\order_segmentation.sql
[0m12:14:29.645278 [info ] [MainThread]: 
[0m12:14:29.645555 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=5
[0m12:14:29.646330 [debug] [MainThread]: Command `dbt run` failed at 12:14:29.646222 after 7.30 seconds
[0m12:14:29.646637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266211E3B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266210975F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000266203CA2D0>]}
[0m12:14:29.646912 [debug] [MainThread]: Flushing usage events
[0m12:14:30.164525 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:14:54.395406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A39B42510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A379AC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A3BCA3ED0>]}


============================== 12:14:54.400550 | 4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa ==============================
[0m12:14:54.400550 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:14:54.401285 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:14:57.124484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A3A021A70>]}
[0m12:14:57.178099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A666E97B0>]}
[0m12:14:57.178916 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:14:57.628279 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:14:57.779074 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:14:57.779652 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\order_segmentation.sql
[0m12:14:57.999203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67B86250>]}
[0m12:14:58.060974 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:14:58.063685 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:14:58.089218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A666D23F0>]}
[0m12:14:58.089737 [info ] [MainThread]: Found 5 models, 2 sources, 493 macros
[0m12:14:58.090331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67E6D470>]}
[0m12:14:58.092372 [info ] [MainThread]: 
[0m12:14:58.093178 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:14:58.093627 [info ] [MainThread]: 
[0m12:14:58.094329 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:14:58.097833 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:14:58.098211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:14:58.448224 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:14:58.448632 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:14:58.666351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67D82B60>]}
[0m12:14:58.666798 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:14:58.673202 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:14:58.673748 [info ] [Thread-1 (]: 1 of 5 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:14:58.674522 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:14:58.674821 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:14:58.680485 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:14:58.681720 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:14:58.707331 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:14:58.708575 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:14:58.709007 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:14:59.074096 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:bdafa3bc-131b-462b-aa14-c5ad0caedf6e&page=queryresults
[0m12:14:59.333243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67DBEBD0>]}
[0m12:14:59.333950 [info ] [Thread-1 (]: 1 of 5 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.66s]
[0m12:14:59.335074 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:14:59.335550 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m12:14:59.336081 [info ] [Thread-1 (]: 2 of 5 START sql view model raw.order_segmentation ............................. [RUN]
[0m12:14:59.336995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m12:14:59.337303 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m12:14:59.339966 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m12:14:59.341427 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m12:14:59.344080 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m12:14:59.344869 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        countif(date_date < s.date_date and date_date >= date_sub(s.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as s
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m12:14:59.345250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:14:59.737391 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:d947d45a-f362-47ec-a41b-78de2cb6c74f&page=queryresults
[0m12:15:00.019896 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A68504520>]}
[0m12:15:00.020578 [info ] [Thread-1 (]: 2 of 5 OK created sql view model raw.order_segmentation ........................ [[32mCREATE VIEW (0 processed)[0m in 0.68s]
[0m12:15:00.021653 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m12:15:00.022134 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:15:00.022605 [info ] [Thread-1 (]: 3 of 5 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:15:00.023303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m12:15:00.023676 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:15:00.026129 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:15:00.027032 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:15:00.029464 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:15:00.030225 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:15:00.030555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:15:00.351158 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:13fb3d5a-ede0-4483-8437-8a189ecda24f&page=queryresults
[0m12:15:00.533397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A678B5DB0>]}
[0m12:15:00.533969 [info ] [Thread-1 (]: 3 of 5 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.51s]
[0m12:15:00.534799 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:15:00.535108 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:15:00.535429 [info ] [Thread-1 (]: 4 of 5 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:15:00.536126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:15:00.536416 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:15:00.538545 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:15:00.539686 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:15:00.541818 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:15:00.542788 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:15:00.543198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:15:00.901283 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:cf67e3c3-ba67-4501-8950-a5d9aabcd701&page=queryresults
[0m12:15:01.054885 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67B2E650>]}
[0m12:15:01.055454 [info ] [Thread-1 (]: 4 of 5 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:15:01.056379 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:15:01.056673 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:15:01.057011 [info ] [Thread-1 (]: 5 of 5 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:15:01.057551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:15:01.057903 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:15:01.060067 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:15:01.060953 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:15:01.063608 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:15:01.064389 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:15:01.064748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:15:01.407808 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0c631c04-c3c6-4298-9e2b-bbbd2e6dff22&page=queryresults
[0m12:15:01.557413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4dc9f4da-ecc8-4905-93e9-a5b3d2f8d6aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A685A6EB0>]}
[0m12:15:01.558151 [info ] [Thread-1 (]: 5 of 5 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.50s]
[0m12:15:01.559186 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:15:01.560942 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:15:01.562392 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:15:01.562627 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:15:01.562822 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:15:01.563002 [debug] [MainThread]: Connection 'model.astrafy_project.total_orders_2023' was properly closed.
[0m12:15:01.563250 [info ] [MainThread]: 
[0m12:15:01.563728 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 3.47 seconds (3.47s).
[0m12:15:01.565010 [debug] [MainThread]: Command end result
[0m12:15:01.582872 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:15:01.585259 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:15:01.590704 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:15:01.591045 [info ] [MainThread]: 
[0m12:15:01.591796 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:15:01.592122 [info ] [MainThread]: 
[0m12:15:01.592566 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m12:15:01.593559 [debug] [MainThread]: Command `dbt run` succeeded at 12:15:01.593447 after 7.32 seconds
[0m12:15:01.593867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A67C363F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A684A7FB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027A684A6750>]}
[0m12:15:01.594161 [debug] [MainThread]: Flushing usage events
[0m12:15:02.132477 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:17:05.801769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF910A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF8EF1C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF931FFED0>]}


============================== 12:17:05.805916 | 0a18e0f0-bc8a-46bb-8490-60d9ca53fb43 ==============================
[0m12:17:05.805916 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:17:05.806499 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:17:08.572875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BF9158DA70>]}
[0m12:17:08.626842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBEC197B0>]}
[0m12:17:08.627668 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:17:09.098512 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:17:09.249380 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:17:09.249926 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m12:17:09.475159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF0EA450>]}
[0m12:17:09.540405 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:17:09.543248 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:17:09.570260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBEC023F0>]}
[0m12:17:09.570725 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:17:09.571273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF3ED630>]}
[0m12:17:09.572927 [info ] [MainThread]: 
[0m12:17:09.573314 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:17:09.573607 [info ] [MainThread]: 
[0m12:17:09.574083 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:17:09.577942 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:17:09.578344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:17:09.970509 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:17:09.971453 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:17:10.195501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF2E2F70>]}
[0m12:17:10.195939 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:17:10.202540 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:17:10.203435 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:17:10.204158 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:17:10.204441 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:17:10.210041 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:17:10.210952 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:17:10.235220 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:17:10.236415 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:17:10.237023 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:17:10.619654 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:fc97f94e-4d2d-45fa-afff-cf73778dcc7a&page=queryresults
[0m12:17:10.861049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF312D50>]}
[0m12:17:10.862027 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.66s]
[0m12:17:10.863214 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:17:10.863614 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m12:17:10.863985 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.order_segmentation ............................. [RUN]
[0m12:17:10.864878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m12:17:10.865183 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m12:17:10.867619 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m12:17:10.868701 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m12:17:10.871006 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m12:17:10.871982 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        countif(date_date < s.date_date and date_date >= date_sub(s.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as s
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m12:17:10.872318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:11.212723 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:73f33b3a-3a38-4531-a92a-7913578a3a79&page=queryresults
[0m12:17:11.381635 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFA4C470>]}
[0m12:17:11.383353 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.order_segmentation ........................ [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:17:11.385655 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m12:17:11.386741 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:17:11.387131 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:17:11.387753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m12:17:11.388042 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:17:11.390880 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:17:11.391845 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:17:11.394161 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:17:11.395141 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:17:11.395573 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:11.733517 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:befd7b31-5b84-4858-aed7-b54bcff675cb&page=queryresults
[0m12:17:11.918158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF9E7ED0>]}
[0m12:17:11.918712 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.53s]
[0m12:17:11.919488 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:17:11.919782 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:17:11.920104 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:17:11.920611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:17:11.920883 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:17:11.922923 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:17:11.923866 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:17:11.926204 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:17:11.927206 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:17:11.927770 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:12.264619 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4ee79e07-81de-49d6-b3cc-04c1df3694c6&page=queryresults
[0m12:17:12.501277 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFA2C450>]}
[0m12:17:12.501897 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.58s]
[0m12:17:12.502683 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:17:12.502971 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:17:12.503291 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:17:12.503846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:17:12.504122 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:17:12.506173 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:17:12.506919 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:17:12.508624 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:17:12.509434 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:17:12.509929 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:12.880525 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:1e2b6ca9-b220-4354-968b-6df8058ef207&page=queryresults
[0m12:17:13.062081 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBF33F310>]}
[0m12:17:13.062684 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.56s]
[0m12:17:13.063443 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:17:13.063810 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m12:17:13.064195 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m12:17:13.064942 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.total_orders_2023, now model.astrafy_project.orders_segmented_2023)
[0m12:17:13.065320 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m12:17:13.068122 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m12:17:13.068984 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m12:17:13.070879 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m12:17:13.071628 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders_2022_2023 as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

segmented_orders as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
)

select
  o.*,
  s.order_segmentation
from orders_2022_2023 o
left join segmented_orders s
  on o.order_id = s.order_id;


[0m12:17:13.071971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:13.668706 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8b2e3e09-fcf5-45a0-bb03-94447a32b714&page=queryresults
[0m12:17:13.723914 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8b2e3e09-fcf5-45a0-bb03-94447a32b714&page=queryresults
[0m12:17:13.731969 [debug] [Thread-1 (]: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name order_segmentation not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:13.732808 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a18e0f0-bc8a-46bb-8490-60d9ca53fb43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFB47350>]}
[0m12:17:13.733441 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.orders_segmented_2023 ................. [[31mERROR[0m in 0.67s]
[0m12:17:13.734649 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m12:17:13.735475 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_segmented_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name order_segmentation not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql.
[0m12:17:13.737256 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:17:13.738800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:17:13.739038 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:17:13.739246 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:17:13.739431 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m12:17:13.739702 [info ] [MainThread]: 
[0m12:17:13.740097 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.17 seconds (4.17s).
[0m12:17:13.741596 [debug] [MainThread]: Command end result
[0m12:17:13.760008 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:17:13.762401 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:17:13.767797 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:17:13.768101 [info ] [MainThread]: 
[0m12:17:13.768613 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:17:13.769215 [info ] [MainThread]: 
[0m12:17:13.769853 [error] [MainThread]: [31mFailure in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)[0m
[0m12:17:13.770317 [error] [MainThread]:   Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name order_segmentation not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:13.770703 [info ] [MainThread]: 
[0m12:17:13.771042 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:13.771362 [info ] [MainThread]: 
[0m12:17:13.771811 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=6
[0m12:17:13.772844 [debug] [MainThread]: Command `dbt run` failed at 12:17:13.772740 after 8.13 seconds
[0m12:17:13.773149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFA0A090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFA09C70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BFBFA0A510>]}
[0m12:17:13.773430 [debug] [MainThread]: Flushing usage events
[0m12:17:14.264092 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:17:40.349607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5CE32510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5AC9C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5EF8FED0>]}


============================== 12:17:40.353362 | 7ce9d382-2cbf-4337-83e9-9d85380b8432 ==============================
[0m12:17:40.353362 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:17:40.354010 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:17:43.162180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5D31DA70>]}
[0m12:17:43.216341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0AAD97B0>]}
[0m12:17:43.217062 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:17:43.695160 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:17:43.843071 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:17:43.843767 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m12:17:44.066531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0AFAA550>]}
[0m12:17:44.130441 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:17:44.133588 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:17:44.158559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0AAC23F0>]}
[0m12:17:44.158986 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:17:44.159558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B28D470>]}
[0m12:17:44.161475 [info ] [MainThread]: 
[0m12:17:44.161852 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:17:44.162243 [info ] [MainThread]: 
[0m12:17:44.162753 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:17:44.167175 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:17:44.167604 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:17:44.617911 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:17:44.618391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:17:44.837266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B1A6F70>]}
[0m12:17:44.837824 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:17:44.843550 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:17:44.844010 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:17:44.845133 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:17:44.845427 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:17:44.850789 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:17:44.851483 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:17:44.877205 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:17:44.878222 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:17:44.878634 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:17:45.213751 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:ee1d8bea-61d1-4667-b709-bec44290a393&page=queryresults
[0m12:17:45.472346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B22EBD0>]}
[0m12:17:45.472948 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.63s]
[0m12:17:45.473742 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:17:45.474080 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m12:17:45.474419 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.order_segmentation ............................. [RUN]
[0m12:17:45.475602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m12:17:45.475874 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m12:17:45.477982 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m12:17:45.478865 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m12:17:45.482284 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m12:17:45.483338 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        countif(date_date < s.date_date and date_date >= date_sub(s.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as s
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m12:17:45.483788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:45.836755 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9524bf77-d667-49d8-833f-17ceffb85f7c&page=queryresults
[0m12:17:46.059679 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B98C890>]}
[0m12:17:46.060300 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.order_segmentation ........................ [[32mCREATE VIEW (0 processed)[0m in 0.58s]
[0m12:17:46.061512 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m12:17:46.061998 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:17:46.062531 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:17:46.063558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m12:17:46.064069 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:17:46.066492 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:17:46.067444 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:17:46.070405 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:17:46.071435 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:17:46.071833 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:46.444292 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e6d82fd2-626d-4fc3-a78a-781496f14932&page=queryresults
[0m12:17:46.611929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B8E7BB0>]}
[0m12:17:46.612576 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.55s]
[0m12:17:46.613594 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:17:46.614076 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:17:46.614479 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:17:46.615127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:17:46.615472 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:17:46.617517 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:17:46.618280 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:17:46.620016 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:17:46.620794 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:17:46.621196 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:46.944953 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:83e897b9-0c39-4870-924d-bf89a2f5bab6&page=queryresults
[0m12:17:47.148765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B928550>]}
[0m12:17:47.149327 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.53s]
[0m12:17:47.150065 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:17:47.150370 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:17:47.150682 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:17:47.151161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:17:47.151448 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:17:47.153704 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:17:47.154534 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:17:47.156308 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:17:47.156968 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:17:47.157297 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:47.510362 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c19ad131-46e2-4bc8-9d90-643f25e7bbc2&page=queryresults
[0m12:17:47.675111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0BA070E0>]}
[0m12:17:47.675673 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:17:47.676415 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:17:47.676695 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m12:17:47.677024 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m12:17:47.677609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.total_orders_2023, now model.astrafy_project.orders_segmented_2023)
[0m12:17:47.677903 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m12:17:47.680507 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m12:17:47.681308 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m12:17:47.682983 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m12:17:47.683638 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

order_seg as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
)

select
  o.*,
  s.segment -- <-- esta columna debe existir en order_segmentation
from orders o
left join order_seg s on o.order_id = s.order_id;


[0m12:17:47.683949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:17:48.248523 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2d184875-fce2-43d6-a6fd-08e59cbb1ea5&page=queryresults
[0m12:17:48.323430 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2d184875-fce2-43d6-a6fd-08e59cbb1ea5&page=queryresults
[0m12:17:48.330845 [debug] [Thread-1 (]: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:48.331344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ce9d382-2cbf-4337-83e9-9d85380b8432', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0BA51A30>]}
[0m12:17:48.331903 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.orders_segmented_2023 ................. [[31mERROR[0m in 0.65s]
[0m12:17:48.332687 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m12:17:48.333825 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_segmented_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql.
[0m12:17:48.337052 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:17:48.338920 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:17:48.339216 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:17:48.339510 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:17:48.339753 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m12:17:48.340159 [info ] [MainThread]: 
[0m12:17:48.340839 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.18 seconds (4.18s).
[0m12:17:48.342420 [debug] [MainThread]: Command end result
[0m12:17:48.359152 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:17:48.361460 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:17:48.368303 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:17:48.368726 [info ] [MainThread]: 
[0m12:17:48.369199 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:17:48.369715 [info ] [MainThread]: 
[0m12:17:48.370197 [error] [MainThread]: [31mFailure in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)[0m
[0m12:17:48.370596 [error] [MainThread]:   Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:48.370949 [info ] [MainThread]: 
[0m12:17:48.371445 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:17:48.371902 [info ] [MainThread]: 
[0m12:17:48.372455 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=6
[0m12:17:48.373499 [debug] [MainThread]: Command `dbt run` failed at 12:17:48.373376 after 8.13 seconds
[0m12:17:48.373840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B906330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B9068D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB0B9066F0>]}
[0m12:17:48.374137 [debug] [MainThread]: Flushing usage events
[0m12:17:48.860333 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:19:02.459873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288950A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028892F3C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028897203ED0>]}


============================== 12:19:02.463929 | 33675e42-1c59-4256-b78f-93ba6eb9e10a ==============================
[0m12:19:02.463929 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:19:02.464484 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:19:05.194506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002889558DA70>]}
[0m12:19:05.244878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C2C197B0>]}
[0m12:19:05.245604 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:19:05.713584 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:19:05.858551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:19:05.859124 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m12:19:06.077238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C30EA550>]}
[0m12:19:06.140392 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:19:06.142721 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:19:06.169490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C2C023F0>]}
[0m12:19:06.169966 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:19:06.170519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C33C9470>]}
[0m12:19:06.172489 [info ] [MainThread]: 
[0m12:19:06.172962 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:19:06.173406 [info ] [MainThread]: 
[0m12:19:06.174318 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:19:06.178324 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:19:06.178759 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:19:06.594142 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:19:06.594489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:19:06.812099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C32E3790>]}
[0m12:19:06.812629 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:19:06.818146 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m12:19:06.818676 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m12:19:06.819417 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m12:19:06.819705 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m12:19:06.825820 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:19:06.826848 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m12:19:06.851449 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m12:19:06.852598 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m12:19:06.853257 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:19:07.194017 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:20b9cad6-4298-40af-9961-fa721f842bf6&page=queryresults
[0m12:19:07.410267 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3316BD0>]}
[0m12:19:07.410918 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 0.59s]
[0m12:19:07.411906 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m12:19:07.412268 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m12:19:07.412647 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.order_segmentation ............................. [RUN]
[0m12:19:07.413379 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m12:19:07.413684 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m12:19:07.415982 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m12:19:07.416939 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m12:19:07.419570 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m12:19:07.420829 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        countif(date_date < s.date_date and date_date >= date_sub(s.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as s
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m12:19:07.421281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:07.784278 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:11a43d45-6959-44c0-a1e7-2def7d61b079&page=queryresults
[0m12:19:07.936018 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3A8C5D0>]}
[0m12:19:07.936583 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.order_segmentation ........................ [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:19:07.937331 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m12:19:07.937626 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m12:19:07.937994 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m12:19:07.938596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m12:19:07.938915 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m12:19:07.940990 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m12:19:07.942789 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m12:19:07.946212 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m12:19:07.947559 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m12:19:07.948053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:08.286659 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:18f39319-ef22-4730-9cab-0d4ecb3d5edf&page=queryresults
[0m12:19:08.430418 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C39E7D90>]}
[0m12:19:08.431040 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.49s]
[0m12:19:08.431886 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m12:19:08.432177 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m12:19:08.432546 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.orders_with_products ........................... [RUN]
[0m12:19:08.433147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m12:19:08.433428 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m12:19:08.435347 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m12:19:08.436107 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m12:19:08.437851 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m12:19:08.438558 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m12:19:08.438858 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:08.788632 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:44e4b819-9c77-46c9-af81-d4235ca3f41e&page=queryresults
[0m12:19:08.948882 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3A2C550>]}
[0m12:19:08.949452 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m12:19:08.950270 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m12:19:08.950595 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m12:19:08.950921 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m12:19:08.951488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m12:19:08.951771 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m12:19:08.954490 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m12:19:08.955457 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m12:19:08.957559 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m12:19:08.958386 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m12:19:08.958821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:09.280267 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c6df566f-902a-4992-b4ac-6536fc09807f&page=queryresults
[0m12:19:09.461290 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C341B070>]}
[0m12:19:09.461866 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.51s]
[0m12:19:09.462632 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m12:19:09.462942 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m12:19:09.463267 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m12:19:09.463866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.total_orders_2023, now model.astrafy_project.orders_segmented_2023)
[0m12:19:09.464136 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m12:19:09.466562 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m12:19:09.467292 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m12:19:09.469528 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m12:19:09.470294 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

order_seg as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
) as s

select
  o.*,
  s.segment -- <-- esta columna debe existir en order_segmentation
from orders o
left join order_seg s on o.order_id = s.order_id;


[0m12:19:09.470696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:19:09.733487 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8d3055bf-c520-4fcd-a6f1-46bd4bb176a1&page=queryresults
[0m12:19:09.733991 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8d3055bf-c520-4fcd-a6f1-46bd4bb176a1&page=queryresults
[0m12:19:09.741573 [debug] [Thread-1 (]: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Syntax error: Unexpected keyword AS at [13:3]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:19:09.742070 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33675e42-1c59-4256-b78f-93ba6eb9e10a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3B47410>]}
[0m12:19:09.742650 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.orders_segmented_2023 ................. [[31mERROR[0m in 0.28s]
[0m12:19:09.743499 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m12:19:09.744083 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_segmented_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Syntax error: Unexpected keyword AS at [13:3]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql.
[0m12:19:09.746735 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:19:09.748846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:19:09.749224 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:19:09.749445 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:19:09.749674 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m12:19:09.750116 [info ] [MainThread]: 
[0m12:19:09.750785 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.58 seconds (3.58s).
[0m12:19:09.752358 [debug] [MainThread]: Command end result
[0m12:19:09.770184 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:19:09.772468 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:19:09.778567 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:19:09.778883 [info ] [MainThread]: 
[0m12:19:09.779851 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:19:09.780316 [info ] [MainThread]: 
[0m12:19:09.780868 [error] [MainThread]: [31mFailure in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)[0m
[0m12:19:09.781287 [error] [MainThread]:   Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Syntax error: Unexpected keyword AS at [13:3]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:19:09.781733 [info ] [MainThread]: 
[0m12:19:09.782135 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:19:09.782478 [info ] [MainThread]: 
[0m12:19:09.782906 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=6
[0m12:19:09.783905 [debug] [MainThread]: Command `dbt run` failed at 12:19:09.783784 after 7.45 seconds
[0m12:19:09.784264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3A060F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3A068D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000288C3A06A50>]}
[0m12:19:09.784599 [debug] [MainThread]: Flushing usage events
[0m12:19:10.328446 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:20:24.346957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A48CCF2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A48AB5C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A48EE53ED0>]}


============================== 12:20:24.351974 | 1285ab70-0bc5-452b-9663-67a32bbc653d ==============================
[0m12:20:24.351974 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:20:24.352559 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select orders_segmented_2023', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:20:27.139402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A48D1DDA70>]}
[0m12:20:27.191913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BA8697B0>]}
[0m12:20:27.192690 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:20:27.644564 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:20:27.797506 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:20:27.798081 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m12:20:28.015974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BAD36550>]}
[0m12:20:28.078910 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:20:28.083063 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:20:28.109149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BA8523F0>]}
[0m12:20:28.109583 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:20:28.110062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BB019470>]}
[0m12:20:28.111383 [info ] [MainThread]: 
[0m12:20:28.111863 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:20:28.112251 [info ] [MainThread]: 
[0m12:20:28.112747 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:20:28.113807 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:20:28.114174 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:28.475027 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:20:28.475487 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:28.688869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BAF32D00>]}
[0m12:20:28.689376 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:28.694704 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m12:20:28.695185 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m12:20:28.695945 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_segmented_2023'
[0m12:20:28.696255 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m12:20:28.702649 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m12:20:28.703807 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m12:20:28.731393 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m12:20:28.732708 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

order_seg as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
)

select
  o.*,
  s.segment
from orders o
left join order_seg s on o.order_id = s.order_id;


[0m12:20:28.733204 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:20:29.391632 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:eaade5bb-6473-473a-bcf1-3ac9f48ae03f&page=queryresults
[0m12:20:29.450940 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:eaade5bb-6473-473a-bcf1-3ac9f48ae03f&page=queryresults
[0m12:20:29.457805 [debug] [Thread-1 (]: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:20:29.459631 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1285ab70-0bc5-452b-9663-67a32bbc653d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BAF67410>]}
[0m12:20:29.460319 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model raw.orders_segmented_2023 ................. [[31mERROR[0m in 0.76s]
[0m12:20:29.461221 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m12:20:29.461850 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.orders_segmented_2023' to be skipped because of status 'error'.  Reason: Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql.
[0m12:20:29.463813 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:29.465460 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:29.465733 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:20:29.465963 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:20:29.466172 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m12:20:29.466455 [info ] [MainThread]: 
[0m12:20:29.467436 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.35 seconds (1.35s).
[0m12:20:29.468486 [debug] [MainThread]: Command end result
[0m12:20:29.489652 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:20:29.491861 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:20:29.497378 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:20:29.497928 [info ] [MainThread]: 
[0m12:20:29.498517 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:20:29.498892 [info ] [MainThread]: 
[0m12:20:29.499489 [error] [MainThread]: [31mFailure in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)[0m
[0m12:20:29.500085 [error] [MainThread]:   Database Error in model orders_segmented_2023 (models\marts\orders_segmented_2023.sql)
  Name segment not found inside s at [17:5]
  compiled code at target\run\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:20:29.500598 [info ] [MainThread]: 
[0m12:20:29.501242 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\orders_segmented_2023.sql
[0m12:20:29.501654 [info ] [MainThread]: 
[0m12:20:29.502407 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:20:29.503796 [debug] [MainThread]: Command `dbt run` failed at 12:20:29.503638 after 5.28 seconds
[0m12:20:29.504185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BAF531D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A48A7A7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A4BAED0870>]}
[0m12:20:29.504533 [debug] [MainThread]: Flushing usage events
[0m12:20:29.896526 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:21:09.524738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB0F002510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB0CE6C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB11163ED0>]}


============================== 12:21:09.529288 | df31116d-eb78-44ca-97fe-aa7a34d89208 ==============================
[0m12:21:09.529288 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:21:09.530083 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select orders_segmented_2023', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:21:12.282532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB0F4EDA70>]}
[0m12:21:12.334371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3CB697B0>]}
[0m12:21:12.335074 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:21:12.812132 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:21:12.964963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:21:12.965602 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m12:21:13.185736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D036550>]}
[0m12:21:13.252180 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:21:13.254980 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:21:13.281485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3CB523F0>]}
[0m12:21:13.281972 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:21:13.282402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D319470>]}
[0m12:21:13.283828 [info ] [MainThread]: 
[0m12:21:13.284212 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:21:13.284514 [info ] [MainThread]: 
[0m12:21:13.284943 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:21:13.285957 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:21:13.286357 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:21:13.657237 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m12:21:13.657661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:21:13.874216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D2328F0>]}
[0m12:21:13.874720 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:21:13.879262 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m12:21:13.879725 [info ] [Thread-1 (]: 1 of 1 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m12:21:13.880314 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.orders_segmented_2023'
[0m12:21:13.880617 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m12:21:13.887037 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m12:21:13.888212 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m12:21:13.913377 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m12:21:13.914703 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

order_seg as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
)

select
  o.*,
  s.order_segment
from orders o
left join order_seg s on o.order_id = s.order_id;


[0m12:21:13.915207 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:21:14.472878 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:63b43aa7-4c75-471b-b91e-018e3f2afd38&page=queryresults
[0m12:21:14.757825 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df31116d-eb78-44ca-97fe-aa7a34d89208', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D266B10>]}
[0m12:21:14.758568 [info ] [Thread-1 (]: 1 of 1 OK created sql view model raw.orders_segmented_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m12:21:14.759713 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m12:21:14.761842 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:21:14.763365 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:21:14.763614 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:21:14.763807 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m12:21:14.764021 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m12:21:14.764322 [info ] [MainThread]: 
[0m12:21:14.765436 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.48 seconds (1.48s).
[0m12:21:14.766855 [debug] [MainThread]: Command end result
[0m12:21:14.783897 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:21:14.786943 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:21:14.792549 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:21:14.792905 [info ] [MainThread]: 
[0m12:21:14.793419 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:21:14.793830 [info ] [MainThread]: 
[0m12:21:14.794233 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:21:14.795106 [debug] [MainThread]: Command `dbt run` succeeded at 12:21:14.795010 after 5.40 seconds
[0m12:21:14.795381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D25F280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB0CAB7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DB3D2FB7F0>]}
[0m12:21:14.795670 [debug] [MainThread]: Flushing usage events
[0m12:21:15.236262 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:47:15.613712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200903A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002008E20C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200924FFED0>]}


============================== 15:47:15.617888 | 28a48adb-4ca5-446d-ba69-11a07ed9e032 ==============================
[0m15:47:15.617888 [info ] [MainThread]: Running with dbt=1.10.3
[0m15:47:15.618450 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:47:20.770457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020090889A70>]}
[0m15:47:20.826646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BCF497B0>]}
[0m15:47:20.827579 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m15:47:21.456908 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m15:47:22.586667 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:47:22.587059 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:47:22.618032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BE3E5150>]}
[0m15:47:22.699500 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m15:47:22.702606 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m15:47:22.729086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BCF323F0>]}
[0m15:47:22.729677 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m15:47:22.730099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BDFC2970>]}
[0m15:47:22.731817 [info ] [MainThread]: 
[0m15:47:22.732461 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:47:22.732777 [info ] [MainThread]: 
[0m15:47:22.733278 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:47:22.737435 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m15:47:22.738109 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:47:23.163216 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m15:47:23.163585 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:47:23.427429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BCF576C0>]}
[0m15:47:23.427883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:47:23.433116 [debug] [Thread-1 (]: Began running node model.astrafy_project.avg_products_per_order_2023
[0m15:47:23.433531 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.avg_products_per_order_2023 .................... [RUN]
[0m15:47:23.434238 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.avg_products_per_order_2023'
[0m15:47:23.434564 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.avg_products_per_order_2023
[0m15:47:23.442716 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.avg_products_per_order_2023"
[0m15:47:23.443884 [debug] [Thread-1 (]: Began executing node model.astrafy_project.avg_products_per_order_2023
[0m15:47:23.469311 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.avg_products_per_order_2023"
[0m15:47:23.470575 [debug] [Thread-1 (]: On model.astrafy_project.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.avg_products_per_order_2023"} */


  create or replace view `astrafy-464919`.`raw`.`avg_products_per_order_2023`
  OPTIONS()
  as select
  format_date('%B - %Y', date_trunc(cast(date_date as date), month)) as month_year,
  count(*) as total_products,
  count(distinct order_id) as total_orders,
  round(count(*) * 1.0 / count(distinct order_id), 2) as avg_products_per_order
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) = 2023
group by month_year, date_trunc(cast(date_date as date), month)
order by date_trunc(cast(date_date as date), month);


[0m15:47:23.471053 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:47:23.914310 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6c2d501c-349a-4614-9f22-a12cbe401b14&page=queryresults
[0m15:47:26.344255 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BE547710>]}
[0m15:47:26.345226 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.avg_products_per_order_2023 ............... [[32mCREATE VIEW (0 processed)[0m in 2.91s]
[0m15:47:26.346013 [debug] [Thread-1 (]: Finished running node model.astrafy_project.avg_products_per_order_2023
[0m15:47:26.346389 [debug] [Thread-1 (]: Began running node model.astrafy_project.order_segmentation
[0m15:47:26.346903 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.order_segmentation ............................. [RUN]
[0m15:47:26.347383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.avg_products_per_order_2023, now model.astrafy_project.order_segmentation)
[0m15:47:26.347663 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.order_segmentation
[0m15:47:26.349829 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.order_segmentation"
[0m15:47:26.350656 [debug] [Thread-1 (]: Began executing node model.astrafy_project.order_segmentation
[0m15:47:26.352951 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.order_segmentation"
[0m15:47:26.353724 [debug] [Thread-1 (]: On model.astrafy_project.order_segmentation: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.order_segmentation"} */


  create or replace view `astrafy-464919`.`raw`.`order_segmentation`
  OPTIONS()
  as with sales_orders as (
    select
        customer_id,
        order_id,
        date_date,

        countif(date_date < s.date_date and date_date >= date_sub(s.date_date, interval 12 month)) 
            over (partition by customer_id order by date_date rows between unbounded preceding and 1 preceding) as previous_12m_orders
    from `astrafy-464919`.`raw`.`sales_recrutement` as s
    where extract(year from date_date) = 2023
)

select
    order_id,
    customer_id,
    date_date,
    case
        when previous_12m_orders = 0 then 'new'
        when previous_12m_orders between 1 and 3 then 'returning'
        when previous_12m_orders >= 4 then 'vip'
        else 'unknown'
    end as order_segment
from sales_orders;


[0m15:47:26.354079 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:26.777141 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:73da3d6d-1f24-472b-98d9-dc4201222d22&page=queryresults
[0m15:47:26.920613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BE5C6E60>]}
[0m15:47:26.921252 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.order_segmentation ........................ [[32mCREATE VIEW (0 processed)[0m in 0.57s]
[0m15:47:26.921974 [debug] [Thread-1 (]: Finished running node model.astrafy_project.order_segmentation
[0m15:47:26.922292 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_per_month_2023
[0m15:47:26.922855 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.orders_per_month_2023 .......................... [RUN]
[0m15:47:26.923673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.order_segmentation, now model.astrafy_project.orders_per_month_2023)
[0m15:47:26.923969 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_per_month_2023
[0m15:47:26.926510 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_per_month_2023"
[0m15:47:26.927409 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_per_month_2023
[0m15:47:26.929872 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_per_month_2023"
[0m15:47:26.930585 [debug] [Thread-1 (]: On model.astrafy_project.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_per_month_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_per_month_2023`
  OPTIONS()
  as 

select
  extract(month from date_date) as month,
  count(distinct order_id) as orders_count
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023
group by month
order by month;


[0m15:47:26.930926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:27.293116 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:74cedc6e-7667-4816-b445-6ff0bf88d219&page=queryresults
[0m15:47:27.615069 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BEBB2530>]}
[0m15:47:27.615737 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.orders_per_month_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m15:47:27.616459 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_per_month_2023
[0m15:47:27.616786 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_with_products
[0m15:47:27.617273 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.orders_with_products ........................... [RUN]
[0m15:47:27.617770 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_per_month_2023, now model.astrafy_project.orders_with_products)
[0m15:47:27.618075 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_with_products
[0m15:47:27.620369 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_with_products"
[0m15:47:27.621329 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_with_products
[0m15:47:27.624034 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_with_products"
[0m15:47:27.625625 [debug] [Thread-1 (]: On model.astrafy_project.orders_with_products: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_with_products"} */


  create or replace view `astrafy-464919`.`raw`.`orders_with_products`
  OPTIONS()
  as select
  order_id,
  min(cast(date_date as date)) as order_date,
  min(customer_id) as customer_id,
  sum(qty) as qty_product
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from cast(date_date as date)) in (2022, 2023)
group by order_id;


[0m15:47:27.626279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:28.071811 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9b85780d-36a9-4812-a9e5-518a1cdd58c9&page=queryresults
[0m15:47:28.310554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002009031A250>]}
[0m15:47:28.311215 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.orders_with_products ...................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m15:47:28.312305 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_with_products
[0m15:47:28.312713 [debug] [Thread-1 (]: Began running node model.astrafy_project.total_orders_2023
[0m15:47:28.313190 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.total_orders_2023 .............................. [RUN]
[0m15:47:28.313754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.orders_with_products, now model.astrafy_project.total_orders_2023)
[0m15:47:28.314072 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.total_orders_2023
[0m15:47:28.316515 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.total_orders_2023"
[0m15:47:28.317437 [debug] [Thread-1 (]: Began executing node model.astrafy_project.total_orders_2023
[0m15:47:28.319695 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.total_orders_2023"
[0m15:47:28.320538 [debug] [Thread-1 (]: On model.astrafy_project.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.total_orders_2023"} */


  create or replace view `astrafy-464919`.`raw`.`total_orders_2023`
  OPTIONS()
  as -- by default materialized as a view


select
  count(distinct order_id) as order_count_2023
from `astrafy-464919`.`raw`.`sales_recrutement`
where extract(year from date_date) = 2023;


[0m15:47:28.320959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:28.749250 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:95da9332-fdf7-4647-b853-ba27f4c0a7b1&page=queryresults
[0m15:47:28.860980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BE5A8210>]}
[0m15:47:28.861607 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.total_orders_2023 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.55s]
[0m15:47:28.862410 [debug] [Thread-1 (]: Finished running node model.astrafy_project.total_orders_2023
[0m15:47:28.863001 [debug] [Thread-1 (]: Began running node model.astrafy_project.orders_segmented_2023
[0m15:47:28.863689 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.orders_segmented_2023 .......................... [RUN]
[0m15:47:28.864356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.total_orders_2023, now model.astrafy_project.orders_segmented_2023)
[0m15:47:28.864800 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.orders_segmented_2023
[0m15:47:28.868238 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.orders_segmented_2023"
[0m15:47:28.869388 [debug] [Thread-1 (]: Began executing node model.astrafy_project.orders_segmented_2023
[0m15:47:28.872146 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.orders_segmented_2023"
[0m15:47:28.873586 [debug] [Thread-1 (]: On model.astrafy_project.orders_segmented_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.orders_segmented_2023"} */


  create or replace view `astrafy-464919`.`raw`.`orders_segmented_2023`
  OPTIONS()
  as with orders as (
  select * from `astrafy-464919`.`raw`.`sales_recrutement`
  where extract(year from date_date) in (2022, 2023)
),

order_seg as (
  select * from `astrafy-464919`.`raw`.`order_segmentation`
)

select
  o.*,
  s.order_segment
from orders o
left join order_seg s on o.order_id = s.order_id;


[0m15:47:28.874019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:29.401058 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:31ffe332-7516-4ee8-9923-2d0f01edc687&page=queryresults
[0m15:47:29.554295 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a48adb-4ca5-446d-ba69-11a07ed9e032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BEC2DBB0>]}
[0m15:47:29.554886 [info ] [Thread-1 (]: 6 of 6 OK created sql view model raw.orders_segmented_2023 ..................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m15:47:29.555624 [debug] [Thread-1 (]: Finished running node model.astrafy_project.orders_segmented_2023
[0m15:47:29.557028 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:47:29.558584 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:47:29.558819 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m15:47:29.559029 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m15:47:29.559224 [debug] [MainThread]: Connection 'model.astrafy_project.orders_segmented_2023' was properly closed.
[0m15:47:29.559493 [info ] [MainThread]: 
[0m15:47:29.559956 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 6.83 seconds (6.83s).
[0m15:47:29.561334 [debug] [MainThread]: Command end result
[0m15:47:29.583495 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m15:47:29.585741 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m15:47:29.592247 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m15:47:29.592639 [info ] [MainThread]: 
[0m15:47:29.593226 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:47:29.593653 [info ] [MainThread]: 
[0m15:47:29.594091 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m15:47:29.594987 [debug] [MainThread]: Command `dbt run` succeeded at 15:47:29.594886 after 14.16 seconds
[0m15:47:29.595323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BE53FCB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BEC2FF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000200BEC2E9F0>]}
[0m15:47:29.595660 [debug] [MainThread]: Flushing usage events
[0m15:47:30.064777 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:54:45.333235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FD5D02510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FD3B5C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FD7E63ED0>]}


============================== 15:54:45.337268 | e18735ba-3b3a-40cc-b6c5-f531d1defb63 ==============================
[0m15:54:45.337268 [info ] [MainThread]: Running with dbt=1.10.3
[0m15:54:45.337850 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select excercise3', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:54:47.986546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e18735ba-3b3a-40cc-b6c5-f531d1defb63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FD61EDA70>]}
[0m15:54:48.036172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e18735ba-3b3a-40cc-b6c5-f531d1defb63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F839697B0>]}
[0m15:54:48.036837 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m15:54:48.483407 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m15:54:48.626432 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 6 files added, 0 files changed.
[0m15:54:48.626900 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice6.sql
[0m15:54:48.627182 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice3.sql
[0m15:54:48.627428 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice2.sql
[0m15:54:48.627650 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice4.sql
[0m15:54:48.627870 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice1.sql
[0m15:54:48.628082 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice5.sql
[0m15:54:48.628284 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\avg_products_per_order_2023.sql
[0m15:54:48.628478 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_with_products.sql
[0m15:54:48.628655 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m15:54:48.628836 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\total_orders_2023.sql
[0m15:54:48.629022 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\order_segmentation.sql
[0m15:54:48.629257 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m15:54:48.793762 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.astrafy_project.exercice6' (models\marts\exercice6.sql) depends on a node named 'order_segmentation' which was not found
[0m15:54:48.795209 [debug] [MainThread]: Command `dbt run` failed at 15:54:48.795083 after 3.58 seconds
[0m15:54:48.795516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F83933450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020F83E39F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020FD6D298B0>]}
[0m15:54:48.795814 [debug] [MainThread]: Flushing usage events
[0m15:54:49.225037 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m15:58:37.324824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D155DB2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D153C0C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D157F13ED0>]}


============================== 15:58:37.329160 | a1f345e1-e50f-497c-ad47-2fbf00017ddf ==============================
[0m15:58:37.329160 [info ] [MainThread]: Running with dbt=1.10.3
[0m15:58:37.329848 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:58:39.899971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D15629DA70>]}
[0m15:58:39.949459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1039697B0>]}
[0m15:58:39.950186 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m15:58:40.422316 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m15:58:40.570640 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 6 files added, 0 files changed.
[0m15:58:40.571132 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice6.sql
[0m15:58:40.571433 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice5.sql
[0m15:58:40.571658 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice3.sql
[0m15:58:40.571872 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice2.sql
[0m15:58:40.572100 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice1.sql
[0m15:58:40.572314 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercice4.sql
[0m15:58:40.572558 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_per_month_2023.sql
[0m15:58:40.572752 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\total_orders_2023.sql
[0m15:58:40.572936 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_with_products.sql
[0m15:58:40.573111 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\avg_products_per_order_2023.sql
[0m15:58:40.573292 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\order_segmentation.sql
[0m15:58:40.573476 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\orders_segmented_2023.sql
[0m15:58:40.812290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D103E34E50>]}
[0m15:58:40.874348 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m15:58:40.876442 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m15:58:40.902032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1039523F0>]}
[0m15:58:40.902517 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m15:58:40.902999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D103FFD2B0>]}
[0m15:58:40.904652 [info ] [MainThread]: 
[0m15:58:40.905036 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:58:40.905340 [info ] [MainThread]: 
[0m15:58:40.905781 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m15:58:40.909655 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m15:58:40.910060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:58:41.293224 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m15:58:41.293644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:58:41.544070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D10402EF70>]}
[0m15:58:41.544545 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:58:41.549776 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice1
[0m15:58:41.550174 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.exercice1 ...................................... [RUN]
[0m15:58:41.551100 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercice1'
[0m15:58:41.551378 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice1
[0m15:58:41.556874 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice1"
[0m15:58:41.557807 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice1
[0m15:58:41.582219 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice1"
[0m15:58:41.583424 [debug] [Thread-1 (]: On model.astrafy_project.exercice1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice1"} */


  create or replace view `astrafy-464919`.`raw`.`exercice1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m15:58:41.583870 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:58:42.058352 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:1ebb529e-7102-40dd-a5e8-a306d512a95e&page=queryresults
[0m15:58:42.321872 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1040CF050>]}
[0m15:58:42.322661 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.exercice1 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.77s]
[0m15:58:42.323573 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice1
[0m15:58:42.323926 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice2
[0m15:58:42.325031 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.exercice2 ...................................... [RUN]
[0m15:58:42.326379 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice1, now model.astrafy_project.exercice2)
[0m15:58:42.326753 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice2
[0m15:58:42.329635 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice2"
[0m15:58:42.330723 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice2
[0m15:58:42.334382 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice2"
[0m15:58:42.335493 [debug] [Thread-1 (]: On model.astrafy_project.exercice2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice2"} */


  create or replace view `astrafy-464919`.`raw`.`exercice2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m15:58:42.335877 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:58:42.752563 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c7280c8b-0db1-47a9-9a86-d82a8de938e9&page=queryresults
[0m15:58:42.922272 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D104800470>]}
[0m15:58:42.922910 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.exercice2 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.60s]
[0m15:58:42.923813 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice2
[0m15:58:42.924122 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice3
[0m15:58:42.924535 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.exercice3 ...................................... [RUN]
[0m15:58:42.925198 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice2, now model.astrafy_project.exercice3)
[0m15:58:42.925718 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice3
[0m15:58:42.927794 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice3"
[0m15:58:42.928703 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice3
[0m15:58:42.930515 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice3"
[0m15:58:42.931293 [debug] [Thread-1 (]: On model.astrafy_project.exercice3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice3"} */


  create or replace view `astrafy-464919`.`raw`.`exercice3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CASTcast(date_date AS DATE), MONTH);


[0m15:58:42.931663 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:58:43.321077 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c91cd481-6741-476c-883b-00ba689659e6&page=queryresults
[0m15:58:43.384733 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c91cd481-6741-476c-883b-00ba689659e6&page=queryresults
[0m15:58:43.481426 [debug] [Thread-1 (]: Database Error in model exercice3 (models\marts\exercice3.sql)
  Function not found: CASTcast at [14:21]
  compiled code at target\run\astrafy_project\models\marts\exercice3.sql
[0m15:58:43.481944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1047EA670>]}
[0m15:58:43.482536 [error] [Thread-1 (]: 3 of 6 ERROR creating sql view model raw.exercice3 ............................. [[31mERROR[0m in 0.56s]
[0m15:58:43.483406 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice3
[0m15:58:43.483780 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice4
[0m15:58:43.484728 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice3' to be skipped because of status 'error'.  Reason: Database Error in model exercice3 (models\marts\exercice3.sql)
  Function not found: CASTcast at [14:21]
  compiled code at target\run\astrafy_project\models\marts\exercice3.sql.
[0m15:58:43.484142 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.exercice4 ...................................... [RUN]
[0m15:58:43.485999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice3, now model.astrafy_project.exercice4)
[0m15:58:43.486318 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice4
[0m15:58:43.488242 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice4"
[0m15:58:43.489110 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice4
[0m15:58:43.490842 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice4"
[0m15:58:43.491720 [debug] [Thread-1 (]: On model.astrafy_project.exercice4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice4"} */


  create or replace view `astrafy-464919`.`raw`.`exercice4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m15:58:43.492218 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:58:43.835958 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:93592dec-aecf-445a-9e0d-82433e98ff0d&page=queryresults
[0m15:58:44.104442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1049064D0>]}
[0m15:58:44.105090 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.exercice4 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.62s]
[0m15:58:44.105931 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice4
[0m15:58:44.106274 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice5
[0m15:58:44.106589 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.exercice5 ...................................... [RUN]
[0m15:58:44.107283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice4, now model.astrafy_project.exercice5)
[0m15:58:44.107641 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice5
[0m15:58:44.111299 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:58:44.147634 [debug] [Thread-1 (]: Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m15:58:44.148172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D103FBE6D0>]}
[0m15:58:44.148721 [error] [Thread-1 (]: 5 of 6 ERROR creating sql view model raw.exercice5 ............................. [[31mERROR[0m in 0.04s]
[0m15:58:44.149547 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice5
[0m15:58:44.149900 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice6
[0m15:58:44.150310 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.exercice6 ...................................... [RUN]
[0m15:58:44.150982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice5, now model.astrafy_project.exercice6)
[0m15:58:44.151447 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice5' to be skipped because of status 'error'.  Reason: Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m15:58:44.151757 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice6
[0m15:58:44.154451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:58:44.157673 [debug] [Thread-1 (]: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m15:58:44.158097 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1f345e1-e50f-497c-ad47-2fbf00017ddf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D104954E90>]}
[0m15:58:44.158631 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.exercice6 ............................. [[31mERROR[0m in 0.01s]
[0m15:58:44.159440 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice6
[0m15:58:44.159991 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice6' to be skipped because of status 'error'.  Reason: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m15:58:44.161914 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m15:58:44.163710 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:58:44.163960 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m15:58:44.164181 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m15:58:44.164386 [debug] [MainThread]: Connection 'model.astrafy_project.exercice6' was properly closed.
[0m15:58:44.164674 [info ] [MainThread]: 
[0m15:58:44.165144 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.26 seconds (3.26s).
[0m15:58:44.166334 [debug] [MainThread]: Command end result
[0m15:58:44.184157 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m15:58:44.186428 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m15:58:44.191745 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m15:58:44.192371 [info ] [MainThread]: 
[0m15:58:44.192885 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m15:58:44.193307 [info ] [MainThread]: 
[0m15:58:44.193754 [error] [MainThread]: [31mFailure in model exercice3 (models\marts\exercice3.sql)[0m
[0m15:58:44.194188 [error] [MainThread]:   Database Error in model exercice3 (models\marts\exercice3.sql)
  Function not found: CASTcast at [14:21]
  compiled code at target\run\astrafy_project\models\marts\exercice3.sql
[0m15:58:44.194590 [info ] [MainThread]: 
[0m15:58:44.194943 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercice3.sql
[0m15:58:44.195243 [info ] [MainThread]: 
[0m15:58:44.195610 [error] [MainThread]: [31mFailure in model exercice5 (models\marts\exercice5.sql)[0m
[0m15:58:44.195941 [error] [MainThread]:   Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m15:58:44.196275 [info ] [MainThread]: 
[0m15:58:44.196644 [error] [MainThread]: [31mFailure in model exercice6 (models\marts\exercice6.sql)[0m
[0m15:58:44.196959 [error] [MainThread]:   Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m15:58:44.197239 [info ] [MainThread]: 
[0m15:58:44.197528 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=0 NO-OP=0 TOTAL=6
[0m15:58:44.198364 [debug] [MainThread]: Command `dbt run` failed at 15:58:44.198268 after 6.99 seconds
[0m15:58:44.198660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D103AE5730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D103A87890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D1048BE990>]}
[0m15:58:44.198945 [debug] [MainThread]: Flushing usage events
[0m15:58:44.743806 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:00:45.283277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F8152510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F5FBC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8FA2B3ED0>]}


============================== 16:00:45.287191 | a85dd39b-2308-4e89-93cc-d0783eb59aa2 ==============================
[0m16:00:45.287191 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:00:45.287802 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:00:47.857375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F863DA70>]}
[0m16:00:47.909635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A5DA97B0>]}
[0m16:00:47.910359 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:00:48.362035 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:00:48.504445 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:00:48.504951 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercice3.sql
[0m16:00:48.717579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6276550>]}
[0m16:00:48.779135 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:00:48.781517 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:00:48.807278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A5D923F0>]}
[0m16:00:48.807727 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:00:48.808128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A654D630>]}
[0m16:00:48.809604 [info ] [MainThread]: 
[0m16:00:48.809997 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:00:48.810285 [info ] [MainThread]: 
[0m16:00:48.810717 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:00:48.814319 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:00:48.814683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:00:49.220922 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m16:00:49.221329 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:00:49.455867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A64729C0>]}
[0m16:00:49.456262 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:00:49.462304 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice1
[0m16:00:49.462735 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.exercice1 ...................................... [RUN]
[0m16:00:49.464156 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercice1'
[0m16:00:49.464512 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice1
[0m16:00:49.470064 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice1"
[0m16:00:49.470964 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice1
[0m16:00:49.495854 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice1"
[0m16:00:49.496897 [debug] [Thread-1 (]: On model.astrafy_project.exercice1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice1"} */


  create or replace view `astrafy-464919`.`raw`.`exercice1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:00:49.497276 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:00:49.985516 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:dc7abed3-01c1-489d-947e-ab5a12a5d47c&page=queryresults
[0m16:00:50.270922 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A64A6C90>]}
[0m16:00:50.271503 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.exercice1 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.81s]
[0m16:00:50.272703 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice1
[0m16:00:50.273187 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice2
[0m16:00:50.273862 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.exercice2 ...................................... [RUN]
[0m16:00:50.274414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice1, now model.astrafy_project.exercice2)
[0m16:00:50.274695 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice2
[0m16:00:50.276956 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice2"
[0m16:00:50.277729 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice2
[0m16:00:50.280093 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice2"
[0m16:00:50.281090 [debug] [Thread-1 (]: On model.astrafy_project.exercice2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice2"} */


  create or replace view `astrafy-464919`.`raw`.`exercice2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:00:50.281497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:00:50.637782 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:a1bd0bf2-b87f-41b1-b852-ea040e1851a7&page=queryresults
[0m16:00:50.795195 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6C34520>]}
[0m16:00:50.795750 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.exercice2 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m16:00:50.796808 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice2
[0m16:00:50.797106 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice3
[0m16:00:50.797430 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.exercice3 ...................................... [RUN]
[0m16:00:50.798150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice2, now model.astrafy_project.exercice3)
[0m16:00:50.798899 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice3
[0m16:00:50.801059 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice3"
[0m16:00:50.801835 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice3
[0m16:00:50.803707 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice3"
[0m16:00:50.804384 [debug] [Thread-1 (]: On model.astrafy_project.exercice3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice3"} */


  create or replace view `astrafy-464919`.`raw`.`exercice3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m16:00:50.804691 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:00:51.160149 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:d45bae70-9ebb-4fbb-befd-96a32b76a20c&page=queryresults
[0m16:00:51.308428 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6BB7CF0>]}
[0m16:00:51.309056 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.exercice3 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.51s]
[0m16:00:51.310089 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice3
[0m16:00:51.310471 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice4
[0m16:00:51.310813 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.exercice4 ...................................... [RUN]
[0m16:00:51.311368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice3, now model.astrafy_project.exercice4)
[0m16:00:51.311694 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice4
[0m16:00:51.313675 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice4"
[0m16:00:51.314425 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice4
[0m16:00:51.316535 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice4"
[0m16:00:51.317497 [debug] [Thread-1 (]: On model.astrafy_project.exercice4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice4"} */


  create or replace view `astrafy-464919`.`raw`.`exercice4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m16:00:51.317853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:00:51.667699 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0c3447cd-3cc0-4b1e-a3e0-196e7c4c933c&page=queryresults
[0m16:00:51.851628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6BF80D0>]}
[0m16:00:51.852181 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.exercice4 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.54s]
[0m16:00:51.852939 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice4
[0m16:00:51.853282 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice5
[0m16:00:51.853619 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.exercice5 ...................................... [RUN]
[0m16:00:51.854228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice4, now model.astrafy_project.exercice5)
[0m16:00:51.854569 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice5
[0m16:00:51.857607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:00:51.862592 [debug] [Thread-1 (]: Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:00:51.863004 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6599240>]}
[0m16:00:51.863520 [error] [Thread-1 (]: 5 of 6 ERROR creating sql view model raw.exercice5 ............................. [[31mERROR[0m in 0.01s]
[0m16:00:51.864258 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice5
[0m16:00:51.864810 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice6
[0m16:00:51.865705 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice5' to be skipped because of status 'error'.  Reason: Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m16:00:51.865176 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.exercice6 ...................................... [RUN]
[0m16:00:51.866733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice5, now model.astrafy_project.exercice6)
[0m16:00:51.866990 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice6
[0m16:00:51.869024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:00:51.873184 [debug] [Thread-1 (]: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:00:51.873725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a85dd39b-2308-4e89-93cc-d0783eb59aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6D3C950>]}
[0m16:00:51.874321 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.exercice6 ............................. [[31mERROR[0m in 0.01s]
[0m16:00:51.875007 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice6
[0m16:00:51.875410 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice6' to be skipped because of status 'error'.  Reason: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m16:00:51.877028 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:00:51.878507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:00:51.878750 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:00:51.878959 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m16:00:51.879144 [debug] [MainThread]: Connection 'model.astrafy_project.exercice6' was properly closed.
[0m16:00:51.879457 [info ] [MainThread]: 
[0m16:00:51.879910 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.07 seconds (3.07s).
[0m16:00:51.881115 [debug] [MainThread]: Command end result
[0m16:00:51.898980 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:00:51.901202 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:00:51.906490 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:00:51.906804 [info ] [MainThread]: 
[0m16:00:51.907375 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m16:00:51.908026 [info ] [MainThread]: 
[0m16:00:51.908516 [error] [MainThread]: [31mFailure in model exercice5 (models\marts\exercice5.sql)[0m
[0m16:00:51.909006 [error] [MainThread]:   Compilation Error in model exercice5 (models\marts\exercice5.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:00:51.909739 [info ] [MainThread]: 
[0m16:00:51.910158 [error] [MainThread]: [31mFailure in model exercice6 (models\marts\exercice6.sql)[0m
[0m16:00:51.910579 [error] [MainThread]:   Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'SOURCE' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:00:51.910887 [info ] [MainThread]: 
[0m16:00:51.911185 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=0 NO-OP=0 TOTAL=6
[0m16:00:51.912044 [debug] [MainThread]: Command `dbt run` failed at 16:00:51.911926 after 6.75 seconds
[0m16:00:51.912357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6C11F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6C112B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8A6C10E30>]}
[0m16:00:51.912653 [debug] [MainThread]: Flushing usage events
[0m16:00:52.422338 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:01:44.738635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B38B12510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B3696C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B3AC73ED0>]}


============================== 16:01:44.742700 | a061a83e-4c64-4410-bf5c-af0f0d30d8b4 ==============================
[0m16:01:44.742700 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:01:44.743274 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:01:47.471393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B38FFDA70>]}
[0m16:01:47.524365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B666897B0>]}
[0m16:01:47.525068 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:01:47.993758 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:01:48.143226 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m16:01:48.143766 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercice6.sql
[0m16:01:48.144100 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercice5.sql
[0m16:01:48.363075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B66B5A550>]}
[0m16:01:48.424550 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:01:48.426786 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:01:48.452648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B666723F0>]}
[0m16:01:48.453120 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:01:48.453605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B66E41470>]}
[0m16:01:48.455166 [info ] [MainThread]: 
[0m16:01:48.455610 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:01:48.455991 [info ] [MainThread]: 
[0m16:01:48.456511 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:01:48.460285 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:01:48.460720 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:48.824414 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m16:01:48.825073 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:49.026452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B66D536C0>]}
[0m16:01:49.026855 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:01:49.032569 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice1
[0m16:01:49.033010 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.exercice1 ...................................... [RUN]
[0m16:01:49.033813 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercice1'
[0m16:01:49.034098 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice1
[0m16:01:49.040075 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice1"
[0m16:01:49.040979 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice1
[0m16:01:49.064906 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice1"
[0m16:01:49.066157 [debug] [Thread-1 (]: On model.astrafy_project.exercice1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice1"} */


  create or replace view `astrafy-464919`.`raw`.`exercice1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:01:49.066680 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:01:49.473887 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7805f32c-6b8f-4d48-99cb-375e01b25054&page=queryresults
[0m16:01:49.777731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B66DEF350>]}
[0m16:01:49.778513 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.exercice1 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.74s]
[0m16:01:49.779783 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice1
[0m16:01:49.780139 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice2
[0m16:01:49.780463 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.exercice2 ...................................... [RUN]
[0m16:01:49.781185 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice1, now model.astrafy_project.exercice2)
[0m16:01:49.781527 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice2
[0m16:01:49.783630 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice2"
[0m16:01:49.784441 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice2
[0m16:01:49.786686 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice2"
[0m16:01:49.787401 [debug] [Thread-1 (]: On model.astrafy_project.exercice2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice2"} */


  create or replace view `astrafy-464919`.`raw`.`exercice2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:01:49.787814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:50.144289 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:a10fa59b-604d-44f8-a584-af682f8de6aa&page=queryresults
[0m16:01:50.293384 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B674D85D0>]}
[0m16:01:50.293964 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.exercice2 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.51s]
[0m16:01:50.294665 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice2
[0m16:01:50.294985 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice3
[0m16:01:50.295316 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.exercice3 ...................................... [RUN]
[0m16:01:50.295752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice2, now model.astrafy_project.exercice3)
[0m16:01:50.296025 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice3
[0m16:01:50.297929 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice3"
[0m16:01:50.298663 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice3
[0m16:01:50.300333 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice3"
[0m16:01:50.301061 [debug] [Thread-1 (]: On model.astrafy_project.exercice3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice3"} */


  create or replace view `astrafy-464919`.`raw`.`exercice3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m16:01:50.301427 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:50.620010 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:63d9a2a7-b9e0-4faa-8f9a-7b9d578ff63c&page=queryresults
[0m16:01:50.826280 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B38F7BA70>]}
[0m16:01:50.826864 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.exercice3 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.53s]
[0m16:01:50.827646 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice3
[0m16:01:50.827940 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice4
[0m16:01:50.828295 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.exercice4 ...................................... [RUN]
[0m16:01:50.828828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice3, now model.astrafy_project.exercice4)
[0m16:01:50.829109 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice4
[0m16:01:50.831059 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice4"
[0m16:01:50.831854 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice4
[0m16:01:50.833594 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice4"
[0m16:01:50.834316 [debug] [Thread-1 (]: On model.astrafy_project.exercice4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice4"} */


  create or replace view `astrafy-464919`.`raw`.`exercice4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m16:01:50.834789 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:51.232550 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6f749493-dcc7-468c-b209-3f1cdeb453ca&page=queryresults
[0m16:01:51.369604 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B673BB5D0>]}
[0m16:01:51.370159 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.exercice4 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.54s]
[0m16:01:51.371081 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice4
[0m16:01:51.371391 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice5
[0m16:01:51.371857 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.exercice5 ...................................... [RUN]
[0m16:01:51.372627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice4, now model.astrafy_project.exercice5)
[0m16:01:51.372898 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice5
[0m16:01:51.375152 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercice5"
[0m16:01:51.376247 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercice5
[0m16:01:51.378054 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercice5"
[0m16:01:51.378948 [debug] [Thread-1 (]: On model.astrafy_project.exercice5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercice5"} */


  create or replace view `astrafy-464919`.`raw`.`exercice5`
  OPTIONS()
  as WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM `astrafy-464919`.`raw`.`sales_recrutement` AS s
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m16:01:51.379317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:51.794335 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9c9783ec-27af-4129-a29e-ae6442c284b9&page=queryresults
[0m16:01:51.895570 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B67576DD0>]}
[0m16:01:51.896190 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.exercice5 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m16:01:51.897131 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice5
[0m16:01:51.897440 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercice6
[0m16:01:51.897783 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.exercice6 ...................................... [RUN]
[0m16:01:51.898357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercice5, now model.astrafy_project.exercice6)
[0m16:01:51.898651 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercice6
[0m16:01:51.902983 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:51.907710 [debug] [Thread-1 (]: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'REF' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:01:51.908091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a061a83e-4c64-4410-bf5c-af0f0d30d8b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B67594E30>]}
[0m16:01:51.908607 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model raw.exercice6 ............................. [[31mERROR[0m in 0.01s]
[0m16:01:51.909228 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercice6
[0m16:01:51.909682 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercice6' to be skipped because of status 'error'.  Reason: Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'REF' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m16:01:51.911591 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:01:51.913142 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:01:51.913546 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:01:51.913741 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m16:01:51.913914 [debug] [MainThread]: Connection 'model.astrafy_project.exercice6' was properly closed.
[0m16:01:51.914171 [info ] [MainThread]: 
[0m16:01:51.915171 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.46 seconds (3.46s).
[0m16:01:51.917283 [debug] [MainThread]: Command end result
[0m16:01:51.934252 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:01:51.936438 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:01:51.941536 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:01:51.941820 [info ] [MainThread]: 
[0m16:01:51.942336 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m16:01:51.942757 [info ] [MainThread]: 
[0m16:01:51.943288 [error] [MainThread]: [31mFailure in model exercice6 (models\marts\exercice6.sql)[0m
[0m16:01:51.943749 [error] [MainThread]:   Compilation Error in model exercice6 (models\marts\exercice6.sql)
  'REF' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:01:51.944304 [info ] [MainThread]: 
[0m16:01:51.944603 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=6
[0m16:01:51.945562 [debug] [MainThread]: Command `dbt run` failed at 16:01:51.945445 after 7.33 seconds
[0m16:01:51.945881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B675AA9F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B675DFB90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000012B675DFD10>]}
[0m16:01:51.946172 [debug] [MainThread]: Flushing usage events
[0m16:01:52.427168 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:02:05.934904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022198432510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002219629C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002219A58FED0>]}


============================== 16:02:05.939131 | 800b9bc3-4552-49e2-882e-b2b2cfbd7296 ==============================
[0m16:02:05.939131 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:02:05.939816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:02:08.498897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '800b9bc3-4552-49e2-882e-b2b2cfbd7296', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002219891DA70>]}
[0m16:02:08.550055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '800b9bc3-4552-49e2-882e-b2b2cfbd7296', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221C5FE97B0>]}
[0m16:02:08.550718 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:02:09.016616 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:02:09.158781 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:02:09.159341 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercice6.sql
[0m16:02:09.313826 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.astrafy_project.exercice6' (models\marts\exercice6.sql) depends on a node named 'excercise5' which was not found
[0m16:02:09.315256 [debug] [MainThread]: Command `dbt run` failed at 16:02:09.315136 after 3.49 seconds
[0m16:02:09.315843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221C5FB3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221C64B9350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221C64B2D50>]}
[0m16:02:09.316328 [debug] [MainThread]: Flushing usage events
[0m16:02:09.767247 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:02:53.227062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0705E2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B06E44C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B07273FED0>]}


============================== 16:02:53.231016 | a733904d-e64c-4f25-a2b0-d3763a1b7181 ==============================
[0m16:02:53.231016 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:02:53.231586 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:02:55.779997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a733904d-e64c-4f25-a2b0-d3763a1b7181', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B070ACDA70>]}
[0m16:02:55.829887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a733904d-e64c-4f25-a2b0-d3763a1b7181', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B01EFF97B0>]}
[0m16:02:55.830569 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:02:56.298990 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:02:56.434213 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:02:56.434744 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercice6.sql
[0m16:02:56.597185 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.astrafy_project.exercice6' (models\marts\exercice6.sql) depends on a node named 'exercise5' which was not found
[0m16:02:56.598833 [debug] [MainThread]: Command `dbt run` failed at 16:02:56.598694 after 3.49 seconds
[0m16:02:56.599205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B01EFC3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B01F4C5350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B01F4BED50>]}
[0m16:02:56.599506 [debug] [MainThread]: Flushing usage events
[0m16:02:57.047056 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:04:02.896245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FC4BB2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FC2A0C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FC5D3FED0>]}


============================== 16:04:02.900580 | 6af6fa6d-f17b-471e-8fa7-8d79a2e044c8 ==============================
[0m16:04:02.900580 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:04:02.901192 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:04:05.555533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FC509DA70>]}
[0m16:04:05.607206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF27297B0>]}
[0m16:04:05.607945 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:04:06.069130 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:04:06.198172 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 6 files added, 0 files changed.
[0m16:04:06.198824 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise3.sql
[0m16:04:06.199109 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise1.sql
[0m16:04:06.199352 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise2.sql
[0m16:04:06.199571 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise4.sql
[0m16:04:06.199782 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise5.sql
[0m16:04:06.199994 [debug] [MainThread]: Partial parsing: added file: astrafy_project://models\marts\exercise6.sql
[0m16:04:06.200195 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice1.sql
[0m16:04:06.200376 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice3.sql
[0m16:04:06.200614 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice5.sql
[0m16:04:06.200823 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice6.sql
[0m16:04:06.201002 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice4.sql
[0m16:04:06.201183 [debug] [MainThread]: Partial parsing: deleted file: astrafy_project://models\marts\exercice2.sql
[0m16:04:06.423994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF2BF6350>]}
[0m16:04:06.484565 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:04:06.486686 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:04:06.512662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF27123F0>]}
[0m16:04:06.513111 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:04:06.513535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF2DFC670>]}
[0m16:04:06.515068 [info ] [MainThread]: 
[0m16:04:06.515448 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:04:06.515722 [info ] [MainThread]: 
[0m16:04:06.516134 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:04:06.519597 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:04:06.519946 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:04:06.920802 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw'
[0m16:04:06.921305 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:04:07.142121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF2DEEB60>]}
[0m16:04:07.142548 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:04:07.147981 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:04:07.148414 [info ] [Thread-1 (]: 1 of 6 START sql view model raw.exercise1 ...................................... [RUN]
[0m16:04:07.149041 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:04:07.149437 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:04:07.155080 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:04:07.155989 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:04:07.181621 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:04:07.182712 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`raw`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:04:07.183117 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:04:07.564428 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9c68d442-cf4f-4fa4-a6a8-e3c1531cd041&page=queryresults
[0m16:04:07.873210 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF2E8B290>]}
[0m16:04:07.873803 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw.exercise1 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.72s]
[0m16:04:07.874744 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:04:07.875330 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:04:07.875665 [info ] [Thread-1 (]: 2 of 6 START sql view model raw.exercise2 ...................................... [RUN]
[0m16:04:07.876219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:04:07.876498 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:04:07.878605 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:04:07.879506 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:04:07.881804 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:04:07.882838 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`raw`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:04:07.883368 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:08.207439 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:645b17e5-9cd7-4928-a5cf-ff5f3beca65b&page=queryresults
[0m16:04:08.439175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF3580890>]}
[0m16:04:08.439915 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw.exercise2 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.56s]
[0m16:04:08.441491 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:04:08.441825 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:04:08.442185 [info ] [Thread-1 (]: 3 of 6 START sql view model raw.exercise3 ...................................... [RUN]
[0m16:04:08.442840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:04:08.443126 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:04:08.445147 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:04:08.446095 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:04:08.448055 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m16:04:08.448873 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`raw`.`exercise3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m16:04:08.449238 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:08.839948 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8c693be6-3c0f-49f9-a94a-ac1dec45e130&page=queryresults
[0m16:04:08.986854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF355E490>]}
[0m16:04:08.987430 [info ] [Thread-1 (]: 3 of 6 OK created sql view model raw.exercise3 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.54s]
[0m16:04:08.988276 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:04:08.988678 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:04:08.989172 [info ] [Thread-1 (]: 4 of 6 START sql view model raw.exercise4 ...................................... [RUN]
[0m16:04:08.989886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:04:08.990190 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:04:08.992574 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:04:08.993668 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:04:08.995608 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:04:08.996400 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`raw`.`exercise4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m16:04:08.996711 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:09.357098 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:92ffdfd7-8865-4fac-b53f-85cc89645071&page=queryresults
[0m16:04:09.507167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF2E96250>]}
[0m16:04:09.507760 [info ] [Thread-1 (]: 4 of 6 OK created sql view model raw.exercise4 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m16:04:09.508711 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:04:09.509132 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:04:09.509633 [info ] [Thread-1 (]: 5 of 6 START sql view model raw.exercise5 ...................................... [RUN]
[0m16:04:09.510194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:04:09.510489 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:04:09.513076 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:04:09.513982 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:04:09.515768 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m16:04:09.516572 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`raw`.`exercise5`
  OPTIONS()
  as WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM `astrafy-464919`.`raw`.`sales_recrutement` AS s
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m16:04:09.516933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:09.831115 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:74ede41d-1e85-4cae-954f-a483c59c8841&page=queryresults
[0m16:04:09.995362 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FC56E92B0>]}
[0m16:04:09.996043 [info ] [Thread-1 (]: 5 of 6 OK created sql view model raw.exercise5 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.49s]
[0m16:04:09.997198 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:04:09.998088 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:04:09.998686 [info ] [Thread-1 (]: 6 of 6 START sql view model raw.exercise6 ...................................... [RUN]
[0m16:04:09.999285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.exercise6)
[0m16:04:09.999598 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise6
[0m16:04:10.002246 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise6"
[0m16:04:10.003137 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise6
[0m16:04:10.005132 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise6"
[0m16:04:10.005967 [debug] [Thread-1 (]: On model.astrafy_project.exercise6: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise6"} */


  create or replace view `astrafy-464919`.`raw`.`exercise6`
  OPTIONS()
  as WITH orders AS (
  SELECT * FROM `astrafy-464919`.`raw`.`sales_recrutement`
  WHERE EXTRACT(YEAR FROM date_date) IN (2022, 2023)
),

order_seg AS (
  SELECT * FROM `astrafy-464919`.`raw`.`exercise5`
)

SELECT
  o.*,
  s.order_segment
FROM orders o
LEFT JOIN order_seg s ON o.order_id = s.order_id;


[0m16:04:10.006286 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:10.612791 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:a13b78ee-8096-4676-a8e2-b9ebf59271dd&page=queryresults
[0m16:04:10.804900 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6af6fa6d-f17b-471e-8fa7-8d79a2e044c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF3517710>]}
[0m16:04:10.805466 [info ] [Thread-1 (]: 6 of 6 OK created sql view model raw.exercise6 ................................. [[32mCREATE VIEW (0 processed)[0m in 0.81s]
[0m16:04:10.806218 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:04:10.808168 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:04:10.809612 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:04:10.809856 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:04:10.810040 [debug] [MainThread]: Connection 'list_astrafy-464919_raw' was properly closed.
[0m16:04:10.810210 [debug] [MainThread]: Connection 'model.astrafy_project.exercise6' was properly closed.
[0m16:04:10.810451 [info ] [MainThread]: 
[0m16:04:10.810968 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.29 seconds (4.29s).
[0m16:04:10.812579 [debug] [MainThread]: Command end result
[0m16:04:10.829373 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:04:10.831776 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:04:10.837277 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:04:10.837615 [info ] [MainThread]: 
[0m16:04:10.838026 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:04:10.838428 [info ] [MainThread]: 
[0m16:04:10.839198 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m16:04:10.840261 [debug] [MainThread]: Command `dbt run` succeeded at 16:04:10.840130 after 8.05 seconds
[0m16:04:10.840590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF35174D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF3517590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026FF35178F0>]}
[0m16:04:10.840910 [debug] [MainThread]: Flushing usage events
[0m16:04:11.390950 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:07:28.034585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E9D182510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E9B00C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E9F2E3ED0>]}


============================== 16:07:28.038583 | bb27f7d0-1c75-4e9e-8c33-d006b4a48e43 ==============================
[0m16:07:28.038583 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:07:28.039198 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:07:30.768139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E9D66DA70>]}
[0m16:07:30.822286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECACE97B0>]}
[0m16:07:30.823007 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:07:31.291256 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:07:31.374039 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:07:31.374792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB1B5950>]}
[0m16:07:32.288817 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.astrafy_project.example
- models.astrafy_project.staging
[0m16:07:32.296714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECACD2E40>]}
[0m16:07:32.349789 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:07:32.352128 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:07:32.375574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB517690>]}
[0m16:07:32.376013 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:07:32.376404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB203110>]}
[0m16:07:32.377922 [info ] [MainThread]: 
[0m16:07:32.378360 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:07:32.378647 [info ] [MainThread]: 
[0m16:07:32.379067 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:07:32.382499 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:07:32.382855 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:07:32.781503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919, now create_astrafy-464919_raw_marts)
[0m16:07:32.782021 [debug] [ThreadPool]: Creating schema "database: "astrafy-464919"
schema: "raw_marts"
"
[0m16:07:32.789372 [debug] [ThreadPool]: On create_astrafy-464919_raw_marts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "create_astrafy-464919_raw_marts"} */
create schema if not exists `astrafy-464919`.`raw_marts`
  
[0m16:07:32.789726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:07:33.098421 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7a54f473-db03-41fe-ae4e-3431a1b2ca3d&page=queryresults
[0m16:07:35.657111 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw_marts'
[0m16:07:35.657568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:07:35.935368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB2BA090>]}
[0m16:07:35.935840 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:07:35.941234 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:07:35.941711 [info ] [Thread-1 (]: 1 of 6 START sql view model raw_marts.exercise1 ................................ [RUN]
[0m16:07:35.942524 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:07:35.942867 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:07:35.948254 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:07:35.949160 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:07:35.969844 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:07:35.970881 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:07:35.971281 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:07:36.453701 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:ccb98e84-afb6-4a1c-a1f3-754d0330aaf5&page=queryresults
[0m16:07:36.711960 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB537280>]}
[0m16:07:36.712595 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw_marts.exercise1 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.77s]
[0m16:07:36.713299 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:07:36.713616 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:07:36.714343 [info ] [Thread-1 (]: 2 of 6 START sql view model raw_marts.exercise2 ................................ [RUN]
[0m16:07:36.715057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:07:36.715344 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:07:36.718096 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:07:36.718925 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:07:36.720886 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:07:36.721625 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:07:36.721981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:07:37.150933 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:45f360f7-5b3c-4068-b972-88d289e6af3a&page=queryresults
[0m16:07:37.435418 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB44ED50>]}
[0m16:07:37.436015 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw_marts.exercise2 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.72s]
[0m16:07:37.436705 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:07:37.437018 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:07:37.437495 [info ] [Thread-1 (]: 3 of 6 START sql table model raw_marts.exercise3 ............................... [RUN]
[0m16:07:37.438027 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:07:37.438604 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:07:37.440909 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:07:37.441677 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:07:37.467549 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m16:07:37.468556 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */

  
    

    create or replace table `astrafy-464919`.`raw_marts`.`exercise3`
      
    
    

    OPTIONS()
    as (
      SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH)
    );
  
[0m16:07:37.469194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:07:37.968043 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2711af50-d56c-46ba-b0d6-1ef2fe32ab1a&page=queryresults
[0m16:07:39.641738 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECBBD0450>]}
[0m16:07:39.642329 [info ] [Thread-1 (]: 3 of 6 OK created sql table model raw_marts.exercise3 .......................... [[32mCREATE TABLE (12.0 rows, 443.1 KiB processed)[0m in 2.20s]
[0m16:07:39.643107 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:07:39.643456 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:07:39.643775 [info ] [Thread-1 (]: 4 of 6 START sql table model raw_marts.exercise4 ............................... [RUN]
[0m16:07:39.644362 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:07:39.644682 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:07:39.647436 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:07:39.648467 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:07:39.650539 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:07:39.651269 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */

  
    

    create or replace table `astrafy-464919`.`raw_marts`.`exercise4`
      
    
    

    OPTIONS()
    as (
      SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id
    );
  
[0m16:07:39.651729 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:07:40.192836 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:b772b589-af19-45b1-961f-28e2bfa20852&page=queryresults
[0m16:07:41.539000 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECB3F8750>]}
[0m16:07:41.539599 [info ] [Thread-1 (]: 4 of 6 OK created sql table model raw_marts.exercise4 .......................... [[32mCREATE TABLE (3.7k rows, 886.3 KiB processed)[0m in 1.89s]
[0m16:07:41.540905 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:07:41.541264 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:07:41.541662 [info ] [Thread-1 (]: 5 of 6 START sql table model raw_marts.exercise5 ............................... [RUN]
[0m16:07:41.542364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:07:41.542706 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:07:41.545476 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:07:41.546472 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:07:41.548492 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m16:07:41.549551 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */

  
    

    create or replace table `astrafy-464919`.`raw_marts`.`exercise5`
      
    
    

    OPTIONS()
    as (
      WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM `astrafy-464919`.`raw`.`sales_recrutement` AS s
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders
    );
  
[0m16:07:41.549923 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:07:42.053626 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:23c7833b-bb48-4945-a138-5dcb5aea84f8&page=queryresults
[0m16:07:43.435835 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECAE5B350>]}
[0m16:07:43.436414 [info ] [Thread-1 (]: 5 of 6 OK created sql table model raw_marts.exercise5 .......................... [[32mCREATE TABLE (19.6k rows, 664.7 KiB processed)[0m in 1.89s]
[0m16:07:43.437174 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:07:43.437942 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:07:43.438300 [info ] [Thread-1 (]: 6 of 6 START sql table model raw_marts.exercise6 ............................... [RUN]
[0m16:07:43.438800 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.exercise6)
[0m16:07:43.439069 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise6
[0m16:07:43.441212 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise6"
[0m16:07:43.442088 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise6
[0m16:07:43.444308 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise6"
[0m16:07:43.445012 [debug] [Thread-1 (]: On model.astrafy_project.exercise6: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise6"} */

  
    

    create or replace table `astrafy-464919`.`raw_marts`.`exercise6`
      
    
    

    OPTIONS()
    as (
      WITH orders AS (
  SELECT * FROM `astrafy-464919`.`raw`.`sales_recrutement`
  WHERE EXTRACT(YEAR FROM date_date) IN (2022, 2023)
),

order_seg AS (
  SELECT * FROM `astrafy-464919`.`raw_marts`.`exercise5`
)

SELECT
  o.*,
  s.order_segment
FROM orders o
LEFT JOIN order_seg s ON o.order_id = s.order_id
    );
  
[0m16:07:43.445328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:07:44.063428 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9ee6a99c-7534-4e39-8de7-f0d3eb93241b&page=queryresults
[0m16:07:45.939617 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb27f7d0-1c75-4e9e-8c33-d006b4a48e43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECAE5A990>]}
[0m16:07:45.940244 [info ] [Thread-1 (]: 6 of 6 OK created sql table model raw_marts.exercise6 .......................... [[32mCREATE TABLE (332.6k rows, 1.5 MiB processed)[0m in 2.50s]
[0m16:07:45.941107 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:07:45.942513 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:07:45.943911 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:07:45.944152 [debug] [MainThread]: Connection 'create_astrafy-464919_raw_marts' was properly closed.
[0m16:07:45.944350 [debug] [MainThread]: Connection 'list_astrafy-464919_raw_marts' was properly closed.
[0m16:07:45.944526 [debug] [MainThread]: Connection 'model.astrafy_project.exercise6' was properly closed.
[0m16:07:45.944789 [info ] [MainThread]: 
[0m16:07:45.945361 [info ] [MainThread]: Finished running 4 table models, 2 view models in 0 hours 0 minutes and 13.57 seconds (13.57s).
[0m16:07:45.947239 [debug] [MainThread]: Command end result
[0m16:07:45.964632 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:07:45.966962 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:07:45.972042 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:07:45.972314 [info ] [MainThread]: 
[0m16:07:45.972808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:07:45.973197 [info ] [MainThread]: 
[0m16:07:45.973611 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m16:07:45.974520 [debug] [MainThread]: Command `dbt run` succeeded at 16:07:45.974408 after 18.10 seconds
[0m16:07:45.974820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECBB97D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECBB979B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECBB97770>]}
[0m16:07:45.975106 [debug] [MainThread]: Flushing usage events
[0m16:07:46.574701 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:11:31.782037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131A00F2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001319DF5C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131A2253ED0>]}


============================== 16:11:31.786100 | c5ddc240-f5cf-410d-a267-288d52eb79aa ==============================
[0m16:11:31.786100 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:11:31.786656 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:11:34.418669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131A05DDA70>]}
[0m16:11:34.469193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CCC997B0>]}
[0m16:11:34.469931 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:11:34.938883 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:11:35.016258 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:11:35.017074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CCC63350>]}
[0m16:11:35.928043 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.staging
[0m16:11:35.935961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CCC82D50>]}
[0m16:11:35.991247 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:11:35.993523 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:11:36.017610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE4933F0>]}
[0m16:11:36.018046 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:11:36.018526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE29B5F0>]}
[0m16:11:36.020008 [info ] [MainThread]: 
[0m16:11:36.020385 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:11:36.020679 [info ] [MainThread]: 
[0m16:11:36.021277 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:11:36.024995 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:11:36.025329 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:36.460068 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw_marts'
[0m16:11:36.460439 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:36.690044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE3A2B10>]}
[0m16:11:36.690442 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:11:36.696282 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:11:36.696722 [info ] [Thread-1 (]: 1 of 6 START sql view model raw_marts.exercise1 ................................ [RUN]
[0m16:11:36.697412 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:11:36.697677 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:11:36.703333 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:11:36.704060 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:11:36.730706 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:11:36.731728 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:11:36.732131 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:11:37.127190 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:8d80b81f-0052-40a7-8672-e4b29c347c12&page=queryresults
[0m16:11:37.592068 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE4AAFC0>]}
[0m16:11:37.592765 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw_marts.exercise1 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.89s]
[0m16:11:37.593651 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:11:37.593954 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:11:37.594443 [info ] [Thread-1 (]: 2 of 6 START sql view model raw_marts.exercise2 ................................ [RUN]
[0m16:11:37.595054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:11:37.595341 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:11:37.597668 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:11:37.598430 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:11:37.601252 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:11:37.602007 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:11:37.602376 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:38.001041 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e999122d-9069-427e-8aa0-3602d22ac412&page=queryresults
[0m16:11:38.239699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE3CEB70>]}
[0m16:11:38.240267 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw_marts.exercise2 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.64s]
[0m16:11:38.241011 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:11:38.241290 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:11:38.241608 [info ] [Thread-1 (]: 3 of 6 START sql view model raw_marts.exercise3 ................................ [RUN]
[0m16:11:38.242122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:11:38.242390 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:11:38.244472 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:11:38.245407 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:11:38.251475 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:38.270089 [debug] [Thread-1 (]: Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql)
[0m16:11:38.270696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131A2222550>]}
[0m16:11:38.271258 [error] [Thread-1 (]: 3 of 6 ERROR creating sql view model raw_marts.exercise3 ....................... [[31mERROR[0m in 0.03s]
[0m16:11:38.272006 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:11:38.272378 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:11:38.272892 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise3' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql).
[0m16:11:38.273569 [info ] [Thread-1 (]: 4 of 6 START sql view model raw_marts.exercise4 ................................ [RUN]
[0m16:11:38.275730 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:11:38.276518 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:11:38.278883 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:11:38.279713 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:11:38.281472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:38.285870 [debug] [Thread-1 (]: Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql)
[0m16:11:38.286339 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE4399B0>]}
[0m16:11:38.286853 [error] [Thread-1 (]: 4 of 6 ERROR creating sql view model raw_marts.exercise4 ....................... [[31mERROR[0m in 0.01s]
[0m16:11:38.287515 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:11:38.287849 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:11:38.288577 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise4' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql).
[0m16:11:38.289064 [info ] [Thread-1 (]: 5 of 6 START sql view model raw_marts.exercise5 ................................ [RUN]
[0m16:11:38.289655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:11:38.289927 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:11:38.292472 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:11:38.293459 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:11:38.295568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:38.299837 [debug] [Thread-1 (]: Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql)
[0m16:11:38.300559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ddc240-f5cf-410d-a267-288d52eb79aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CEAA75F0>]}
[0m16:11:38.301143 [error] [Thread-1 (]: 5 of 6 ERROR creating sql view model raw_marts.exercise5 ....................... [[31mERROR[0m in 0.01s]
[0m16:11:38.301819 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:11:38.302283 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise5' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql).
[0m16:11:38.303089 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:11:38.303568 [info ] [Thread-1 (]: 6 of 6 SKIP relation raw_marts.exercise6 ....................................... [[33mSKIP[0m]
[0m16:11:38.304022 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:11:38.305027 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:11:38.306507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:11:38.306770 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:11:38.306987 [debug] [MainThread]: Connection 'list_astrafy-464919_raw_marts' was properly closed.
[0m16:11:38.307185 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m16:11:38.307566 [info ] [MainThread]: 
[0m16:11:38.307929 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.29 seconds (2.29s).
[0m16:11:38.309129 [debug] [MainThread]: Command end result
[0m16:11:38.325470 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:11:38.327622 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:11:38.332568 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:11:38.332868 [info ] [MainThread]: 
[0m16:11:38.333392 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m16:11:38.333787 [info ] [MainThread]: 
[0m16:11:38.334303 [error] [MainThread]: [31mFailure in model exercise3 (models\marts\exercise3.sql)[0m
[0m16:11:38.334866 [error] [MainThread]:   Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql)
[0m16:11:38.335303 [info ] [MainThread]: 
[0m16:11:38.335767 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise3.sql
[0m16:11:38.336226 [info ] [MainThread]: 
[0m16:11:38.336760 [error] [MainThread]: [31mFailure in model exercise4 (models\marts\exercise4.sql)[0m
[0m16:11:38.337464 [error] [MainThread]:   Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql)
[0m16:11:38.338020 [info ] [MainThread]: 
[0m16:11:38.338527 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise4.sql
[0m16:11:38.339022 [info ] [MainThread]: 
[0m16:11:38.339386 [error] [MainThread]: [31mFailure in model exercise5 (models\marts\exercise5.sql)[0m
[0m16:11:38.339798 [error] [MainThread]:   Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql)
[0m16:11:38.340220 [info ] [MainThread]: 
[0m16:11:38.340534 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise5.sql
[0m16:11:38.340831 [info ] [MainThread]: 
[0m16:11:38.341115 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=3 SKIP=1 NO-OP=0 TOTAL=6
[0m16:11:38.342062 [debug] [MainThread]: Command `dbt run` failed at 16:11:38.341940 after 6.72 seconds
[0m16:11:38.342396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CE2BDFD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131A115BD70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000131CEAA73B0>]}
[0m16:11:38.342769 [debug] [MainThread]: Flushing usage events
[0m16:11:38.875008 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:12:46.462012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0C79B2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0C581C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0C9B13ED0>]}


============================== 16:12:46.466032 | a5f6f621-97eb-454f-9947-5347dc664d04 ==============================
[0m16:12:46.466032 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:12:46.466607 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:12:49.014323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0C7E9DA70>]}
[0m16:12:49.065819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F55197B0>]}
[0m16:12:49.066508 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:12:49.517180 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:12:49.641273 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:12:49.641610 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:12:49.646213 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.staging
[0m16:12:49.669717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F59E0E50>]}
[0m16:12:49.729401 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:12:49.732064 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:12:49.755095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F55026C0>]}
[0m16:12:49.755527 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:12:49.756057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F55C3CB0>]}
[0m16:12:49.757551 [info ] [MainThread]: 
[0m16:12:49.757989 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:12:49.758261 [info ] [MainThread]: 
[0m16:12:49.758752 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:12:49.762285 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:12:49.762632 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:12:50.164884 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_raw_marts'
[0m16:12:50.165456 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:12:50.392163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F5B94BB0>]}
[0m16:12:50.392754 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:12:50.398017 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:12:50.398433 [info ] [Thread-1 (]: 1 of 6 START sql view model raw_marts.exercise1 ................................ [RUN]
[0m16:12:50.399074 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:12:50.399384 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:12:50.406247 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:12:50.407025 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:12:50.430423 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:12:50.431464 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:12:50.431886 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:12:50.822297 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9ede02cf-99d0-4c2d-b2c9-1a61f4fedd0a&page=queryresults
[0m16:12:51.151126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F5B331D0>]}
[0m16:12:51.151740 [info ] [Thread-1 (]: 1 of 6 OK created sql view model raw_marts.exercise1 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.75s]
[0m16:12:51.152503 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:12:51.152807 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:12:51.153168 [info ] [Thread-1 (]: 2 of 6 START sql view model raw_marts.exercise2 ................................ [RUN]
[0m16:12:51.153808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:12:51.154152 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:12:51.156444 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:12:51.157524 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:12:51.160091 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:12:51.160836 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`raw_marts`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:12:51.161207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:12:51.551761 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e7c12476-9819-43c7-a57e-af5c73cc1499&page=queryresults
[0m16:12:51.789030 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F5B75020>]}
[0m16:12:51.789655 [info ] [Thread-1 (]: 2 of 6 OK created sql view model raw_marts.exercise2 ........................... [[32mCREATE VIEW (0 processed)[0m in 0.64s]
[0m16:12:51.790356 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:12:51.790658 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:12:51.791001 [info ] [Thread-1 (]: 3 of 6 START sql view model raw_marts.exercise3 ................................ [RUN]
[0m16:12:51.791618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:12:51.792040 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:12:51.794270 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:12:51.795040 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:12:51.801255 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:12:51.808114 [debug] [Thread-1 (]: Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql)
[0m16:12:51.808683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F61A2710>]}
[0m16:12:51.809240 [error] [Thread-1 (]: 3 of 6 ERROR creating sql view model raw_marts.exercise3 ....................... [[31mERROR[0m in 0.02s]
[0m16:12:51.809950 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:12:51.810255 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:12:51.810873 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise3' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql).
[0m16:12:51.811455 [info ] [Thread-1 (]: 4 of 6 START sql view model raw_marts.exercise4 ................................ [RUN]
[0m16:12:51.812584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:12:51.812906 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:12:51.815047 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:12:51.815839 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:12:51.817560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:12:51.821727 [debug] [Thread-1 (]: Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql)
[0m16:12:51.822125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F6179DD0>]}
[0m16:12:51.822575 [error] [Thread-1 (]: 4 of 6 ERROR creating sql view model raw_marts.exercise4 ....................... [[31mERROR[0m in 0.01s]
[0m16:12:51.823258 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:12:51.823579 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:12:51.823978 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise4' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql).
[0m16:12:51.824434 [info ] [Thread-1 (]: 5 of 6 START sql view model raw_marts.exercise5 ................................ [RUN]
[0m16:12:51.825291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:12:51.825615 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:12:51.828069 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:12:51.829032 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:12:51.830876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:12:51.835217 [debug] [Thread-1 (]: Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql)
[0m16:12:51.835692 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a5f6f621-97eb-454f-9947-5347dc664d04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F62E6BA0>]}
[0m16:12:51.836205 [error] [Thread-1 (]: 5 of 6 ERROR creating sql view model raw_marts.exercise5 ....................... [[31mERROR[0m in 0.01s]
[0m16:12:51.836866 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:12:51.837422 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise5' to be skipped because of status 'error'.  Reason: Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql).
[0m16:12:51.838108 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:12:51.838471 [info ] [Thread-1 (]: 6 of 6 SKIP relation raw_marts.exercise6 ....................................... [[33mSKIP[0m]
[0m16:12:51.839094 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:12:51.840875 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:12:51.842296 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:12:51.842588 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:12:51.842814 [debug] [MainThread]: Connection 'list_astrafy-464919_raw_marts' was properly closed.
[0m16:12:51.843044 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m16:12:51.843321 [info ] [MainThread]: 
[0m16:12:51.843999 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.08 seconds (2.08s).
[0m16:12:51.845246 [debug] [MainThread]: Command end result
[0m16:12:51.861242 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:12:51.863715 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:12:51.869214 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:12:51.869542 [info ] [MainThread]: 
[0m16:12:51.870056 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m16:12:51.870537 [info ] [MainThread]: 
[0m16:12:51.871058 [error] [MainThread]: [31mFailure in model exercise3 (models\marts\exercise3.sql)[0m
[0m16:12:51.871773 [error] [MainThread]:   Compilation Error in model exercise3 (models\marts\exercise3.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise3`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise3` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise3 (models\marts\exercise3.sql)
[0m16:12:51.872267 [info ] [MainThread]: 
[0m16:12:51.872717 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise3.sql
[0m16:12:51.873193 [info ] [MainThread]: 
[0m16:12:51.873685 [error] [MainThread]: [31mFailure in model exercise4 (models\marts\exercise4.sql)[0m
[0m16:12:51.874178 [error] [MainThread]:   Compilation Error in model exercise4 (models\marts\exercise4.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise4`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise4` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise4 (models\marts\exercise4.sql)
[0m16:12:51.874738 [info ] [MainThread]: 
[0m16:12:51.875137 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise4.sql
[0m16:12:51.875442 [info ] [MainThread]: 
[0m16:12:51.875773 [error] [MainThread]: [31mFailure in model exercise5 (models\marts\exercise5.sql)[0m
[0m16:12:51.876106 [error] [MainThread]:   Compilation Error in model exercise5 (models\marts\exercise5.sql)
  Trying to create view `astrafy-464919`.`raw_marts`.`exercise5`, but it currently exists as a table. Either drop `astrafy-464919`.`raw_marts`.`exercise5` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model exercise5 (models\marts\exercise5.sql)
[0m16:12:51.876466 [info ] [MainThread]: 
[0m16:12:51.876769 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise5.sql
[0m16:12:51.877020 [info ] [MainThread]: 
[0m16:12:51.877299 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=3 SKIP=1 NO-OP=0 TOTAL=6
[0m16:12:51.878197 [debug] [MainThread]: Command `dbt run` failed at 16:12:51.878067 after 5.53 seconds
[0m16:12:51.878568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0C8A1B470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F62D7EF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0F62D7D10>]}
[0m16:12:51.878899 [debug] [MainThread]: Flushing usage events
[0m16:12:52.526892 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:16:46.074853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022697752510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226955AC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226998B3ED0>]}


============================== 16:16:46.079387 | eeaf5da6-cd15-43da-bced-c14fa0c713e9 ==============================
[0m16:16:46.079387 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:16:46.080227 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:16:48.702963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022697C3DA70>]}
[0m16:16:48.753491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C53197B0>]}
[0m16:16:48.754169 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:16:49.214365 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:16:49.282574 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m16:16:49.283288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C52E3350>]}
[0m16:16:50.161017 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.staging
[0m16:16:50.168684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C5302D50>]}
[0m16:16:50.220269 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:16:50.222783 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:16:50.246516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C5B4B3F0>]}
[0m16:16:50.246922 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:16:50.247300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C594F5F0>]}
[0m16:16:50.248771 [info ] [MainThread]: 
[0m16:16:50.249124 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:16:50.249390 [info ] [MainThread]: 
[0m16:16:50.249794 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:16:50.253388 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:16:50.253823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:50.631534 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919, now create_astrafy-464919_marts_marts)
[0m16:16:50.631999 [debug] [ThreadPool]: Creating schema "database: "astrafy-464919"
schema: "marts_marts"
"
[0m16:16:50.639613 [debug] [ThreadPool]: On create_astrafy-464919_marts_marts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "create_astrafy-464919_marts_marts"} */
create schema if not exists `astrafy-464919`.`marts_marts`
  
[0m16:16:50.639963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:16:50.977271 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7251cb59-be65-4782-8768-277a4cfa71a1&page=queryresults
[0m16:16:52.703442 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts_marts'
[0m16:16:52.703803 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:52.933027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C58E59D0>]}
[0m16:16:52.933693 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:16:52.939815 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:16:52.940275 [info ] [Thread-1 (]: 1 of 6 START sql view model marts_marts.exercise1 .............................. [RUN]
[0m16:16:52.941012 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:16:52.941327 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:16:52.946677 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:16:52.947496 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:16:52.969165 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:16:52.970261 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:16:52.970700 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:16:53.506160 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c61ae61e-0958-4cde-9ad5-06812e2e29ef&page=queryresults
[0m16:16:53.636279 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C5B5F1D0>]}
[0m16:16:53.636968 [info ] [Thread-1 (]: 1 of 6 OK created sql view model marts_marts.exercise1 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m16:16:53.637708 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:16:53.638164 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:16:53.638582 [info ] [Thread-1 (]: 2 of 6 START sql view model marts_marts.exercise2 .............................. [RUN]
[0m16:16:53.639182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:16:53.639574 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:16:53.642198 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:16:53.643101 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:16:53.645058 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:16:53.645787 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:16:53.646139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:54.046680 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:85060581-cf27-4385-ba4a-8f92bbf18a00&page=queryresults
[0m16:16:54.295779 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C5A7E670>]}
[0m16:16:54.296367 [info ] [Thread-1 (]: 2 of 6 OK created sql view model marts_marts.exercise2 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.66s]
[0m16:16:54.297155 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:16:54.297459 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:16:54.297790 [info ] [Thread-1 (]: 3 of 6 START sql view model marts_marts.exercise3 .............................. [RUN]
[0m16:16:54.298349 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:16:54.298655 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:16:54.300654 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:16:54.301691 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:16:54.303963 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m16:16:54.304690 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m16:16:54.305042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:54.651829 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2f7c81a2-9beb-417a-99f4-05b37fabc93e&page=queryresults
[0m16:16:54.895051 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C61DEB50>]}
[0m16:16:54.895621 [info ] [Thread-1 (]: 3 of 6 OK created sql view model marts_marts.exercise3 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.60s]
[0m16:16:54.896434 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:16:54.897500 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:16:54.897929 [info ] [Thread-1 (]: 4 of 6 START sql view model marts_marts.exercise4 .............................. [RUN]
[0m16:16:54.898554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:16:54.898859 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:16:54.901170 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:16:54.901920 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:16:54.904116 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:16:54.904974 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m16:16:54.905312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:55.581766 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:11009ba5-3273-4067-809f-62f8f39c0899&page=queryresults
[0m16:16:55.781086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C54A3460>]}
[0m16:16:55.781676 [info ] [Thread-1 (]: 4 of 6 OK created sql view model marts_marts.exercise4 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m16:16:55.782543 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:16:55.782828 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:16:55.783148 [info ] [Thread-1 (]: 5 of 6 START sql view model marts_marts.exercise5 .............................. [RUN]
[0m16:16:55.783694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:16:55.783993 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:16:55.786146 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:16:55.786952 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:16:55.789323 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m16:16:55.790098 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise5`
  OPTIONS()
  as WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM `astrafy-464919`.`raw`.`sales_recrutement` AS s
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m16:16:55.790432 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:56.275895 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:2518a52c-3f1e-4c76-8c97-c4ded4c212f7&page=queryresults
[0m16:16:56.465756 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C57730B0>]}
[0m16:16:56.466396 [info ] [Thread-1 (]: 5 of 6 OK created sql view model marts_marts.exercise5 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.68s]
[0m16:16:56.468319 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:16:56.469528 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:16:56.469991 [info ] [Thread-1 (]: 6 of 6 START sql view model marts_marts.exercise6 .............................. [RUN]
[0m16:16:56.470712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.exercise6)
[0m16:16:56.471003 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise6
[0m16:16:56.473746 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise6"
[0m16:16:56.474639 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise6
[0m16:16:56.477194 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise6"
[0m16:16:56.478069 [debug] [Thread-1 (]: On model.astrafy_project.exercise6: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise6"} */


  create or replace view `astrafy-464919`.`marts_marts`.`exercise6`
  OPTIONS()
  as WITH orders AS (
  SELECT * FROM `astrafy-464919`.`raw`.`sales_recrutement`
  WHERE EXTRACT(YEAR FROM date_date) IN (2022, 2023)
),

order_seg AS (
  SELECT * FROM `astrafy-464919`.`marts_marts`.`exercise5`
)

SELECT
  o.*,
  s.order_segment
FROM orders o
LEFT JOIN order_seg s ON o.order_id = s.order_id;


[0m16:16:56.478410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:57.257499 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:3150a11d-5e2c-4253-aba8-91d49152a51f&page=queryresults
[0m16:16:57.455341 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eeaf5da6-cd15-43da-bced-c14fa0c713e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C54C8DD0>]}
[0m16:16:57.456019 [info ] [Thread-1 (]: 6 of 6 OK created sql view model marts_marts.exercise6 ......................... [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m16:16:57.457095 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:16:57.458529 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:16:57.459860 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:16:57.460094 [debug] [MainThread]: Connection 'create_astrafy-464919_marts_marts' was properly closed.
[0m16:16:57.460291 [debug] [MainThread]: Connection 'list_astrafy-464919_marts_marts' was properly closed.
[0m16:16:57.460488 [debug] [MainThread]: Connection 'model.astrafy_project.exercise6' was properly closed.
[0m16:16:57.460758 [info ] [MainThread]: 
[0m16:16:57.461147 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 7.21 seconds (7.21s).
[0m16:16:57.462543 [debug] [MainThread]: Command end result
[0m16:16:57.479616 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:16:57.481754 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:16:57.486618 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:16:57.486877 [info ] [MainThread]: 
[0m16:16:57.487394 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:16:57.488159 [info ] [MainThread]: 
[0m16:16:57.488683 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m16:16:57.489784 [debug] [MainThread]: Command `dbt run` succeeded at 16:16:57.489671 after 11.53 seconds
[0m16:16:57.490112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C61B3DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C61B3A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C61B3830>]}
[0m16:16:57.490404 [debug] [MainThread]: Flushing usage events
[0m16:16:58.043113 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:18:27.424251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E29DE02510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E29BC6C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E29FF5FED0>]}


============================== 16:18:27.428944 | 1f2a2b2e-0826-4771-8ded-64c6b194ca98 ==============================
[0m16:18:27.428944 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:18:27.429733 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:18:30.108221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E29E2EDA70>]}
[0m16:18:30.158816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CB9797B0>]}
[0m16:18:30.159494 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:18:30.627153 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:18:30.714349 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:18:30.715052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CB943350>]}
[0m16:18:31.605539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CB962C60>]}
[0m16:18:31.654995 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:18:31.657237 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:18:31.680840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC19F3F0>]}
[0m16:18:31.681263 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:18:31.681618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CBFA75F0>]}
[0m16:18:31.683095 [info ] [MainThread]: 
[0m16:18:31.683472 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:18:31.683752 [info ] [MainThread]: 
[0m16:18:31.684180 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:18:31.687793 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:18:31.688211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:18:32.074255 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m16:18:32.074781 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:18:32.303673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC1AE810>]}
[0m16:18:32.304291 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:18:32.309522 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m16:18:32.310033 [info ] [Thread-1 (]: 1 of 6 START sql view model marts.exercise1 .................................... [RUN]
[0m16:18:32.311200 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m16:18:32.311478 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m16:18:32.317213 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m16:18:32.318061 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m16:18:32.344194 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m16:18:32.345312 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as -- Materialized as a view



SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m16:18:32.345890 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:18:32.735850 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:1def2b92-33b1-463a-888a-c116b1d5db35&page=queryresults
[0m16:18:33.137895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC1CADB0>]}
[0m16:18:33.138600 [info ] [Thread-1 (]: 1 of 6 OK created sql view model marts.exercise1 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.83s]
[0m16:18:33.139449 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m16:18:33.139823 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m16:18:33.140186 [info ] [Thread-1 (]: 2 of 6 START sql view model marts.exercise2 .................................... [RUN]
[0m16:18:33.140702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m16:18:33.140976 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m16:18:33.142995 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m16:18:33.143706 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m16:18:33.145965 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m16:18:33.146716 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`marts`.`exercise2`
  OPTIONS()
  as -- Materialized as a view


SELECT
  EXTRACT(MONTH FROM date_date) AS MONTH,
  COUNT(DISTINCT order_id) AS orders_count
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023
GROUP BY MONTH
ORDER BY MONTH;


[0m16:18:33.147047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:33.510939 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4f04010d-abcd-428f-81dd-0b6e982d7fc7&page=queryresults
[0m16:18:33.662760 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC0E22B0>]}
[0m16:18:33.663348 [info ] [Thread-1 (]: 2 of 6 OK created sql view model marts.exercise2 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m16:18:33.664157 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m16:18:33.664540 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m16:18:33.664881 [info ] [Thread-1 (]: 3 of 6 START sql view model marts.exercise3 .................................... [RUN]
[0m16:18:33.665533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m16:18:33.665835 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m16:18:33.668075 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m16:18:33.668975 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m16:18:33.670718 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m16:18:33.671449 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as SELECT
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM `astrafy-464919`.`raw`.`sales_recrutement`
WHERE extract(year from cast(date_date as date)) = 2023
GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m16:18:33.671876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:34.022169 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7cbcc403-5bd4-4614-9b2a-250e577c04c5&page=queryresults
[0m16:18:34.185711 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC100150>]}
[0m16:18:34.186288 [info ] [Thread-1 (]: 3 of 6 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m16:18:34.187064 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m16:18:34.187485 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:18:34.187816 [info ] [Thread-1 (]: 4 of 6 START sql view model marts.exercise4 .................................... [RUN]
[0m16:18:34.188682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise3, now model.astrafy_project.exercise4)
[0m16:18:34.189051 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:18:34.191045 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:18:34.191792 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:18:34.193809 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:18:34.194905 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as SELECT
  order_id,
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id;


[0m16:18:34.195462 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:34.532684 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:4ba7df2f-9401-4262-a6cf-b763bf5df17b&page=queryresults
[0m16:18:34.702487 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CB9F4EC0>]}
[0m16:18:34.703128 [info ] [Thread-1 (]: 4 of 6 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.51s]
[0m16:18:34.703900 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:18:34.704192 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m16:18:34.704611 [info ] [Thread-1 (]: 5 of 6 START sql view model marts.exercise5 .................................... [RUN]
[0m16:18:34.705138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m16:18:34.705412 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m16:18:34.707412 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m16:18:34.708197 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m16:18:34.710330 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m16:18:34.711078 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM `astrafy-464919`.`raw`.`sales_recrutement` AS s
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m16:18:34.711418 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:35.109547 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e5a91a51-aebd-4269-bb77-5d04bb153484&page=queryresults
[0m16:18:35.263921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC202ED0>]}
[0m16:18:35.264481 [info ] [Thread-1 (]: 5 of 6 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.56s]
[0m16:18:35.265219 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m16:18:35.266065 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise6
[0m16:18:35.266477 [info ] [Thread-1 (]: 6 of 6 START sql view model marts.exercise6 .................................... [RUN]
[0m16:18:35.267011 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.exercise6)
[0m16:18:35.267292 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise6
[0m16:18:35.270332 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise6"
[0m16:18:35.271136 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise6
[0m16:18:35.273826 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise6"
[0m16:18:35.274653 [debug] [Thread-1 (]: On model.astrafy_project.exercise6: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise6"} */


  create or replace view `astrafy-464919`.`marts`.`exercise6`
  OPTIONS()
  as WITH orders AS (
  SELECT * FROM `astrafy-464919`.`raw`.`sales_recrutement`
  WHERE EXTRACT(YEAR FROM date_date) IN (2022, 2023)
),

order_seg AS (
  SELECT * FROM `astrafy-464919`.`marts`.`exercise5`
)

SELECT
  o.*,
  s.order_segment
FROM orders o
LEFT JOIN order_seg s ON o.order_id = s.order_id;


[0m16:18:35.275006 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:18:35.785393 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:e56bcb19-1451-4363-9a78-19aba6654c60&page=queryresults
[0m16:18:35.952578 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f2a2b2e-0826-4771-8ded-64c6b194ca98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC200C50>]}
[0m16:18:35.953174 [info ] [Thread-1 (]: 6 of 6 OK created sql view model marts.exercise6 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m16:18:35.953899 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise6
[0m16:18:35.955146 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:18:35.956593 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:18:35.956835 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:18:35.957074 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m16:18:35.957297 [debug] [MainThread]: Connection 'model.astrafy_project.exercise6' was properly closed.
[0m16:18:35.957585 [info ] [MainThread]: 
[0m16:18:35.957944 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.27 seconds (4.27s).
[0m16:18:35.959133 [debug] [MainThread]: Command end result
[0m16:18:35.976272 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:18:35.978619 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:18:35.984441 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:18:35.984788 [info ] [MainThread]: 
[0m16:18:35.985209 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:18:35.985531 [info ] [MainThread]: 
[0m16:18:35.985868 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m16:18:35.986770 [debug] [MainThread]: Command `dbt run` succeeded at 16:18:35.986657 after 8.69 seconds
[0m16:18:35.987091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E29EE6B7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC2030B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E2CC202A50>]}
[0m16:18:35.987443 [debug] [MainThread]: Flushing usage events
[0m16:18:36.518277 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:24:33.125161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECAE082510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECABEEC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECB01EFED0>]}


============================== 16:24:33.129209 | bc2cf4a1-abc8-4724-8f32-736cf6a5607d ==============================
[0m16:24:33.129209 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:24:33.129781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select excercise4', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:24:35.741935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc2cf4a1-abc8-4724-8f32-736cf6a5607d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECAE569A70>]}
[0m16:24:35.790852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc2cf4a1-abc8-4724-8f32-736cf6a5607d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDBBE97B0>]}
[0m16:24:35.791478 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:24:36.238853 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:24:36.374640 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:24:36.375186 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercise4.sql
[0m16:24:36.599251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc2cf4a1-abc8-4724-8f32-736cf6a5607d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDC0BA150>]}
[0m16:24:36.653311 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:24:36.655909 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:24:36.684078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc2cf4a1-abc8-4724-8f32-736cf6a5607d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDBBD23F0>]}
[0m16:24:36.684537 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:24:36.685002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc2cf4a1-abc8-4724-8f32-736cf6a5607d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDC2E57F0>]}
[0m16:24:36.685542 [warn ] [MainThread]: The selection criterion 'excercise4' does not match any enabled nodes
[0m16:24:36.686606 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:24:36.687130 [debug] [MainThread]: Command end result
[0m16:24:36.702604 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:24:36.704676 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:24:36.708275 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:24:36.709228 [debug] [MainThread]: Command `dbt run` succeeded at 16:24:36.709115 after 3.70 seconds
[0m16:24:36.709539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDC1D1640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECAF108DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ECDC07D910>]}
[0m16:24:36.709827 [debug] [MainThread]: Flushing usage events
[0m16:24:37.235177 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:24:51.351978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002141B102510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021418F6C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002141C293ED0>]}


============================== 16:24:51.356192 | 8195edd0-f87a-40e0-99b6-944d77318773 ==============================
[0m16:24:51.356192 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:24:51.356780 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select exercise4', 'send_anonymous_usage_stats': 'True'}
[0m16:24:53.849282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002141B5EDA70>]}
[0m16:24:53.897338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021448C697B0>]}
[0m16:24:53.897940 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:24:54.333802 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:24:54.461980 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:24:54.462320 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:24:54.487977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021449134E50>]}
[0m16:24:54.542576 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:24:54.544480 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:24:54.565682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021448C523F0>]}
[0m16:24:54.566063 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:24:54.566518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021448D13CB0>]}
[0m16:24:54.567965 [info ] [MainThread]: 
[0m16:24:54.568378 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:24:54.568824 [info ] [MainThread]: 
[0m16:24:54.569504 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:24:54.570402 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:24:54.570745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:54.981695 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m16:24:54.982057 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:24:55.216898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214492E8C80>]}
[0m16:24:55.217351 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:24:55.222326 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:24:55.222706 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise4 .................................... [RUN]
[0m16:24:55.223325 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m16:24:55.223587 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:24:55.229840 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:24:55.230548 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:24:55.255643 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:24:55.256798 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  SUM(net_sales) AS net_sales,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id
ORDER BY order_date, customer_id, order_id;


[0m16:24:55.257469 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:24:55.798701 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7e34af40-ae32-4f28-b120-6648b9a03589&page=queryresults
[0m16:24:56.117287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8195edd0-f87a-40e0-99b6-944d77318773', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021449283050>]}
[0m16:24:56.117885 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.89s]
[0m16:24:56.118601 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:24:56.120042 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:24:56.121221 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:24:56.121435 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:24:56.121627 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m16:24:56.121793 [debug] [MainThread]: Connection 'model.astrafy_project.exercise4' was properly closed.
[0m16:24:56.121992 [info ] [MainThread]: 
[0m16:24:56.122443 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.55 seconds (1.55s).
[0m16:24:56.123211 [debug] [MainThread]: Command end result
[0m16:24:56.139325 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:24:56.141410 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:24:56.146688 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:24:56.147024 [info ] [MainThread]: 
[0m16:24:56.147649 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:24:56.148112 [info ] [MainThread]: 
[0m16:24:56.148611 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:24:56.149806 [debug] [MainThread]: Command `dbt run` succeeded at 16:24:56.149648 after 4.90 seconds
[0m16:24:56.150415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214492E6620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214492CD450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000214492CD3B0>]}
[0m16:24:56.150740 [debug] [MainThread]: Flushing usage events
[0m16:24:56.602022 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m16:25:33.375306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018205692510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182034FC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018207803ED0>]}


============================== 16:25:33.379147 | 0bc9f244-2457-4bf4-82a8-a4b95d08d231 ==============================
[0m16:25:33.379147 [info ] [MainThread]: Running with dbt=1.10.3
[0m16:25:33.379769 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise4', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:25:36.179347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018205B7DA70>]}
[0m16:25:36.234759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182322A97B0>]}
[0m16:25:36.235525 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m16:25:36.726200 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m16:25:36.859586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:25:36.860147 [debug] [MainThread]: Partial parsing: updated file: astrafy_project://models\marts\exercise4.sql
[0m16:25:37.094598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001823374A150>]}
[0m16:25:37.149091 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:25:37.151804 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:25:37.178224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182322923F0>]}
[0m16:25:37.178675 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m16:25:37.179084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018233A197F0>]}
[0m16:25:37.180331 [info ] [MainThread]: 
[0m16:25:37.180759 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:25:37.181047 [info ] [MainThread]: 
[0m16:25:37.181469 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:25:37.182415 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m16:25:37.182757 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:25:37.568549 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m16:25:37.569090 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:25:37.813771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182339A3860>]}
[0m16:25:37.814178 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:25:37.818578 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m16:25:37.819134 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise4 .................................... [RUN]
[0m16:25:37.819814 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m16:25:37.820136 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m16:25:37.826191 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m16:25:37.827033 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m16:25:37.851698 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m16:25:37.852723 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  SUM(net_sales) AS net_sales,
  SUM(qty) AS qty_product
FROM `astrafy-464919`.`raw`.`sales_recrutement`
where EXTRACT(year from CAST(date_date AS DATE)) in (2022, 2023)
GROUP BY order_id
ORDER BY order_date;


[0m16:25:37.853143 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:25:38.241680 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:57e76d65-e9c1-4193-911a-22d2f74d6378&page=queryresults
[0m16:25:38.524873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bc9f244-2457-4bf4-82a8-a4b95d08d231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001823373FDD0>]}
[0m16:25:38.525709 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.70s]
[0m16:25:38.526492 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m16:25:38.528229 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:25:38.529546 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:25:38.529769 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m16:25:38.529958 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m16:25:38.530151 [debug] [MainThread]: Connection 'model.astrafy_project.exercise4' was properly closed.
[0m16:25:38.530561 [info ] [MainThread]: 
[0m16:25:38.531040 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.35 seconds (1.35s).
[0m16:25:38.531994 [debug] [MainThread]: Command end result
[0m16:25:38.548084 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m16:25:38.550995 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m16:25:38.556084 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m16:25:38.556383 [info ] [MainThread]: 
[0m16:25:38.556924 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:25:38.557331 [info ] [MainThread]: 
[0m16:25:38.557705 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m16:25:38.558564 [debug] [MainThread]: Command `dbt run` succeeded at 16:25:38.558464 after 5.29 seconds
[0m16:25:38.558925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182339F73E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182339DC190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000182339DF250>]}
[0m16:25:38.559241 [debug] [MainThread]: Flushing usage events
[0m16:25:39.077381 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:11:31.295985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3A68E3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F384FCA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3B1EC050>]}


============================== 12:11:31.300980 | 196dd253-ae38-4394-8eb0-7994fae58ec5 ==============================
[0m12:11:31.300980 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:11:31.301720 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt ', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:11:31.464656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '196dd253-ae38-4394-8eb0-7994fae58ec5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3AB89940>]}
[0m12:11:31.489297 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m12:11:31.490538 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m12:11:31.491741 [debug] [MainThread]: Command `cli deps` succeeded at 12:11:31.491618 after 0.35 seconds
[0m12:11:31.492050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3B69FDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3B69F240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026F3B6BB050>]}
[0m12:11:31.492360 [debug] [MainThread]: Flushing usage events
[0m12:11:31.932605 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:20:29.842537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014512092510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001450FEEC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014513223ED0>]}


============================== 12:20:29.846213 | facc9d1b-1e49-4ecf-a283-8a0e9899b48a ==============================
[0m12:20:29.846213 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:20:29.847111 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select exercise3', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:20:32.149046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001451257DA70>]}
[0m12:20:32.200538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001453FC097B0>]}
[0m12:20:32.201614 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:20:32.693782 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:20:32.810666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:20:32.810997 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:20:32.836649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145400D4E50>]}
[0m12:20:32.896039 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:20:32.909142 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:20:32.929495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001453FBF23F0>]}
[0m12:20:32.929916 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m12:20:32.930416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001453FCB3CB0>]}
[0m12:20:32.931963 [info ] [MainThread]: 
[0m12:20:32.932304 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:20:32.932586 [info ] [MainThread]: 
[0m12:20:32.933001 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:20:32.934077 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:20:32.934488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:33.372489 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:20:33.372918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:33.658118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014540284C80>]}
[0m12:20:33.658622 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:33.664662 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m12:20:33.665082 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m12:20:33.665662 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m12:20:33.665926 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m12:20:33.672448 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m12:20:33.673279 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m12:20:33.696939 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m12:20:33.698578 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM `astrafy-464919`.`raw`.`sales_recrutement`

--Filter for the year 2023
WHERE extract(year from cast(date_date as date)) = 2023

GROUP BY month_year
ORDER BY month_year;


[0m12:20:33.699016 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:20:34.162564 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:dbec9e22-0e9d-4b34-a5ad-309d97965418&page=queryresults
[0m12:20:36.015336 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'facc9d1b-1e49-4ecf-a283-8a0e9899b48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014540221A90>]}
[0m12:20:36.016101 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 2.35s]
[0m12:20:36.016993 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m12:20:36.018256 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:36.019982 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:36.020217 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:20:36.020407 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:20:36.020583 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m12:20:36.020835 [info ] [MainThread]: 
[0m12:20:36.021207 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.09 seconds (3.09s).
[0m12:20:36.021764 [debug] [MainThread]: Command end result
[0m12:20:36.038083 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:20:36.040741 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:20:36.045984 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:20:36.046301 [info ] [MainThread]: 
[0m12:20:36.046897 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:20:36.047316 [info ] [MainThread]: 
[0m12:20:36.047981 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:20:36.049307 [debug] [MainThread]: Command `dbt run` succeeded at 12:20:36.049185 after 6.32 seconds
[0m12:20:36.049670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014540266620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014540279450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145402791D0>]}
[0m12:20:36.049974 [debug] [MainThread]: Flushing usage events
[0m12:20:36.460812 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:27:30.221568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AC3BE2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AC1A3C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AC5D4FED0>]}


============================== 12:27:30.225019 | 0f97c1f0-9504-4677-acba-149db9ce0857 ==============================
[0m12:27:30.225019 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:27:30.225601 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select sales_2023', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:27:32.409798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AC40B1A70>]}
[0m12:27:32.461464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF07E97B0>]}
[0m12:27:32.462179 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:27:32.925289 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:27:33.044136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:27:33.044500 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:27:33.073538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1C58F50>]}
[0m12:27:33.130730 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:27:33.133029 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:27:33.151904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF07D23F0>]}
[0m12:27:33.152363 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:27:33.152866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF0893CB0>]}
[0m12:27:33.154237 [info ] [MainThread]: 
[0m12:27:33.154781 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:27:33.155232 [info ] [MainThread]: 
[0m12:27:33.155878 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:27:33.157004 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:27:33.157318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:33.570241 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:27:33.570624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:33.806877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1E30C80>]}
[0m12:27:33.807270 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:27:33.812141 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:27:33.812622 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.sales_2023 ................................... [RUN]
[0m12:27:33.813290 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:27:33.813587 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:27:33.820266 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:27:33.821318 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:27:33.849336 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:27:33.851440 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */


  create or replace view `astrafy-464919`.`marts`.`sales_2023`
  OPTIONS()
  as SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023;


[0m12:27:33.852092 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:27:34.223185 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0f367617-adf9-450a-aa03-ad5eeab74e02&page=queryresults
[0m12:27:34.223648 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:0f367617-adf9-450a-aa03-ad5eeab74e02&page=queryresults
[0m12:27:34.323780 [debug] [Thread-1 (]: Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql
[0m12:27:34.325697 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0f97c1f0-9504-4677-acba-149db9ce0857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1DDA090>]}
[0m12:27:34.326275 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.sales_2023 .......................... [[31mERROR[0m in 0.51s]
[0m12:27:34.327096 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:27:34.327799 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.sales_2023' to be skipped because of status 'error'.  Reason: Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql.
[0m12:27:34.329510 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:27:34.330804 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:34.331120 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:27:34.331327 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:27:34.331503 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:27:34.331718 [info ] [MainThread]: 
[0m12:27:34.332079 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m12:27:34.332902 [debug] [MainThread]: Command end result
[0m12:27:34.350599 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:27:34.352896 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:27:34.358868 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:27:34.359241 [info ] [MainThread]: 
[0m12:27:34.359763 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:27:34.360153 [info ] [MainThread]: 
[0m12:27:34.360521 [error] [MainThread]: [31mFailure in model sales_2023 (models\staging\sales_2023.sql)[0m
[0m12:27:34.360865 [error] [MainThread]:   Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql
[0m12:27:34.361153 [info ] [MainThread]: 
[0m12:27:34.361444 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\staging\sales_2023.sql
[0m12:27:34.361711 [info ] [MainThread]: 
[0m12:27:34.361992 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:27:34.362759 [debug] [MainThread]: Command `dbt run` failed at 12:27:34.362663 after 4.26 seconds
[0m12:27:34.363056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1E39F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1E2E210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020AF1E2D130>]}
[0m12:27:34.363341 [debug] [MainThread]: Flushing usage events
[0m12:27:34.842845 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:27:52.462792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153F3852510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153F16BC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153F59B3ED0>]}


============================== 12:27:52.466332 | 86487265-0d17-46c0-8f70-068df79bcbd2 ==============================
[0m12:27:52.466332 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:27:52.467020 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select sales_2023', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:27:54.655617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153F3D31A70>]}
[0m12:27:54.705562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A14A97B0>]}
[0m12:27:54.706206 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:27:55.150184 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:27:55.265491 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:27:55.265838 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:27:55.291673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1948F50>]}
[0m12:27:55.348763 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:27:55.350969 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:27:55.370166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A14923F0>]}
[0m12:27:55.370582 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:27:55.371094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1553CB0>]}
[0m12:27:55.372332 [info ] [MainThread]: 
[0m12:27:55.372790 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:27:55.373228 [info ] [MainThread]: 
[0m12:27:55.373832 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:27:55.374814 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:27:55.375091 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:55.753877 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:27:55.754254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:55.970354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1B28C80>]}
[0m12:27:55.970774 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:27:55.976045 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:27:55.976465 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.sales_2023 ................................... [RUN]
[0m12:27:55.977058 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:27:55.977336 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:27:55.983804 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:27:55.984511 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:27:56.009498 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:27:56.010481 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */


  create or replace view `astrafy-464919`.`marts`.`sales_2023`
  OPTIONS()
  as SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023;


[0m12:27:56.010892 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:27:56.355669 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:5d0f8050-d120-44f4-8eb6-43d993769f5d&page=queryresults
[0m12:27:56.356161 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:5d0f8050-d120-44f4-8eb6-43d993769f5d&page=queryresults
[0m12:27:56.363313 [debug] [Thread-1 (]: Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql
[0m12:27:56.365940 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '86487265-0d17-46c0-8f70-068df79bcbd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1AC9790>]}
[0m12:27:56.366635 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.sales_2023 .......................... [[31mERROR[0m in 0.39s]
[0m12:27:56.367324 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:27:56.367812 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.sales_2023' to be skipped because of status 'error'.  Reason: Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql.
[0m12:27:56.369485 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:27:56.371089 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:56.371374 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:27:56.371607 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:27:56.371815 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:27:56.372090 [info ] [MainThread]: 
[0m12:27:56.372581 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.00 seconds (1.00s).
[0m12:27:56.373390 [debug] [MainThread]: Command end result
[0m12:27:56.390803 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:27:56.393062 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:27:56.398967 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:27:56.399338 [info ] [MainThread]: 
[0m12:27:56.399748 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:27:56.400142 [info ] [MainThread]: 
[0m12:27:56.400640 [error] [MainThread]: [31mFailure in model sales_2023 (models\staging\sales_2023.sql)[0m
[0m12:27:56.401040 [error] [MainThread]:   Database Error in model sales_2023 (models\staging\sales_2023.sql)
  Syntax error: Expected end of input but got "," at [11:15]
  compiled code at target\run\astrafy_project\models\staging\sales_2023.sql
[0m12:27:56.401386 [info ] [MainThread]: 
[0m12:27:56.401745 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\staging\sales_2023.sql
[0m12:27:56.402032 [info ] [MainThread]: 
[0m12:27:56.402657 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:27:56.403530 [debug] [MainThread]: Command `dbt run` failed at 12:27:56.403421 after 4.05 seconds
[0m12:27:56.403860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1B25F40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1B1A210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153A1B19130>]}
[0m12:27:56.404162 [debug] [MainThread]: Flushing usage events
[0m12:27:56.850847 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:28:04.029304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAFDAD2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAFB93C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAFFC33ED0>]}


============================== 12:28:04.032903 | 20eb18b2-8988-4f12-a281-753f856dd69b ==============================
[0m12:28:04.032903 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:28:04.033485 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select sales_2023', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:28:06.224814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAFDFBDA70>]}
[0m12:28:06.274123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAAB7597B0>]}
[0m12:28:06.274747 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:28:06.725604 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:28:06.839482 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:28:06.839825 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:28:06.867226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABBF8F50>]}
[0m12:28:06.923811 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:28:06.926328 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:28:06.944302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAAB7423F0>]}
[0m12:28:06.944710 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:28:06.945211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAAB803CB0>]}
[0m12:28:06.946474 [info ] [MainThread]: 
[0m12:28:06.946924 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:28:06.947348 [info ] [MainThread]: 
[0m12:28:06.947946 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:28:06.948936 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:28:06.949233 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:07.333628 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:28:07.333992 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:07.557021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABDD8C80>]}
[0m12:28:07.557431 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:28:07.561735 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:28:07.562204 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.sales_2023 ................................... [RUN]
[0m12:28:07.562754 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:28:07.563030 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:28:07.569632 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:28:07.570390 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:28:07.595051 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:28:07.596068 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */


  create or replace view `astrafy-464919`.`marts`.`sales_2023`
  OPTIONS()
  as SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023;


[0m12:28:07.596538 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:28:08.631479 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:ece2c79c-71d8-4b46-a6a6-e8549a0300d7&page=queryresults
[0m12:28:08.954426 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20eb18b2-8988-4f12-a281-753f856dd69b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABD79A90>]}
[0m12:28:08.955016 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.sales_2023 .............................. [[32mCREATE VIEW (0 processed)[0m in 1.39s]
[0m12:28:08.955924 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:28:08.957758 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:28:08.959411 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:28:08.959643 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:28:08.959827 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:28:08.960003 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:28:08.960208 [info ] [MainThread]: 
[0m12:28:08.960603 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.01 seconds (2.01s).
[0m12:28:08.961476 [debug] [MainThread]: Command end result
[0m12:28:08.979570 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:28:08.981864 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:28:08.987294 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:28:08.987597 [info ] [MainThread]: 
[0m12:28:08.988287 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:28:08.989146 [info ] [MainThread]: 
[0m12:28:08.989621 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:28:08.990637 [debug] [MainThread]: Command `dbt run` succeeded at 12:28:08.990517 after 5.07 seconds
[0m12:28:08.990967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABDD66D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABDCB250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EAABDC9270>]}
[0m12:28:08.991262 [debug] [MainThread]: Flushing usage events
[0m12:28:09.437581 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:32:39.629599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274587B2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002745660C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002745A913ED0>]}


============================== 12:32:39.633383 | fa4a41de-1a94-4047-b3f4-09444348f3c7 ==============================
[0m12:32:39.633383 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:32:39.633931 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select sales_2023', 'send_anonymous_usage_stats': 'True'}
[0m12:32:42.070537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027458C9DA70>]}
[0m12:32:42.126201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274064097B0>]}
[0m12:32:42.127364 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:32:42.628557 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:32:42.745058 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:32:42.745409 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:32:42.771441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274068A4F50>]}
[0m12:32:42.828133 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:32:42.830392 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:32:42.851332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274063F3980>]}
[0m12:32:42.851779 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:32:42.852175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274064B2190>]}
[0m12:32:42.853450 [info ] [MainThread]: 
[0m12:32:42.853932 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:32:42.854236 [info ] [MainThread]: 
[0m12:32:42.854707 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:32:42.855732 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:32:42.856149 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:43.271526 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919, now create_astrafy-464919_marts_raw)
[0m12:32:43.272001 [debug] [ThreadPool]: Creating schema "database: "astrafy-464919"
schema: "marts_raw"
"
[0m12:32:43.280725 [debug] [ThreadPool]: On create_astrafy-464919_marts_raw: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "create_astrafy-464919_marts_raw"} */
create schema if not exists `astrafy-464919`.`marts_raw`
  
[0m12:32:43.281059 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:32:43.665706 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:a4baabe8-2ee5-4e79-a50c-717f83f4a5b5&page=queryresults
[0m12:32:45.616440 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts_marts'
[0m12:32:45.617389 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:32:46.322126 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919_marts_marts, now list_astrafy-464919_marts_raw)
[0m12:32:46.322597 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:32:46.575577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027406FB9570>]}
[0m12:32:46.576034 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:32:46.581572 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:32:46.582070 [info ] [Thread-1 (]: 1 of 1 START sql view model marts_raw.sales_2023 ............................... [RUN]
[0m12:32:46.582864 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:32:46.583173 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:32:46.588498 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:32:46.589311 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:32:46.611362 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:32:46.612534 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */


  create or replace view `astrafy-464919`.`marts_raw`.`sales_2023`
  OPTIONS()
  as SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023;


[0m12:32:46.612937 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:32:47.667350 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:3d7d48b1-e827-4d67-b973-404cce282de9&page=queryresults
[0m12:32:48.006593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa4a41de-1a94-4047-b3f4-09444348f3c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027406A26210>]}
[0m12:32:48.007125 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts_raw.sales_2023 .......................... [[32mCREATE VIEW (0 processed)[0m in 1.42s]
[0m12:32:48.007978 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:32:48.009460 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:32:48.011064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:32:48.011315 [debug] [MainThread]: Connection 'create_astrafy-464919_marts_raw' was properly closed.
[0m12:32:48.011522 [debug] [MainThread]: Connection 'list_astrafy-464919_marts_raw' was properly closed.
[0m12:32:48.011714 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:32:48.011935 [info ] [MainThread]: 
[0m12:32:48.012373 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 5.16 seconds (5.16s).
[0m12:32:48.013093 [debug] [MainThread]: Command end result
[0m12:32:48.030879 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:32:48.033122 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:32:48.039010 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:32:48.039369 [info ] [MainThread]: 
[0m12:32:48.039921 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:32:48.040370 [info ] [MainThread]: 
[0m12:32:48.040781 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:32:48.041838 [debug] [MainThread]: Command `dbt run` succeeded at 12:32:48.041713 after 8.53 seconds
[0m12:32:48.042357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027406A866D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274070BCB90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274070BEB70>]}
[0m12:32:48.042681 [debug] [MainThread]: Flushing usage events
[0m12:32:48.438830 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:37:58.396274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231ED782510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231EB5DC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231EF8E3ED0>]}


============================== 12:37:58.399873 | 338c8f65-dfb1-4d25-9d1d-65d09d79cd60 ==============================
[0m12:37:58.399873 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:37:58.400460 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:38:00.479839 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "astrafy_project", target "dev" invalid: Runtime Error
    Must specify schema
[0m12:38:00.481332 [debug] [MainThread]: Command `dbt run` failed at 12:38:00.481139 after 2.23 seconds
[0m12:38:00.481875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319B40B100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319B468B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002319B3A99D0>]}
[0m12:38:00.482345 [debug] [MainThread]: Flushing usage events
[0m12:38:00.887579 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:52:08.343969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D77FD2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D75E5C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D7A133ED0>]}


============================== 12:52:08.348000 | eb21a1f8-99b6-46a9-bd6e-ecb04d3db653 ==============================
[0m12:52:08.348000 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:52:08.348899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select sales_2023', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:52:10.738352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D784BDA70>]}
[0m12:52:10.791141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D25BA97B0>]}
[0m12:52:10.791963 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:52:11.254445 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:52:11.374246 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:52:11.374680 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:52:11.379459 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.astrafy_project.staging
[0m12:52:11.404926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D2606CE50>]}
[0m12:52:11.465100 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:52:11.467736 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:52:11.490125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D25B93980>]}
[0m12:52:11.490630 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:52:11.491313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D25C52190>]}
[0m12:52:11.492809 [info ] [MainThread]: 
[0m12:52:11.493187 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:52:11.493519 [info ] [MainThread]: 
[0m12:52:11.494126 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:52:11.495277 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:52:11.495636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:52:11.903548 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919, now create_astrafy-464919_marts_marts)
[0m12:52:11.904031 [debug] [ThreadPool]: Creating schema "database: "astrafy-464919"
schema: "marts_marts"
"
[0m12:52:11.912206 [debug] [ThreadPool]: On create_astrafy-464919_marts_marts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "create_astrafy-464919_marts_marts"} */
create schema if not exists `astrafy-464919`.`marts_marts`
  
[0m12:52:11.912499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:52:12.284338 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:542ad0b6-380c-4425-a284-b7b2a7f622e3&page=queryresults
[0m12:52:14.003760 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts_marts'
[0m12:52:14.004186 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:52:14.279101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D2622C530>]}
[0m12:52:14.279607 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:52:14.284281 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:52:14.284794 [info ] [Thread-1 (]: 1 of 1 START sql table model marts_marts.sales_2023 ............................ [RUN]
[0m12:52:14.285546 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:52:14.285935 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:52:14.291932 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:52:14.293180 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:52:14.325211 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:52:14.326591 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */

  
    

    create or replace table `astrafy-464919`.`marts_marts`.`sales_2023`
      
    
    

    OPTIONS()
    as (
      --Since most of our requests require 2023 year filter, I decided to create a dedicated table to avoid repetitive filtering in each query.

SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023
    );
  
[0m12:52:14.327070 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:52:14.907126 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:9df36ed6-d5ce-4548-b185-66cc52ac82ff&page=queryresults
[0m12:52:16.394094 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb21a1f8-99b6-46a9-bd6e-ecb04d3db653', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D261CA990>]}
[0m12:52:16.394687 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts_marts.sales_2023 ....................... [[32mCREATE TABLE (19.6k rows, 1.3 MiB processed)[0m in 2.11s]
[0m12:52:16.395492 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:52:16.396693 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:52:16.398035 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:52:16.398290 [debug] [MainThread]: Connection 'create_astrafy-464919_marts_marts' was properly closed.
[0m12:52:16.398484 [debug] [MainThread]: Connection 'list_astrafy-464919_marts_marts' was properly closed.
[0m12:52:16.398662 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:52:16.398866 [info ] [MainThread]: 
[0m12:52:16.399274 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.90 seconds (4.90s).
[0m12:52:16.399862 [debug] [MainThread]: Command end result
[0m12:52:16.415702 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:52:16.418956 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:52:16.424566 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:52:16.424866 [info ] [MainThread]: 
[0m12:52:16.425362 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:52:16.425852 [info ] [MainThread]: 
[0m12:52:16.426316 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:52:16.427284 [debug] [MainThread]: Command `dbt run` succeeded at 12:52:16.427183 after 8.23 seconds
[0m12:52:16.427578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D262266D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D26818410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016D2681AC10>]}
[0m12:52:16.427864 [debug] [MainThread]: Flushing usage events
[0m12:52:16.859810 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:53:13.616710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C7F252510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C7D0BC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C01413ED0>]}


============================== 12:53:13.620311 | ae9c2496-5689-4a47-9657-2df9880388ab ==============================
[0m12:53:13.620311 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:53:13.620864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select sales_2023', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:53:16.081202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C7F73DA70>]}
[0m12:53:16.135096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2CF79590>]}
[0m12:53:16.135853 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:53:16.597842 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:53:16.719719 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:53:16.720122 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:53:16.747904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D438E50>]}
[0m12:53:16.810066 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:53:16.812776 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:53:16.833840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2CF63980>]}
[0m12:53:16.834290 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:53:16.834843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D023CB0>]}
[0m12:53:16.836351 [info ] [MainThread]: 
[0m12:53:16.836784 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:53:16.837108 [info ] [MainThread]: 
[0m12:53:16.837546 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:53:16.838452 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:53:16.838815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:53:17.194896 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919, now create_astrafy-464919_marts_marts)
[0m12:53:17.195395 [debug] [ThreadPool]: Creating schema "database: "astrafy-464919"
schema: "marts_marts"
"
[0m12:53:17.203695 [debug] [ThreadPool]: On create_astrafy-464919_marts_marts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "create_astrafy-464919_marts_marts"} */
create schema if not exists `astrafy-464919`.`marts_marts`
  
[0m12:53:17.204020 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:53:17.619463 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:61dff0dd-cee1-4a24-af93-aff32d6b0a1b&page=queryresults
[0m12:53:18.456598 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts_marts'
[0m12:53:18.457108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:53:18.667194 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919_marts_marts, now list_astrafy-464919_marts)
[0m12:53:18.667666 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:53:18.904206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2DB293D0>]}
[0m12:53:18.904640 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:53:18.909895 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:53:18.910361 [info ] [Thread-1 (]: 1 of 1 START sql table model marts_marts.sales_2023 ............................ [RUN]
[0m12:53:18.911009 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:53:18.911334 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:53:18.917020 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:53:18.917808 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:53:18.946922 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:53:18.947949 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */

  
    

    create or replace table `astrafy-464919`.`marts_marts`.`sales_2023`
      
    
    

    OPTIONS()
    as (
      --Since most of our requests require 2023 year filter, I decided to create a dedicated table to avoid repetitive filtering in each query.

SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023
    );
  
[0m12:53:18.948367 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:53:19.494695 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:95a21d6e-fda9-4de3-b4f2-ada2f72cef3c&page=queryresults
[0m12:53:21.193809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae9c2496-5689-4a47-9657-2df9880388ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D59B4D0>]}
[0m12:53:21.194385 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts_marts.sales_2023 ....................... [[32mCREATE TABLE (19.6k rows, 1.3 MiB processed)[0m in 2.28s]
[0m12:53:21.195127 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:53:21.196917 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:53:21.198257 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:53:21.198491 [debug] [MainThread]: Connection 'create_astrafy-464919_marts_marts' was properly closed.
[0m12:53:21.198701 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:53:21.198889 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:53:21.199127 [info ] [MainThread]: 
[0m12:53:21.199559 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.36 seconds (4.36s).
[0m12:53:21.200853 [debug] [MainThread]: Command end result
[0m12:53:21.218234 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:53:21.220681 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:53:21.226183 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:53:21.226510 [info ] [MainThread]: 
[0m12:53:21.226980 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:53:21.227433 [info ] [MainThread]: 
[0m12:53:21.227972 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:53:21.228833 [debug] [MainThread]: Command `dbt run` succeeded at 12:53:21.228732 after 7.73 seconds
[0m12:53:21.229169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2D5F6620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2DC3CA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C2DC3F110>]}
[0m12:53:21.229462 [debug] [MainThread]: Flushing usage events
[0m12:53:21.654463 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:54:50.430878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229EB162510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229E8FBC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229ED2C3ED0>]}


============================== 12:54:50.434335 | 243758b5-8abd-4fae-b336-aba6a38c47cb ==============================
[0m12:54:50.434335 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:54:50.434900 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise1', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:54:52.627406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229EB64DA70>]}
[0m12:54:52.678824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022998E69590>]}
[0m12:54:52.679490 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:54:53.120511 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:54:53.238342 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:54:53.238694 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:54:53.265745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022999328E50>]}
[0m12:54:53.322226 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:54:53.324404 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:54:53.342632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022998E53980>]}
[0m12:54:53.343058 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:54:53.343712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022998F13CB0>]}
[0m12:54:53.344997 [info ] [MainThread]: 
[0m12:54:53.345625 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:54:53.346044 [info ] [MainThread]: 
[0m12:54:53.346618 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:54:53.347687 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:54:53.347970 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:54:53.898938 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:54:53.899491 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:54:54.123004 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_astrafy-464919_marts, now list_astrafy-464919_marts_marts)
[0m12:54:54.124180 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:54:54.707791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229994ECA10>]}
[0m12:54:54.708268 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:54:54.713417 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m12:54:54.713854 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise1 .................................... [RUN]
[0m12:54:54.714578 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m12:54:54.714897 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m12:54:54.722811 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m12:54:54.723685 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m12:54:54.748005 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m12:54:54.749395 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as --number of orders in the year 2023
SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  --`astrafy-464919`.`raw`.`sales_recrutement`
    `astrafy-464919`.`marts_marts`.`sales_2023`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m12:54:54.749812 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:54:56.097230 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:48f6e0e9-120b-4a05-bcc8-72fb7d6bb82f&page=queryresults
[0m12:54:56.097723 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:48f6e0e9-120b-4a05-bcc8-72fb7d6bb82f&page=queryresults
[0m12:54:56.105258 [debug] [Thread-1 (]: Database Error in model exercise1 (models\marts\exercise1.sql)
  Not found: Dataset astrafy-464919:marts_marts was not found in location europe-southwest1
  compiled code at target\run\astrafy_project\models\marts\exercise1.sql
[0m12:54:56.107766 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '243758b5-8abd-4fae-b336-aba6a38c47cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022999489FD0>]}
[0m12:54:56.108298 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.exercise1 ........................... [[31mERROR[0m in 1.39s]
[0m12:54:56.109123 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m12:54:56.109803 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise1' to be skipped because of status 'error'.  Reason: Database Error in model exercise1 (models\marts\exercise1.sql)
  Not found: Dataset astrafy-464919:marts_marts was not found in location europe-southwest1
  compiled code at target\run\astrafy_project\models\marts\exercise1.sql.
[0m12:54:56.111752 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:54:56.113773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:54:56.114031 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:54:56.114233 [debug] [MainThread]: Connection 'list_astrafy-464919_marts_marts' was properly closed.
[0m12:54:56.114431 [debug] [MainThread]: Connection 'model.astrafy_project.exercise1' was properly closed.
[0m12:54:56.114665 [info ] [MainThread]: 
[0m12:54:56.115003 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.77 seconds (2.77s).
[0m12:54:56.115661 [debug] [MainThread]: Command end result
[0m12:54:56.133338 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:54:56.135533 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:54:56.141085 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:54:56.141567 [info ] [MainThread]: 
[0m12:54:56.142398 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:54:56.143411 [info ] [MainThread]: 
[0m12:54:56.143907 [error] [MainThread]: [31mFailure in model exercise1 (models\marts\exercise1.sql)[0m
[0m12:54:56.144644 [error] [MainThread]:   Database Error in model exercise1 (models\marts\exercise1.sql)
  Not found: Dataset astrafy-464919:marts_marts was not found in location europe-southwest1
  compiled code at target\run\astrafy_project\models\marts\exercise1.sql
[0m12:54:56.145102 [info ] [MainThread]: 
[0m12:54:56.145610 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise1.sql
[0m12:54:56.146021 [info ] [MainThread]: 
[0m12:54:56.146411 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m12:54:56.147309 [debug] [MainThread]: Command `dbt run` failed at 12:54:56.147208 after 5.82 seconds
[0m12:54:56.147609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229992DB8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229994C9E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000229994C8870>]}
[0m12:54:56.147887 [debug] [MainThread]: Flushing usage events
[0m12:54:56.645950 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:56:19.245486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B946122510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B943F8C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9472B3ED0>]}


============================== 12:56:19.249141 | 41f94c0b-1df5-4ce5-a9ed-7f4032d28597 ==============================
[0m12:56:19.249141 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:56:19.249819 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select sales_2023', 'send_anonymous_usage_stats': 'True'}
[0m12:56:21.445506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B946609A70>]}
[0m12:56:21.494644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B973CC9590>]}
[0m12:56:21.495306 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:56:21.943697 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:56:22.059414 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:56:22.059903 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:56:22.086515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B974188E50>]}
[0m12:56:22.145950 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:56:22.148241 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:56:22.170601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B973CB3980>]}
[0m12:56:22.171043 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:56:22.171452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B973D73CB0>]}
[0m12:56:22.172809 [info ] [MainThread]: 
[0m12:56:22.173273 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:56:22.173695 [info ] [MainThread]: 
[0m12:56:22.174359 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:56:22.175346 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:56:22.175648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:56:22.547661 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:56:22.548154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:56:22.767594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B97434CE20>]}
[0m12:56:22.768037 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:56:22.772451 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m12:56:22.772842 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.sales_2023 .................................. [RUN]
[0m12:56:22.773420 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.sales_2023'
[0m12:56:22.773774 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m12:56:22.780729 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m12:56:22.781523 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m12:56:22.812805 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m12:56:22.813811 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`sales_2023`
      
    
    

    OPTIONS()
    as (
      --Since most of our requests require 2023 year filter, I decided to create a dedicated table to avoid repetitive filtering in each query.

SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023
    );
  
[0m12:56:22.814228 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:56:23.225859 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:98721f20-7d53-4cb7-abbb-059ad74e3bc8&page=queryresults
[0m12:56:24.692712 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41f94c0b-1df5-4ce5-a9ed-7f4032d28597', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9742EB050>]}
[0m12:56:24.693306 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts.sales_2023 ............................. [[32mCREATE TABLE (19.6k rows, 1.3 MiB processed)[0m in 1.92s]
[0m12:56:24.694493 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m12:56:24.695928 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:56:24.697170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:56:24.697390 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:56:24.697588 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:56:24.697762 [debug] [MainThread]: Connection 'model.astrafy_project.sales_2023' was properly closed.
[0m12:56:24.697957 [info ] [MainThread]: 
[0m12:56:24.698249 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.52 seconds (2.52s).
[0m12:56:24.698819 [debug] [MainThread]: Command end result
[0m12:56:24.716295 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:56:24.718642 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:56:24.723591 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:56:24.723919 [info ] [MainThread]: 
[0m12:56:24.724586 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:56:24.725048 [info ] [MainThread]: 
[0m12:56:24.725543 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:56:24.726407 [debug] [MainThread]: Command `dbt run` succeeded at 12:56:24.726306 after 5.62 seconds
[0m12:56:24.726704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9743466D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B97432B930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B974329590>]}
[0m12:56:24.726975 [debug] [MainThread]: Flushing usage events
[0m12:56:25.166822 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:56:48.692027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9638A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9616FC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9659FFED0>]}


============================== 12:56:48.695719 | 087f9f84-f4c7-4d3c-b217-6a1f7f411e46 ==============================
[0m12:56:48.695719 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:56:48.696289 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select exercise1', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:56:50.917283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B963D8DA70>]}
[0m12:56:50.966349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9114A9590>]}
[0m12:56:50.967004 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:56:51.430334 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:56:51.546057 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:56:51.546394 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:56:51.573389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911968E50>]}
[0m12:56:51.634366 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:56:51.636741 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:56:51.655948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911493980>]}
[0m12:56:51.656385 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:56:51.656868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911553CB0>]}
[0m12:56:51.658155 [info ] [MainThread]: 
[0m12:56:51.658645 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:56:51.659066 [info ] [MainThread]: 
[0m12:56:51.659759 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:56:51.660664 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:56:51.660963 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:56:52.002226 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:56:52.002748 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:56:52.236697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911B2C940>]}
[0m12:56:52.237104 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:56:52.242473 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m12:56:52.243333 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise1 .................................... [RUN]
[0m12:56:52.243978 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m12:56:52.244253 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m12:56:52.251047 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m12:56:52.251787 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m12:56:52.276634 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m12:56:52.277671 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as --number of orders in the year 2023
SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
  --`astrafy-464919`.`raw`.`sales_recrutement`
    `astrafy-464919`.`marts`.`sales_2023`
WHERE 
  EXTRACT(YEAR FROM date_date) = 2023;


[0m12:56:52.278055 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:56:53.140520 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:53815b78-3217-452e-9548-7a0776f21670&page=queryresults
[0m12:56:53.452228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '087f9f84-f4c7-4d3c-b217-6a1f7f411e46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911AC7110>]}
[0m12:56:53.452806 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise1 ............................... [[32mCREATE VIEW (0 processed)[0m in 1.21s]
[0m12:56:53.453786 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m12:56:53.455229 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:56:53.456650 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:56:53.456942 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:56:53.457192 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:56:53.457369 [debug] [MainThread]: Connection 'model.astrafy_project.exercise1' was properly closed.
[0m12:56:53.457578 [info ] [MainThread]: 
[0m12:56:53.457900 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.80 seconds (1.80s).
[0m12:56:53.458485 [debug] [MainThread]: Command end result
[0m12:56:53.475521 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:56:53.477811 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:56:53.483224 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:56:53.483553 [info ] [MainThread]: 
[0m12:56:53.484091 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:56:53.484537 [info ] [MainThread]: 
[0m12:56:53.485077 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:56:53.486170 [debug] [MainThread]: Command `dbt run` succeeded at 12:56:53.485938 after 4.90 seconds
[0m12:56:53.486474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911B26830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911B03930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B911B016D0>]}
[0m12:56:53.486751 [debug] [MainThread]: Flushing usage events
[0m12:56:53.930222 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:57:30.500992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000256D68B2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000256D470C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000256D8A13ED0>]}


============================== 12:57:30.504589 | 883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75 ==============================
[0m12:57:30.504589 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:57:30.505144 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise1', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:57:32.694238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000256D6D91A70>]}
[0m12:57:32.743532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684469590>]}
[0m12:57:32.744183 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:57:33.207233 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:57:33.328144 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:57:33.328494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:57:33.354510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684928E50>]}
[0m12:57:33.410621 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:57:33.412953 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:57:33.432000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684453980>]}
[0m12:57:33.432527 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:57:33.433011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684513CB0>]}
[0m12:57:33.434459 [info ] [MainThread]: 
[0m12:57:33.434843 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:57:33.435130 [info ] [MainThread]: 
[0m12:57:33.435581 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:57:33.436570 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:57:33.436964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:57:33.791857 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:57:33.792225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:57:34.014782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684AEC530>]}
[0m12:57:34.015222 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:57:34.020756 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m12:57:34.021508 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise1 .................................... [RUN]
[0m12:57:34.022119 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise1'
[0m12:57:34.022443 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m12:57:34.029119 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m12:57:34.029870 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m12:57:34.054985 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m12:57:34.055992 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as --number of orders in the year 2023
SELECT
  count(DISTINCT order_id) AS order_count_2023
FROM 
    `astrafy-464919`.`marts`.`sales_2023`;


[0m12:57:34.056408 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:57:34.470725 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c294cd26-3537-4f8c-85a2-dc3ed0259703&page=queryresults
[0m12:57:34.732272 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '883ba2f0-8090-4f1e-a2d6-fdb71fa0eb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684A8B1D0>]}
[0m12:57:34.732870 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise1 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.71s]
[0m12:57:34.733752 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m12:57:34.735408 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:57:34.736808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:57:34.737057 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:57:34.737248 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:57:34.737418 [debug] [MainThread]: Connection 'model.astrafy_project.exercise1' was properly closed.
[0m12:57:34.737626 [info ] [MainThread]: 
[0m12:57:34.738092 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.30 seconds (1.30s).
[0m12:57:34.738874 [debug] [MainThread]: Command end result
[0m12:57:34.755305 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:57:34.757572 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:57:34.762449 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:57:34.762740 [info ] [MainThread]: 
[0m12:57:34.763264 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:57:34.763579 [info ] [MainThread]: 
[0m12:57:34.763896 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:57:34.764678 [debug] [MainThread]: Command `dbt run` succeeded at 12:57:34.764569 after 4.38 seconds
[0m12:57:34.764965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684AE68E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684ACB610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025684AC96D0>]}
[0m12:57:34.765247 [debug] [MainThread]: Flushing usage events
[0m12:57:35.205095 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:52.902834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE70E52510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE6ECAC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE72FC3ED0>]}


============================== 12:59:52.906487 | ba2877a5-eb14-4077-8719-8e517ab7c035 ==============================
[0m12:59:52.906487 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:59:52.907036 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select exercise2', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:59:55.329349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE71339A70>]}
[0m12:59:55.380186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1EB69590>]}
[0m12:59:55.380841 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:59:55.847852 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m12:59:55.975539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:59:55.975958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:59:56.006137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F008F50>]}
[0m12:59:56.069048 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:59:56.071170 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:59:56.090764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1EB53980>]}
[0m12:59:56.091237 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m12:59:56.091715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1EC13CB0>]}
[0m12:59:56.092962 [info ] [MainThread]: 
[0m12:59:56.093350 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:59:56.093733 [info ] [MainThread]: 
[0m12:59:56.094202 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:59:56.095070 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m12:59:56.095383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:59:56.548808 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m12:59:56.549184 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:59:56.795516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F1ECC80>]}
[0m12:59:56.795918 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:59:56.800757 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m12:59:56.801242 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise2 .................................... [RUN]
[0m12:59:56.801971 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise2'
[0m12:59:56.802270 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m12:59:56.809018 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m12:59:56.810028 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m12:59:56.834722 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m12:59:56.836131 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`marts`.`exercise2`
  OPTIONS()
  as --Number of orders per month in the year 2023
SELECT
  EXTRACT(MONTH FROM date_date) AS month,
  COUNT(DISTINCT order_id) AS orders_count

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY MONTH
ORDER BY MONTH;


[0m12:59:56.836560 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m12:59:57.706651 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:10bcf0b5-cb93-4f2f-afd7-8566af54d2a0&page=queryresults
[0m12:59:58.059853 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba2877a5-eb14-4077-8719-8e517ab7c035', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F187110>]}
[0m12:59:58.060544 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise2 ............................... [[32mCREATE VIEW (0 processed)[0m in 1.26s]
[0m12:59:58.061280 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m12:59:58.062652 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:59:58.064049 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:59:58.064342 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m12:59:58.064542 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m12:59:58.064729 [debug] [MainThread]: Connection 'model.astrafy_project.exercise2' was properly closed.
[0m12:59:58.065000 [info ] [MainThread]: 
[0m12:59:58.065460 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.97 seconds (1.97s).
[0m12:59:58.066233 [debug] [MainThread]: Command end result
[0m12:59:58.083359 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m12:59:58.085777 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m12:59:58.091912 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m12:59:58.092297 [info ] [MainThread]: 
[0m12:59:58.093036 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:59:58.093805 [info ] [MainThread]: 
[0m12:59:58.094438 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m12:59:58.095425 [debug] [MainThread]: Command `dbt run` succeeded at 12:59:58.095315 after 5.31 seconds
[0m12:59:58.095734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F1E68E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F1CB750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AE1F1C96D0>]}
[0m12:59:58.096025 [debug] [MainThread]: Flushing usage events
[0m12:59:58.551997 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:00:03.503964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015273F12510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015271D7C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015276073ED0>]}


============================== 13:00:03.507745 | 6f1224f1-3071-484e-9826-cde8e8f34372 ==============================
[0m13:00:03.507745 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:00:03.508363 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select exercise3', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:00:05.855330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000152743FDA70>]}
[0m13:00:05.914619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015223009590>]}
[0m13:00:05.915329 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:00:06.417640 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:00:06.537321 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:00:06.537733 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:00:06.564173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000152234A4F50>]}
[0m13:00:06.621334 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:00:06.623745 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:00:06.644773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015222FF3980>]}
[0m13:00:06.645254 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:00:06.645782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000152230B3CB0>]}
[0m13:00:06.647249 [info ] [MainThread]: 
[0m13:00:06.647764 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:00:06.648117 [info ] [MainThread]: 
[0m13:00:06.648621 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:00:06.649522 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:00:06.649869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:07.005195 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:00:07.005570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:07.244708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001522368C390>]}
[0m13:00:07.245156 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:00:07.250035 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:00:07.250466 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:00:07.251137 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:00:07.251469 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:00:07.258378 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:00:07.259183 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:00:07.283759 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:00:07.284899 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year
ORDER BY month_year;


[0m13:00:07.285359 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:00:07.665626 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:d11c838a-b3e4-43b7-a850-2e7afcadd363&page=queryresults
[0m13:00:07.927464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f1224f1-3071-484e-9826-cde8e8f34372', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001522362B110>]}
[0m13:00:07.928121 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.67s]
[0m13:00:07.928864 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:00:07.929981 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:00:07.931316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:00:07.931555 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:00:07.931754 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:00:07.931961 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:00:07.932164 [info ] [MainThread]: 
[0m13:00:07.932500 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m13:00:07.933129 [debug] [MainThread]: Command end result
[0m13:00:07.950118 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:00:07.952835 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:00:07.961870 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:00:07.962406 [info ] [MainThread]: 
[0m13:00:07.963109 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:00:07.963538 [info ] [MainThread]: 
[0m13:00:07.963918 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:00:07.964771 [debug] [MainThread]: Command `dbt run` succeeded at 13:00:07.964665 after 4.56 seconds
[0m13:00:07.965087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000152236868E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015223663890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000152236616D0>]}
[0m13:00:07.965392 [debug] [MainThread]: Flushing usage events
[0m13:00:08.384030 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:01:20.789743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F1A492510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F182EC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F1C603ED0>]}


============================== 13:01:20.793237 | 6e0ec0fc-a41c-4227-ae65-355f5ca1dc49 ==============================
[0m13:01:20.793237 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:01:20.793786 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise3', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:01:23.054252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F1A971A70>]}
[0m13:01:23.108353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F47FF9590>]}
[0m13:01:23.109101 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:01:23.552373 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:01:23.667097 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:01:23.667508 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:01:23.695117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F48498F50>]}
[0m13:01:23.755085 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:01:23.757391 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:01:23.781220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F47FE3980>]}
[0m13:01:23.781651 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:01:23.782175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F480A3CB0>]}
[0m13:01:23.783696 [info ] [MainThread]: 
[0m13:01:23.784226 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:01:23.784624 [info ] [MainThread]: 
[0m13:01:23.785415 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:01:23.786636 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:01:23.786998 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:24.149381 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:01:24.149759 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:24.360771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F4867C460>]}
[0m13:01:24.361330 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:01:24.366295 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:01:24.367160 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:01:24.367915 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:01:24.368508 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:01:24.375576 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:01:24.376584 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:01:24.401631 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:01:24.402742 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year
ORDER BY date_date;


[0m13:01:24.403195 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:01:25.274512 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c1d3d3d1-761d-4854-a7bb-7ae235b2c033&page=queryresults
[0m13:01:25.352543 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:c1d3d3d1-761d-4854-a7bb-7ae235b2c033&page=queryresults
[0m13:01:25.360241 [debug] [Thread-1 (]: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:10]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:01:25.362442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e0ec0fc-a41c-4227-ae65-355f5ca1dc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F4861A450>]}
[0m13:01:25.363029 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.exercise3 ........................... [[31mERROR[0m in 0.99s]
[0m13:01:25.363606 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:01:25.364170 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise3' to be skipped because of status 'error'.  Reason: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:10]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql.
[0m13:01:25.366684 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:01:25.368248 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:25.368491 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:01:25.368688 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:01:25.368885 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:01:25.369136 [info ] [MainThread]: 
[0m13:01:25.369601 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.58 seconds (1.58s).
[0m13:01:25.370905 [debug] [MainThread]: Command end result
[0m13:01:25.401564 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:01:25.404583 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:01:25.411202 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:01:25.411722 [info ] [MainThread]: 
[0m13:01:25.412458 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:01:25.413174 [info ] [MainThread]: 
[0m13:01:25.413803 [error] [MainThread]: [31mFailure in model exercise3 (models\marts\exercise3.sql)[0m
[0m13:01:25.414317 [error] [MainThread]:   Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:10]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:01:25.414828 [info ] [MainThread]: 
[0m13:01:25.415352 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise3.sql
[0m13:01:25.415916 [info ] [MainThread]: 
[0m13:01:25.416327 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:01:25.417167 [debug] [MainThread]: Command `dbt run` failed at 13:01:25.417057 after 4.73 seconds
[0m13:01:25.417472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F48676150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F48659630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018F48659590>]}
[0m13:01:25.417749 [debug] [MainThread]: Flushing usage events
[0m13:01:25.809735 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:01:46.421947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ED0DE2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ECEC3C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ED2F43ED0>]}


============================== 13:01:46.425383 | cef82cc9-5b0c-4137-a007-36798ef34019 ==============================
[0m13:01:46.425383 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:01:46.425936 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select exercise3', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:01:48.599267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028ED12CDA70>]}
[0m13:01:48.647952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFD989590>]}
[0m13:01:48.648568 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:01:49.085608 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:01:49.200441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:01:49.200836 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:01:49.228194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEDF4F50>]}
[0m13:01:49.284708 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:01:49.286885 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:01:49.305018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFD973980>]}
[0m13:01:49.305508 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:01:49.305882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEA03CB0>]}
[0m13:01:49.307066 [info ] [MainThread]: 
[0m13:01:49.307450 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:01:49.307749 [info ] [MainThread]: 
[0m13:01:49.308185 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:01:49.309158 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:01:49.309640 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:49.670491 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:01:49.670833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:49.868712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEFDC460>]}
[0m13:01:49.869106 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:01:49.873977 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:01:49.874374 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:01:49.875338 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:01:49.875618 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:01:49.882039 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:01:49.882789 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:01:49.907478 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:01:49.908442 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year
ORDER BY date_trunc(CAST(date_date AS DATE), MONTH);


[0m13:01:49.908819 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:01:50.243419 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:1416477e-14ee-4e7c-8efd-83badfe8d7ee&page=queryresults
[0m13:01:50.298550 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:1416477e-14ee-4e7c-8efd-83badfe8d7ee&page=queryresults
[0m13:01:50.305437 [debug] [Thread-1 (]: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:01:50.307297 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cef82cc9-5b0c-4137-a007-36798ef34019', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEF79850>]}
[0m13:01:50.307800 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.exercise3 ........................... [[31mERROR[0m in 0.43s]
[0m13:01:50.308565 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:01:50.309088 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise3' to be skipped because of status 'error'.  Reason: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql.
[0m13:01:50.311550 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:01:50.312871 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:50.313112 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:01:50.313308 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:01:50.313499 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:01:50.313713 [info ] [MainThread]: 
[0m13:01:50.314114 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m13:01:50.314916 [debug] [MainThread]: Command end result
[0m13:01:50.331672 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:01:50.333802 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:01:50.339079 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:01:50.339356 [info ] [MainThread]: 
[0m13:01:50.339871 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:01:50.340309 [info ] [MainThread]: 
[0m13:01:50.341225 [error] [MainThread]: [31mFailure in model exercise3 (models\marts\exercise3.sql)[0m
[0m13:01:50.341991 [error] [MainThread]:   Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:01:50.342389 [info ] [MainThread]: 
[0m13:01:50.342860 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise3.sql
[0m13:01:50.343276 [info ] [MainThread]: 
[0m13:01:50.343747 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:01:50.344560 [debug] [MainThread]: Command `dbt run` failed at 13:01:50.344454 after 4.02 seconds
[0m13:01:50.344872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEFD6150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEFB9590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028EFEFB9810>]}
[0m13:01:50.345146 [debug] [MainThread]: Flushing usage events
[0m13:01:50.752933 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:02:38.198261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018621052510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001861EEAC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000186231C3ED0>]}


============================== 13:02:38.201898 | f7d12f46-24b2-4d5d-8065-fdf0319ea5a8 ==============================
[0m13:02:38.201898 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:02:38.202455 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise3', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:02:40.385079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001862153DA70>]}
[0m13:02:40.435091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864EBC9590>]}
[0m13:02:40.435717 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:02:40.879503 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:02:40.992407 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:02:40.992747 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:02:41.018090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F068F50>]}
[0m13:02:41.076705 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:02:41.078799 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:02:41.097354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864EBB3980>]}
[0m13:02:41.097772 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:02:41.098278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864EC73CB0>]}
[0m13:02:41.099454 [info ] [MainThread]: 
[0m13:02:41.099933 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:02:41.100362 [info ] [MainThread]: 
[0m13:02:41.100870 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:02:41.101893 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:02:41.102166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:41.489566 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:02:41.490126 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:41.714262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F24CBB0>]}
[0m13:02:41.714892 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:02:41.720116 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:02:41.720585 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:02:41.721196 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:02:41.721889 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:02:41.728741 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:02:41.729607 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:02:41.753331 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:02:41.754388 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m13:02:41.754786 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:02:42.214833 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:158915b2-8f11-494b-8024-b5259683ecf3&page=queryresults
[0m13:02:42.491325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7d12f46-24b2-4d5d-8065-fdf0319ea5a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F1E7110>]}
[0m13:02:42.491912 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.77s]
[0m13:02:42.492637 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:02:42.493821 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:02:42.495070 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:02:42.495292 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:02:42.495488 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:02:42.495689 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:02:42.495896 [info ] [MainThread]: 
[0m13:02:42.496235 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.40 seconds (1.40s).
[0m13:02:42.496835 [debug] [MainThread]: Command end result
[0m13:02:42.513422 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:02:42.515738 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:02:42.521009 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:02:42.521308 [info ] [MainThread]: 
[0m13:02:42.521773 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:02:42.522117 [info ] [MainThread]: 
[0m13:02:42.522412 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:02:42.523210 [debug] [MainThread]: Command `dbt run` succeeded at 13:02:42.523090 after 4.43 seconds
[0m13:02:42.523502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F2468E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F227890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864F2256D0>]}
[0m13:02:42.523825 [debug] [MainThread]: Flushing usage events
[0m13:02:42.900488 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:05.846751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A5FFE2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A5DE3C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A62143ED0>]}


============================== 13:03:05.850685 | 8fd7973a-8059-4e7e-b2db-88cd5554e497 ==============================
[0m13:03:05.850685 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:03:05.851395 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise3', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:03:08.066825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A604CDA70>]}
[0m13:03:08.115588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0DBA9590>]}
[0m13:03:08.116234 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:03:08.563097 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:03:08.681336 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:03:08.681712 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:03:08.709810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E044F50>]}
[0m13:03:08.772809 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:03:08.774961 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:03:08.795133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0DB93980>]}
[0m13:03:08.795602 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:03:08.796001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0DC53CB0>]}
[0m13:03:08.797233 [info ] [MainThread]: 
[0m13:03:08.797893 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:03:08.798344 [info ] [MainThread]: 
[0m13:03:08.798934 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:03:08.800114 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:03:08.800514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:09.176717 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:03:09.177057 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:09.414892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E22C870>]}
[0m13:03:09.415303 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:09.420147 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:03:09.420907 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:03:09.421510 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:03:09.421795 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:03:09.428768 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:03:09.429665 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:03:09.454933 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:03:09.456318 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m13:03:09.456793 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:03:09.813343 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6b52bced-15c0-4e34-8239-aff8ce577e71&page=queryresults
[0m13:03:09.865196 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6b52bced-15c0-4e34-8239-aff8ce577e71&page=queryresults
[0m13:03:09.872050 [debug] [Thread-1 (]: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:03:09.874071 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fd7973a-8059-4e7e-b2db-88cd5554e497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E1CA150>]}
[0m13:03:09.874585 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.exercise3 ........................... [[31mERROR[0m in 0.45s]
[0m13:03:09.875299 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:03:09.876094 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise3' to be skipped because of status 'error'.  Reason: Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql.
[0m13:03:09.878131 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:03:09.879575 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:09.879856 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:03:09.880053 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:03:09.880246 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:03:09.880473 [info ] [MainThread]: 
[0m13:03:09.880919 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.08 seconds (1.08s).
[0m13:03:09.881553 [debug] [MainThread]: Command end result
[0m13:03:09.899106 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:03:09.901546 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:03:09.906513 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:03:09.906910 [info ] [MainThread]: 
[0m13:03:09.907444 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:03:09.907790 [info ] [MainThread]: 
[0m13:03:09.908161 [error] [MainThread]: [31mFailure in model exercise3 (models\marts\exercise3.sql)[0m
[0m13:03:09.908496 [error] [MainThread]:   Database Error in model exercise3 (models\marts\exercise3.sql)
  ORDER BY clause expression references column date_date which is neither grouped nor aggregated at [18:26]
  compiled code at target\run\astrafy_project\models\marts\exercise3.sql
[0m13:03:09.908903 [info ] [MainThread]: 
[0m13:03:09.909260 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise3.sql
[0m13:03:09.909699 [info ] [MainThread]: 
[0m13:03:09.910035 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:03:09.910891 [debug] [MainThread]: Command `dbt run` failed at 13:03:09.910786 after 4.16 seconds
[0m13:03:09.911193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E226150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E209590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A0E209630>]}
[0m13:03:09.911474 [debug] [MainThread]: Flushing usage events
[0m13:03:10.345960 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:45.098905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D70D802510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D70B66C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D70F973ED0>]}


============================== 13:03:45.102344 | efdf45e2-24f8-45ec-80e8-b98501f12042 ==============================
[0m13:03:45.102344 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:03:45.102930 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise3', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:03:47.458794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D70DCE9A70>]}
[0m13:03:47.512554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B369590>]}
[0m13:03:47.513346 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:03:48.038168 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:03:48.177027 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:03:48.177454 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:03:48.205898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B804F50>]}
[0m13:03:48.275247 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:03:48.277728 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:03:48.305730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B353980>]}
[0m13:03:48.306455 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:03:48.307041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B413CB0>]}
[0m13:03:48.308787 [info ] [MainThread]: 
[0m13:03:48.309517 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:03:48.309990 [info ] [MainThread]: 
[0m13:03:48.310710 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:03:48.312382 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:03:48.312889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:48.683765 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:03:48.684330 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:48.903427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B9EC7A0>]}
[0m13:03:48.903927 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:48.908578 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:03:48.909098 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m13:03:48.909914 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m13:03:48.910853 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:03:48.918705 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:03:48.919724 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:03:48.946443 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:03:48.947561 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m13:03:48.948023 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:03:49.338983 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:dbc147ca-53d5-4ab9-91d0-018851c0713e&page=queryresults
[0m13:03:49.542742 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efdf45e2-24f8-45ec-80e8-b98501f12042', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B98B110>]}
[0m13:03:49.543591 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.63s]
[0m13:03:49.544387 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:03:49.546059 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:03:49.547975 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:49.548266 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:03:49.548504 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:03:49.548713 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:03:49.548969 [info ] [MainThread]: 
[0m13:03:49.549340 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.24 seconds (1.24s).
[0m13:03:49.549973 [debug] [MainThread]: Command end result
[0m13:03:49.568238 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:03:49.571290 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:03:49.577103 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:03:49.577458 [info ] [MainThread]: 
[0m13:03:49.577926 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:03:49.578222 [info ] [MainThread]: 
[0m13:03:49.578539 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:03:49.579375 [debug] [MainThread]: Command `dbt run` succeeded at 13:03:49.579268 after 4.60 seconds
[0m13:03:49.579686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B9E68E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B9CB750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002D73B9C96D0>]}
[0m13:03:49.579984 [debug] [MainThread]: Flushing usage events
[0m13:03:50.020020 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:07:42.935750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EF2A42510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EF08AC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EF4BB3ED0>]}


============================== 13:07:42.939244 | c610dbca-0aaf-4c27-9c64-9da1795dc38d ==============================
[0m13:07:42.939244 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:07:42.939833 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select exercise4', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:07:45.065755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EF2F29A70>]}
[0m13:07:45.117983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0669590>]}
[0m13:07:45.118679 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:07:45.553679 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:07:45.664004 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:07:45.664329 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:07:45.689075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0B08F50>]}
[0m13:07:45.744955 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:07:45.747033 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:07:45.768436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0653980>]}
[0m13:07:45.768843 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:07:45.769338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0713CB0>]}
[0m13:07:45.770544 [info ] [MainThread]: 
[0m13:07:45.770973 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:07:45.771382 [info ] [MainThread]: 
[0m13:07:45.771983 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:07:45.773001 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:07:45.773261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:46.187516 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:07:46.187850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:46.419008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0CEC870>]}
[0m13:07:46.420202 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:07:46.429317 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m13:07:46.429717 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise4 .................................... [RUN]
[0m13:07:46.430235 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m13:07:46.430498 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m13:07:46.436741 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m13:07:46.437778 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m13:07:46.461794 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m13:07:46.462854 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as --Create a table (1 line per order) for all orders in the year 2022 and 2023 with a qty_product column that gives the total quantity of products in the order
SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  SUM(net_sales) AS net_sales,
  SUM(qty) AS qty_product
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`

WHERE 
  EXTRACT(YEAR FROM CAST(date_date AS DATE)) IN (2022, 2023)
  
GROUP BY order_id
ORDER BY order_date;


[0m13:07:46.463353 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:07:47.371759 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:530eea99-56f4-40c2-a20d-9389f55eb568&page=queryresults
[0m13:07:47.728524 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c610dbca-0aaf-4c27-9c64-9da1795dc38d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0C8B110>]}
[0m13:07:47.729109 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 1.30s]
[0m13:07:47.729936 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m13:07:47.731270 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:07:47.732876 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:07:47.733115 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:07:47.733373 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:07:47.733544 [debug] [MainThread]: Connection 'model.astrafy_project.exercise4' was properly closed.
[0m13:07:47.733747 [info ] [MainThread]: 
[0m13:07:47.734136 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.96 seconds (1.96s).
[0m13:07:47.734920 [debug] [MainThread]: Command end result
[0m13:07:47.752083 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:07:47.754220 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:07:47.759082 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:07:47.759336 [info ] [MainThread]: 
[0m13:07:47.759838 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:07:47.760163 [info ] [MainThread]: 
[0m13:07:47.760512 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:07:47.761583 [debug] [MainThread]: Command `dbt run` succeeded at 13:07:47.761448 after 4.94 seconds
[0m13:07:47.761905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0CE68E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0CCB750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017EA0CC96D0>]}
[0m13:07:47.762241 [debug] [MainThread]: Flushing usage events
[0m13:07:48.234411 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:10:42.855750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B2EF52510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B2CE1C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B300E3ED0>]}


============================== 13:10:42.859351 | be4d4419-7906-4caa-b98d-b445bea36b42 ==============================
[0m13:10:42.859351 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:10:42.859895 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise4', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:10:45.088871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B2F43DA70>]}
[0m13:10:45.137866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5CAB9590>]}
[0m13:10:45.138561 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:10:45.594648 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:10:45.706981 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:10:45.707340 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:10:45.734998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5CF54F50>]}
[0m13:10:45.792424 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:10:45.794663 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:10:45.814410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5CA9F980>]}
[0m13:10:45.814823 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:10:45.815310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5CB63CB0>]}
[0m13:10:45.816542 [info ] [MainThread]: 
[0m13:10:45.817169 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:10:45.817636 [info ] [MainThread]: 
[0m13:10:45.818217 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:10:45.819302 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:10:45.819604 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:10:46.178800 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:10:46.179194 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:10:46.415237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5D13CBB0>]}
[0m13:10:46.415663 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:10:46.420294 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m13:10:46.420799 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise4 .................................... [RUN]
[0m13:10:46.421390 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m13:10:46.421671 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m13:10:46.428311 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m13:10:46.429105 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m13:10:46.453027 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m13:10:46.454060 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as --Create a table (1 line per order) for all orders in the year 2022 and 2023 with a qty_product column that gives the total quantity of products in the order
SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  ROUND(SUM(net_sales),2) AS net_sales,
  SUM(qty) AS qty_product
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`

WHERE 
  EXTRACT(YEAR FROM CAST(date_date AS DATE)) IN (2022, 2023)

GROUP BY order_id
ORDER BY order_date;


[0m13:10:46.454471 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:10:46.893618 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:b5fb622b-8023-4460-a282-3350b4b5a7a5&page=queryresults
[0m13:10:47.133527 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'be4d4419-7906-4caa-b98d-b445bea36b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5D0D5B50>]}
[0m13:10:47.134102 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.71s]
[0m13:10:47.134882 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m13:10:47.136144 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:10:47.137556 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:10:47.137813 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:10:47.138020 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:10:47.138191 [debug] [MainThread]: Connection 'model.astrafy_project.exercise4' was properly closed.
[0m13:10:47.138401 [info ] [MainThread]: 
[0m13:10:47.138839 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.32 seconds (1.32s).
[0m13:10:47.139554 [debug] [MainThread]: Command end result
[0m13:10:47.155717 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:10:47.158130 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:10:47.163791 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:10:47.164104 [info ] [MainThread]: 
[0m13:10:47.164532 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:10:47.164842 [info ] [MainThread]: 
[0m13:10:47.165259 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:10:47.166182 [debug] [MainThread]: Command `dbt run` succeeded at 13:10:47.166051 after 4.42 seconds
[0m13:10:47.166499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5D1368E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5D11B610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020B5D1196D0>]}
[0m13:10:47.166807 [debug] [MainThread]: Flushing usage events
[0m13:10:47.665305 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:29:00.152077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2DA9B2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2D882C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2DCB0FED0>]}


============================== 13:29:00.156573 | aaa62fbf-6de3-4113-bfa2-7fa479784041 ==============================
[0m13:29:00.156573 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:29:00.157144 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise5', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:29:04.769291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2DAE9DA70>]}
[0m13:29:04.818237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2885D9590>]}
[0m13:29:04.818893 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:29:05.367315 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:29:05.497434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:29:05.497884 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:29:05.525233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288A78F50>]}
[0m13:29:05.583445 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:29:05.587431 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:29:05.613133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A2885C3980>]}
[0m13:29:05.613579 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:29:05.613961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288683CB0>]}
[0m13:29:05.615181 [info ] [MainThread]: 
[0m13:29:05.615675 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:29:05.616056 [info ] [MainThread]: 
[0m13:29:05.616825 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:29:05.617756 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:29:05.618091 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:06.033960 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:29:06.034600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:06.292431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288C5C600>]}
[0m13:29:06.292854 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:29:06.297765 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:29:06.298243 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:29:06.298951 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:29:06.299286 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:29:06.306177 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:29:06.307294 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:29:06.331400 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:29:06.332625 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH sales_orders AS (
    SELECT
        customer_id,
        order_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customer_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM 
        `astrafy-464919`.`marts`.`sales_2023` AS s
)

SELECT
    order_id,
    customer_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m13:29:06.333041 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:29:06.796198 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6054488c-2158-4460-a10c-a527db8f89a4&page=queryresults
[0m13:29:07.920465 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaa62fbf-6de3-4113-bfa2-7fa479784041', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288BF5B50>]}
[0m13:29:07.921168 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 1.62s]
[0m13:29:07.921848 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:29:07.922989 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:29:07.924502 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:29:07.924804 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:29:07.925065 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:29:07.925267 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:29:07.925496 [info ] [MainThread]: 
[0m13:29:07.925800 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.31 seconds (2.31s).
[0m13:29:07.926428 [debug] [MainThread]: Command end result
[0m13:29:07.942736 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:29:07.945067 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:29:07.950907 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:29:07.951276 [info ] [MainThread]: 
[0m13:29:07.951822 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:29:07.952203 [info ] [MainThread]: 
[0m13:29:07.952595 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:29:07.953505 [debug] [MainThread]: Command `dbt run` succeeded at 13:29:07.953359 after 7.92 seconds
[0m13:29:07.953833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288C568E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288C3B610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A288C396D0>]}
[0m13:29:07.954137 [debug] [MainThread]: Flushing usage events
[0m13:29:08.536847 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:30:41.605170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001552A5A2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001552840C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001552C703ED0>]}


============================== 13:30:41.609252 | 58115d0e-7f51-4c7c-a064-eb8539b776d9 ==============================
[0m13:30:41.609252 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:30:41.609893 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select exercise5', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:30:44.287587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001552AA8DA70>]}
[0m13:30:44.337904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015558119590>]}
[0m13:30:44.338619 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:30:44.773849 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:30:44.888597 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:30:44.889055 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:30:44.916321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000155585B4F50>]}
[0m13:30:44.976561 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:30:44.978960 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:30:45.002428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015558103980>]}
[0m13:30:45.002852 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:30:45.003221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000155581C3CB0>]}
[0m13:30:45.004477 [info ] [MainThread]: 
[0m13:30:45.004908 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:30:45.005205 [info ] [MainThread]: 
[0m13:30:45.005647 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:30:45.006536 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:30:45.006890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:30:45.377978 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:30:45.378385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:30:45.624836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001555879CBB0>]}
[0m13:30:45.625264 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:30:45.631203 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:30:45.631739 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:30:45.632422 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:30:45.632695 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:30:45.640003 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:30:45.641099 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:30:45.665995 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:30:45.667086 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH sales_orders AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customers_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m13:30:45.667586 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:30:46.042333 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:d681259d-a993-4071-8e1e-d06c1ec2d0d1&page=queryresults
[0m13:30:46.120966 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:d681259d-a993-4071-8e1e-d06c1ec2d0d1&page=queryresults
[0m13:30:46.219520 [debug] [Thread-1 (]: Database Error in model exercise5 (models\marts\exercise5.sql)
  Unrecognized name: s at [17:29]
  compiled code at target\run\astrafy_project\models\marts\exercise5.sql
[0m13:30:46.221717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58115d0e-7f51-4c7c-a064-eb8539b776d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015558739850>]}
[0m13:30:46.222275 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model marts.exercise5 ........................... [[31mERROR[0m in 0.59s]
[0m13:30:46.222953 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:30:46.223486 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.exercise5' to be skipped because of status 'error'.  Reason: Database Error in model exercise5 (models\marts\exercise5.sql)
  Unrecognized name: s at [17:29]
  compiled code at target\run\astrafy_project\models\marts\exercise5.sql.
[0m13:30:46.225588 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:30:46.227017 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:30:46.227283 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:30:46.227480 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:30:46.227654 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:30:46.227872 [info ] [MainThread]: 
[0m13:30:46.228420 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.22 seconds (1.22s).
[0m13:30:46.229279 [debug] [MainThread]: Command end result
[0m13:30:46.245791 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:30:46.248099 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:30:46.254018 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:30:46.254363 [info ] [MainThread]: 
[0m13:30:46.254943 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:30:46.255397 [info ] [MainThread]: 
[0m13:30:46.256086 [error] [MainThread]: [31mFailure in model exercise5 (models\marts\exercise5.sql)[0m
[0m13:30:46.256548 [error] [MainThread]:   Database Error in model exercise5 (models\marts\exercise5.sql)
  Unrecognized name: s at [17:29]
  compiled code at target\run\astrafy_project\models\marts\exercise5.sql
[0m13:30:46.256896 [info ] [MainThread]: 
[0m13:30:46.257258 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\marts\exercise5.sql
[0m13:30:46.257576 [info ] [MainThread]: 
[0m13:30:46.257963 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m13:30:46.258915 [debug] [MainThread]: Command `dbt run` failed at 13:30:46.258792 after 4.79 seconds
[0m13:30:46.259257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015558796150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015558779590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000155587796D0>]}
[0m13:30:46.259579 [debug] [MainThread]: Flushing usage events
[0m13:30:46.740915 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:31:02.390374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0CEEB2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0CCD4C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0D100FED0>]}


============================== 13:31:02.395112 | a3188b73-8c1f-4d57-9114-92cb2a177176 ==============================
[0m13:31:02.395112 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:31:02.395816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise5', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:31:04.990254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0CF39DA70>]}
[0m13:31:05.041582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FCA19590>]}
[0m13:31:05.042258 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:31:05.510525 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:31:05.627189 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:31:05.627550 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:31:05.653835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FCEB4F50>]}
[0m13:31:05.710689 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:31:05.712998 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:31:05.738423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FCA03980>]}
[0m13:31:05.738885 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:31:05.739265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FCAC3CB0>]}
[0m13:31:05.740520 [info ] [MainThread]: 
[0m13:31:05.740873 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:31:05.741161 [info ] [MainThread]: 
[0m13:31:05.741602 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:31:05.742495 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:31:05.742844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:31:06.112011 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:31:06.112401 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:31:06.327496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FD09C7A0>]}
[0m13:31:06.327891 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:31:06.332816 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:31:06.333218 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:31:06.334019 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:31:06.334301 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:31:06.341282 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:31:06.342186 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:31:06.366978 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:31:06.368052 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH sales_orders AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNTIF(date_date < s.date_date AND date_date >= DATE_SUB(s.date_date, INTERVAL 12 MONTH)) 
            OVER (PARTITION BY customers_id ORDER BY date_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS previous_12m_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement` AS s
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_12m_orders = 0 THEN 'New'
        WHEN previous_12m_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_12m_orders >= 4 THEN 'VIP'
        ELSE 'unknown'
    END AS order_segment
FROM sales_orders;


[0m13:31:06.368438 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:31:06.712181 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6c3687c2-5e4b-449d-a58d-0b010af5f634&page=queryresults
[0m13:31:07.022462 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3188b73-8c1f-4d57-9114-92cb2a177176', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FD03B110>]}
[0m13:31:07.023056 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.69s]
[0m13:31:07.024101 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:31:07.025587 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:31:07.027030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:31:07.027327 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:31:07.027516 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:31:07.027711 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:31:07.027920 [info ] [MainThread]: 
[0m13:31:07.028472 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.29 seconds (1.29s).
[0m13:31:07.029525 [debug] [MainThread]: Command end result
[0m13:31:07.046518 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:31:07.049107 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:31:07.054414 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:31:07.054703 [info ] [MainThread]: 
[0m13:31:07.055226 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:31:07.055598 [info ] [MainThread]: 
[0m13:31:07.056092 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:31:07.057101 [debug] [MainThread]: Command `dbt run` succeeded at 13:31:07.056985 after 4.77 seconds
[0m13:31:07.057424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FD0968E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FD077890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B0FD0756D0>]}
[0m13:31:07.057751 [debug] [MainThread]: Flushing usage events
[0m13:31:07.490838 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:34:33.118727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196FD072510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196FAECC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196FE1FFED0>]}


============================== 13:34:33.123014 | b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef ==============================
[0m13:34:33.123014 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:34:33.123626 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise5', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:34:35.900155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196FD559A70>]}
[0m13:34:35.952327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AAD59590>]}
[0m13:34:35.953099 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:34:36.456089 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:34:36.584820 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:34:36.585193 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:34:36.612570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB1F4F50>]}
[0m13:34:36.672304 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:34:36.674655 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:34:36.702713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AAD43980>]}
[0m13:34:36.703168 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:34:36.703624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AAE03CB0>]}
[0m13:34:36.704878 [info ] [MainThread]: 
[0m13:34:36.705276 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:34:36.705644 [info ] [MainThread]: 
[0m13:34:36.706254 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:34:36.707434 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:34:36.707823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:37.095624 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:34:37.095985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:34:37.310661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB3DC940>]}
[0m13:34:37.311128 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:34:37.316017 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:34:37.316495 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:34:37.317209 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:34:37.317545 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:34:37.324829 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:34:37.325783 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:34:37.351248 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:34:37.352589 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH sales_orders AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown'
    END AS order_segment
FROM sales_orders;


[0m13:34:37.353121 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:34:37.734935 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:eb1aacdf-d422-4e20-bf75-e2950df4b573&page=queryresults
[0m13:34:38.112736 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b33fdcf4-0672-40f5-82cd-c5fe91ecc9ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB377110>]}
[0m13:34:38.113777 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.79s]
[0m13:34:38.114526 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:34:38.115989 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:34:38.117593 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:34:38.117858 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:34:38.118109 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:34:38.118313 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:34:38.118522 [info ] [MainThread]: 
[0m13:34:38.118926 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.41 seconds (1.41s).
[0m13:34:38.119854 [debug] [MainThread]: Command end result
[0m13:34:38.136801 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:34:38.139349 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:34:38.144494 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:34:38.144888 [info ] [MainThread]: 
[0m13:34:38.145390 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:34:38.145826 [info ] [MainThread]: 
[0m13:34:38.146296 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:34:38.147230 [debug] [MainThread]: Command `dbt run` succeeded at 13:34:38.147112 after 5.17 seconds
[0m13:34:38.147541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB3D68E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB3BB610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000196AB3B9630>]}
[0m13:34:38.147839 [debug] [MainThread]: Flushing usage events
[0m13:34:38.560895 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:38:24.539498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E894032510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E891E9C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E89618FED0>]}


============================== 13:38:24.543419 | d157a5ab-c216-4444-81ad-ec5aa0303d4a ==============================
[0m13:38:24.543419 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:38:24.543979 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select exercise5', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:38:27.231726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E894519A70>]}
[0m13:38:27.282546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C1BA9590>]}
[0m13:38:27.283218 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:38:27.758545 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:38:27.884746 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:38:27.885127 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:38:27.914501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C2044F50>]}
[0m13:38:27.977024 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:38:27.979706 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:38:28.005971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C1B93980>]}
[0m13:38:28.006416 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:38:28.006869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C1C53CB0>]}
[0m13:38:28.008603 [info ] [MainThread]: 
[0m13:38:28.008957 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:38:28.009265 [info ] [MainThread]: 
[0m13:38:28.009801 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:38:28.010790 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:38:28.011144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:28.420807 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:38:28.421298 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:28.660259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C222C460>]}
[0m13:38:28.660662 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:38:28.665562 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:38:28.666027 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:38:28.666616 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:38:28.666936 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:38:28.674452 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:38:28.675358 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:38:28.700896 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:38:28.701994 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH orders_2023 AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_type
FROM orders_2023;


[0m13:38:28.702408 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:38:29.134059 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:f98ead4f-ccc6-4440-a8a9-b07ad54a8ef7&page=queryresults
[0m13:38:29.450321 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd157a5ab-c216-4444-81ad-ec5aa0303d4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C21C7110>]}
[0m13:38:29.450994 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.78s]
[0m13:38:29.451681 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:38:29.453040 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:38:29.454371 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:38:29.454626 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:38:29.454841 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:38:29.455051 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:38:29.455281 [info ] [MainThread]: 
[0m13:38:29.455688 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.45 seconds (1.45s).
[0m13:38:29.456576 [debug] [MainThread]: Command end result
[0m13:38:29.473263 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:38:29.475745 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:38:29.480712 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:38:29.481093 [info ] [MainThread]: 
[0m13:38:29.481578 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:38:29.481998 [info ] [MainThread]: 
[0m13:38:29.482363 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:38:29.483237 [debug] [MainThread]: Command `dbt run` succeeded at 13:38:29.483129 after 5.07 seconds
[0m13:38:29.483538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C22268E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C2203750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002E8C22016D0>]}
[0m13:38:29.483839 [debug] [MainThread]: Flushing usage events
[0m13:38:29.892840 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:39:43.379079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3ED8C2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3EB73C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3EFA23ED0>]}


============================== 13:39:43.383909 | 89779c61-c15c-4305-ab60-4d731e9f7dd0 ==============================
[0m13:39:43.383909 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:39:43.384509 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select exercise5', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:39:46.007043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A3EDDA9A70>]}
[0m13:39:46.056615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39B4A9590>]}
[0m13:39:46.057263 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:39:46.518701 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:39:46.642406 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:39:46.642881 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:39:46.671874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39B944F50>]}
[0m13:39:46.735418 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:39:46.737809 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:39:46.763020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39B493980>]}
[0m13:39:46.763445 [info ] [MainThread]: Found 7 models, 2 sources, 493 macros
[0m13:39:46.763903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39B553CB0>]}
[0m13:39:46.765622 [info ] [MainThread]: 
[0m13:39:46.766026 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:39:46.766324 [info ] [MainThread]: 
[0m13:39:46.766769 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:39:46.767700 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:39:46.768022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:39:47.164889 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:39:47.165234 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:39:47.426875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39BB2C390>]}
[0m13:39:47.427285 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:39:47.432193 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:39:47.432669 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise5 .................................... [RUN]
[0m13:39:47.433395 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise5'
[0m13:39:47.433676 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:39:47.440948 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:39:47.441846 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:39:47.466239 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:39:47.467728 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */


  create or replace view `astrafy-464919`.`marts`.`exercise5`
  OPTIONS()
  as --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

WITH orders_2023 AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders_2023;


[0m13:39:47.468227 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:39:47.867987 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:3cc26984-9ff6-4186-ae5b-439a7f05e414&page=queryresults
[0m13:39:48.184628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89779c61-c15c-4305-ab60-4d731e9f7dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39BAC7110>]}
[0m13:39:48.185217 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise5 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.75s]
[0m13:39:48.185934 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:39:48.187296 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:39:48.188915 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:39:48.189453 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:39:48.189694 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:39:48.189887 [debug] [MainThread]: Connection 'model.astrafy_project.exercise5' was properly closed.
[0m13:39:48.190126 [info ] [MainThread]: 
[0m13:39:48.190454 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.42 seconds (1.42s).
[0m13:39:48.191037 [debug] [MainThread]: Command end result
[0m13:39:48.207909 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:39:48.210922 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:39:48.220011 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:39:48.220585 [info ] [MainThread]: 
[0m13:39:48.221194 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:39:48.221640 [info ] [MainThread]: 
[0m13:39:48.222076 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m13:39:48.223030 [debug] [MainThread]: Command `dbt run` succeeded at 13:39:48.222923 after 4.95 seconds
[0m13:39:48.223340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39BB268E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39BB0B750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A39BB096D0>]}
[0m13:39:48.223658 [debug] [MainThread]: Flushing usage events
[0m13:39:48.657589 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:44:21.007350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E707432510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E70529C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E709593ED0>]}


============================== 13:44:21.011370 | 615de6ac-f791-43ae-9199-cdae648d1c71 ==============================
[0m13:44:21.011370 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:44:21.011957 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:44:23.601136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E70791DA70>]}
[0m13:44:23.651141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735019590>]}
[0m13:44:23.651806 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:44:24.125087 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:44:24.244897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:44:24.245257 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:44:24.274013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7354B4F50>]}
[0m13:44:24.335105 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:44:24.337346 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:44:24.365752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735003980>]}
[0m13:44:24.366195 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m13:44:24.366586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7350C3CB0>]}
[0m13:44:24.368073 [info ] [MainThread]: 
[0m13:44:24.368596 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:44:24.369314 [info ] [MainThread]: 
[0m13:44:24.369852 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:44:24.373441 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m13:44:24.373784 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:44:24.758962 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m13:44:24.759611 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:44:24.989994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E73569C600>]}
[0m13:44:24.990409 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:44:24.995283 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m13:44:24.995771 [info ] [Thread-1 (]: 1 of 6 START sql view model marts.exercise4 .................................... [RUN]
[0m13:44:24.996382 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m13:44:24.996674 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m13:44:25.004133 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m13:44:25.005168 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m13:44:25.030425 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m13:44:25.031456 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */


  create or replace view `astrafy-464919`.`marts`.`exercise4`
  OPTIONS()
  as --Create a table (1 line per order) for all orders in the year 2022 and 2023 with a qty_product column that gives the total quantity of products in the order
SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  ROUND(SUM(net_sales),2) AS net_sales,
  SUM(qty) AS qty_product
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`

WHERE 
  EXTRACT(YEAR FROM CAST(date_date AS DATE)) IN (2022, 2023)

GROUP BY order_id
ORDER BY order_date;


[0m13:44:25.031901 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:44:25.438352 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:750a0ea9-1283-4b3b-bbcd-d6c87b8a6db4&page=queryresults
[0m13:44:25.763781 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E7356371D0>]}
[0m13:44:25.764435 [info ] [Thread-1 (]: 1 of 6 OK created sql view model marts.exercise4 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.77s]
[0m13:44:25.765235 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m13:44:25.765579 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m13:44:25.766321 [info ] [Thread-1 (]: 2 of 6 START sql table model marts.exercise5 ................................... [RUN]
[0m13:44:25.767521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m13:44:25.768153 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m13:44:25.771008 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m13:44:25.771840 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m13:44:25.781593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:44:26.066137 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m13:44:26.067196 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`exercise5`
      
    
    

    OPTIONS()
    as (
      --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023


WITH orders_2023 AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders_2023
    );
  
[0m13:44:26.317081 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:27bbca37-6a30-4647-b547-52a7b379119a&page=queryresults
[0m13:44:27.945505 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E73568EA40>]}
[0m13:44:27.946105 [info ] [Thread-1 (]: 2 of 6 OK created sql table model marts.exercise5 .............................. [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 2.18s]
[0m13:44:27.946729 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m13:44:27.947009 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m13:44:27.947317 [info ] [Thread-1 (]: 3 of 6 START sql table model marts.sales_2023 .................................. [RUN]
[0m13:44:27.947760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.sales_2023)
[0m13:44:27.948023 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m13:44:27.950353 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m13:44:27.951119 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m13:44:27.953060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:44:28.173501 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m13:44:28.174711 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`sales_2023`
      
    
    

    OPTIONS()
    as (
      --Since most of our requests require 2023 year filter, I decided to create a dedicated table to avoid repetitive filtering in each query.

SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023
    );
  
[0m13:44:28.388119 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:dce18e90-7ff5-4f4d-9623-44869343bcb6&page=queryresults
[0m13:44:29.911490 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735D0ACB0>]}
[0m13:44:29.912062 [info ] [Thread-1 (]: 3 of 6 OK created sql table model marts.sales_2023 ............................. [[32mCREATE TABLE (19.6k rows, 1.3 MiB processed)[0m in 1.96s]
[0m13:44:29.912828 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m13:44:29.913604 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m13:44:29.914231 [info ] [Thread-1 (]: 4 of 6 START sql view model marts.exercise1 .................................... [RUN]
[0m13:44:29.914824 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.sales_2023, now model.astrafy_project.exercise1)
[0m13:44:29.915143 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m13:44:29.917097 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m13:44:29.917836 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m13:44:29.920035 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m13:44:29.920743 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as --Number of orders in the year 2023
SELECT
  COUNT(DISTINCT order_id) AS order_count_2023
FROM 
    `astrafy-464919`.`marts`.`sales_2023`;


[0m13:44:29.921083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:44:30.765533 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:a3355485-9f80-4bc2-ae92-8af1da468934&page=queryresults
[0m13:44:30.960219 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735C01250>]}
[0m13:44:30.960800 [info ] [Thread-1 (]: 4 of 6 OK created sql view model marts.exercise1 ............................... [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m13:44:30.961505 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m13:44:30.961791 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m13:44:30.962425 [info ] [Thread-1 (]: 5 of 6 START sql view model marts.exercise2 .................................... [RUN]
[0m13:44:30.963307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m13:44:30.963670 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m13:44:30.965714 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m13:44:30.966506 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m13:44:30.969237 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m13:44:30.970254 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`marts`.`exercise2`
  OPTIONS()
  as --Number of orders per month in the year 2023
SELECT
  EXTRACT(MONTH FROM date_date) AS month,
  COUNT(DISTINCT order_id) AS orders_count

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY MONTH
ORDER BY MONTH;


[0m13:44:30.970647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:44:31.340053 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:5f7d7574-ea77-4fab-9bcb-70609dc5708a&page=queryresults
[0m13:44:31.487007 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E73562E890>]}
[0m13:44:31.487593 [info ] [Thread-1 (]: 5 of 6 OK created sql view model marts.exercise2 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.52s]
[0m13:44:31.488210 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m13:44:31.488527 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m13:44:31.488877 [info ] [Thread-1 (]: 6 of 6 START sql view model marts.exercise3 .................................... [RUN]
[0m13:44:31.489350 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m13:44:31.489658 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m13:44:31.491600 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m13:44:31.492577 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m13:44:31.494304 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m13:44:31.495030 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023?
SELECT
  -- Format the month and year for better readability. Included Cast to ensure date as a base type for the truncation.
  format_date('%B - %Y', date_trunc(CAST(date_date AS DATE), MONTH)) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY month_year, date_trunc(CAST(date_date AS DATE), MONTH)
ORDER BY DATE_TRUNC(CAST(date_date AS DATE), MONTH);


[0m13:44:31.495490 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:44:31.811128 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:df62b38e-66a2-4af7-984c-3d3f476bd739&page=queryresults
[0m13:44:31.984010 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615de6ac-f791-43ae-9199-cdae648d1c71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735DA5EB0>]}
[0m13:44:31.984593 [info ] [Thread-1 (]: 6 of 6 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.49s]
[0m13:44:31.985511 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m13:44:31.987245 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:44:31.988668 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:44:31.988891 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m13:44:31.989082 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m13:44:31.989272 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m13:44:31.989558 [info ] [MainThread]: 
[0m13:44:31.990091 [info ] [MainThread]: Finished running 2 table models, 4 view models in 0 hours 0 minutes and 7.62 seconds (7.62s).
[0m13:44:31.991819 [debug] [MainThread]: Command end result
[0m13:44:32.012689 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m13:44:32.014838 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m13:44:32.020389 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m13:44:32.020683 [info ] [MainThread]: 
[0m13:44:32.021211 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:44:32.021688 [info ] [MainThread]: 
[0m13:44:32.022175 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m13:44:32.023232 [debug] [MainThread]: Command `dbt run` succeeded at 13:44:32.023135 after 11.14 seconds
[0m13:44:32.023519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735DA59D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735DA7C50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E735DA7B30>]}
[0m13:44:32.023788 [debug] [MainThread]: Flushing usage events
[0m13:44:32.493333 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:02:04.084281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B71212510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B6F07C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B73373ED0>]}


============================== 14:02:04.088533 | cfd6f028-95d9-45d3-9b9b-3adf15a25a83 ==============================
[0m14:02:04.088533 [info ] [MainThread]: Running with dbt=1.10.3
[0m14:02:04.089263 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select exercise3', 'send_anonymous_usage_stats': 'True'}
[0m14:02:06.847797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B716FDA70>]}
[0m14:02:06.901015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1EFF9590>]}
[0m14:02:06.901765 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m14:02:07.363157 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m14:02:07.492360 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:02:07.492712 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:02:07.523055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1F495050>]}
[0m14:02:07.582947 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:02:07.585220 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:02:07.611585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1EFE3980>]}
[0m14:02:07.612069 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m14:02:07.612582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1F0A2510>]}
[0m14:02:07.613839 [info ] [MainThread]: 
[0m14:02:07.614302 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:02:07.614743 [info ] [MainThread]: 
[0m14:02:07.615232 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:02:07.616154 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m14:02:07.616438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:08.008587 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m14:02:08.008959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:08.244289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1F656000>]}
[0m14:02:08.244712 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:02:08.250241 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m14:02:08.250973 [info ] [Thread-1 (]: 1 of 1 START sql view model marts.exercise3 .................................... [RUN]
[0m14:02:08.251592 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise3'
[0m14:02:08.251884 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m14:02:08.258652 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m14:02:08.259610 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m14:02:08.284910 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m14:02:08.286221 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023
WITH base AS (
  SELECT
    DATE_TRUNC(date_date, MONTH) AS month_start, --selects the first day of the month for each date
    order_id
  FROM `astrafy-464919`.`marts`.`sales_2023`
)

SELECT
  FORMAT_DATE('%B - %Y', month_start) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM base
GROUP BY month_start
ORDER BY month_start;


[0m14:02:08.286636 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:02:08.679053 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:5f384017-86f3-4579-a1e6-0bf65794f545&page=queryresults
[0m14:02:08.970719 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfd6f028-95d9-45d3-9b9b-3adf15a25a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1F64F350>]}
[0m14:02:08.971331 [info ] [Thread-1 (]: 1 of 1 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.72s]
[0m14:02:08.972300 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m14:02:08.973631 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:02:08.975342 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:02:08.975599 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m14:02:08.975834 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m14:02:08.976026 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m14:02:08.976244 [info ] [MainThread]: 
[0m14:02:08.976680 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.36 seconds (1.36s).
[0m14:02:08.977472 [debug] [MainThread]: Command end result
[0m14:02:08.994185 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:02:08.996482 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:02:09.002518 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m14:02:09.002836 [info ] [MainThread]: 
[0m14:02:09.003410 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:02:09.003884 [info ] [MainThread]: 
[0m14:02:09.004342 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m14:02:09.005244 [debug] [MainThread]: Command `dbt run` succeeded at 14:02:09.005136 after 5.03 seconds
[0m14:02:09.005572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1F6CAE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1FD0EC10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024B1FD0EE90>]}
[0m14:02:09.006029 [debug] [MainThread]: Flushing usage events
[0m14:02:09.426278 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:09:38.471112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB6E62510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB4CCC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB8FBFED0>]}


============================== 14:09:38.475611 | 4e3a8aed-3e87-4572-a629-5f0283132153 ==============================
[0m14:09:38.475611 [info ] [MainThread]: Running with dbt=1.10.3
[0m14:09:38.476175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:09:40.991629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADB7349A70>]}
[0m14:09:41.041516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE49D9590>]}
[0m14:09:41.042110 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m14:09:41.480935 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m14:09:41.598666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:09:41.599092 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:09:41.626138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE4E71650>]}
[0m14:09:41.683735 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:09:41.685922 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:09:41.710518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE49C3980>]}
[0m14:09:41.710952 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m14:09:41.711478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE4B2DC50>]}
[0m14:09:41.713243 [info ] [MainThread]: 
[0m14:09:41.713605 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:09:41.713914 [info ] [MainThread]: 
[0m14:09:41.714334 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:09:41.717705 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m14:09:41.718025 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:09:42.117584 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m14:09:42.117921 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:09:42.340823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE505A4E0>]}
[0m14:09:42.341235 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:09:42.346440 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m14:09:42.346836 [info ] [Thread-1 (]: 1 of 6 START sql table model marts.exercise4 ................................... [RUN]
[0m14:09:42.347503 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m14:09:42.347764 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m14:09:42.354610 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m14:09:42.355350 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m14:09:42.366437 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:09:42.776992 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise4"
[0m14:09:42.778056 [debug] [Thread-1 (]: On model.astrafy_project.exercise4: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise4"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`exercise4`
      
    
    

    OPTIONS()
    as (
      --Create a table (1 line per order) for all orders in the year 2022 and 2023 with a qty_product column that gives the total quantity of products in the order


SELECT
  MIN(CAST(date_date AS DATE)) AS order_date,
  MIN(customer_id) AS customer_id,
  order_id,
  ROUND(SUM(net_sales),2) AS net_sales,
  SUM(qty) AS qty_product
FROM 
  `astrafy-464919`.`raw`.`sales_recrutement`

WHERE 
  EXTRACT(YEAR FROM CAST(date_date AS DATE)) IN (2022, 2023)

GROUP BY order_id
ORDER BY order_date
    );
  
[0m14:09:43.074590 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:01aa9118-641e-4ac0-87a1-42813cd3ffdd&page=queryresults
[0m14:09:44.510351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE5037890>]}
[0m14:09:44.510914 [info ] [Thread-1 (]: 1 of 6 OK created sql table model marts.exercise4 .............................. [[32mCREATE TABLE (3.7k rows, 1.1 MiB processed)[0m in 2.16s]
[0m14:09:44.511754 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m14:09:44.512055 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m14:09:44.512387 [info ] [Thread-1 (]: 2 of 6 START sql table model marts.exercise5 ................................... [RUN]
[0m14:09:44.512982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m14:09:44.513315 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m14:09:44.515441 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m14:09:44.516168 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m14:09:44.518018 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:44.731926 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise5"
[0m14:09:44.732988 [debug] [Thread-1 (]: On model.astrafy_project.exercise5: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise5"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`exercise5`
      
    
    

    OPTIONS()
    as (
      --New: it's the 1st order of the customer (client_id) in the past 12 months.
--Returning: it's between the 2nd and the 4th order of the customer in the past 12 months
--VIP: it's the 5th order or more of the customer in the past 12 months
--Calculate it for each order in the year 2023

--Excercise 6 is basically the same as excercise 5, I materialized it as a table because it explicitly asks for a table with the segmentation of orders.


WITH orders_2023 AS (
    SELECT
        customers_id,
        orders_id,
        date_date,

        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    orders_id,
    customers_id,
    date_date,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders_2023
    );
  
[0m14:09:44.979646 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:6e76a43d-dd29-457f-81b7-86b29cca31d7&page=queryresults
[0m14:09:46.566846 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE50A6E60>]}
[0m14:09:46.567430 [info ] [Thread-1 (]: 2 of 6 OK created sql table model marts.exercise5 .............................. [[32mCREATE TABLE (2.6k rows, 85.8 KiB processed)[0m in 2.05s]
[0m14:09:46.568125 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m14:09:46.568421 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m14:09:46.568883 [info ] [Thread-1 (]: 3 of 6 START sql table model marts.sales_2023 .................................. [RUN]
[0m14:09:46.569440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.sales_2023)
[0m14:09:46.569729 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m14:09:46.572017 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m14:09:46.572998 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m14:09:46.574893 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:46.795886 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.sales_2023"
[0m14:09:46.797169 [debug] [Thread-1 (]: On model.astrafy_project.sales_2023: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.sales_2023"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`sales_2023`
      
    
    

    OPTIONS()
    as (
      --Since most of our requests require 2023 year filter, I decided to create a dedicated table to avoid repetitive filtering in each query.

SELECT 
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty
FROM 
    `astrafy-464919`.`raw`.`sales_recrutement`
where 
    EXTRACT(YEAR FROM date_date) = 2023
    );
  
[0m14:09:46.995178 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:f9313251-9289-4292-9cb9-57e767f0d1e1&page=queryresults
[0m14:09:48.352278 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE50ABED0>]}
[0m14:09:48.352872 [info ] [Thread-1 (]: 3 of 6 OK created sql table model marts.sales_2023 ............................. [[32mCREATE TABLE (19.6k rows, 1.3 MiB processed)[0m in 1.78s]
[0m14:09:48.353677 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m14:09:48.354370 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m14:09:48.354731 [info ] [Thread-1 (]: 4 of 6 START sql view model marts.exercise1 .................................... [RUN]
[0m14:09:48.355294 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.sales_2023, now model.astrafy_project.exercise1)
[0m14:09:48.355651 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m14:09:48.357678 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m14:09:48.358437 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m14:09:48.377389 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise1"
[0m14:09:48.378689 [debug] [Thread-1 (]: On model.astrafy_project.exercise1: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise1"} */


  create or replace view `astrafy-464919`.`marts`.`exercise1`
  OPTIONS()
  as --Number of orders in the year 2023
SELECT
  COUNT(DISTINCT order_id) AS order_count_2023
FROM 
    `astrafy-464919`.`marts`.`sales_2023`;


[0m14:09:48.379170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:48.777239 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:05790026-45a2-4f5f-8c1a-4ed72bae158d&page=queryresults
[0m14:09:48.942401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE56EADD0>]}
[0m14:09:48.943452 [info ] [Thread-1 (]: 4 of 6 OK created sql view model marts.exercise1 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.59s]
[0m14:09:48.944390 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m14:09:48.944841 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m14:09:48.945382 [info ] [Thread-1 (]: 5 of 6 START sql view model marts.exercise2 .................................... [RUN]
[0m14:09:48.946060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m14:09:48.946411 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m14:09:48.950796 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m14:09:48.952103 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m14:09:48.955828 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise2"
[0m14:09:48.957108 [debug] [Thread-1 (]: On model.astrafy_project.exercise2: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise2"} */


  create or replace view `astrafy-464919`.`marts`.`exercise2`
  OPTIONS()
  as --Number of orders per month in the year 2023
SELECT
  EXTRACT(MONTH FROM date_date) AS month,
  COUNT(DISTINCT order_id) AS orders_count

FROM 
  `astrafy-464919`.`marts`.`sales_2023`

GROUP BY MONTH
ORDER BY MONTH;


[0m14:09:48.957511 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:49.288562 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:f7ffcc99-3fcf-4dab-8b65-bc779fa8af29&page=queryresults
[0m14:09:49.484783 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE5006DD0>]}
[0m14:09:49.485388 [info ] [Thread-1 (]: 5 of 6 OK created sql view model marts.exercise2 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.54s]
[0m14:09:49.486103 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m14:09:49.486421 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m14:09:49.486777 [info ] [Thread-1 (]: 6 of 6 START sql view model marts.exercise3 .................................... [RUN]
[0m14:09:49.487256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m14:09:49.487582 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m14:09:49.489996 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m14:09:49.490843 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m14:09:49.492698 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.exercise3"
[0m14:09:49.493435 [debug] [Thread-1 (]: On model.astrafy_project.exercise3: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.exercise3"} */


  create or replace view `astrafy-464919`.`marts`.`exercise3`
  OPTIONS()
  as --Average number of products per order for each month of the year 2023
WITH base AS (
  SELECT
    DATE_TRUNC(date_date, MONTH) AS month_start, --selects the first day of the month for each date
    order_id
  FROM `astrafy-464919`.`marts`.`sales_2023`
)

SELECT
  FORMAT_DATE('%B - %Y', month_start) AS month_year,
  COUNT(*) AS total_products,
  COUNT(DISTINCT order_id) AS total_orders,
  ROUND(COUNT(*) * 1.0 / COUNT(DISTINCT order_id), 2) AS avg_products_per_order
FROM base
GROUP BY month_start
ORDER BY month_start;


[0m14:09:49.493831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:49.848222 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:7f87860f-bb5b-4f1b-8eea-3aa4c3ce014e&page=queryresults
[0m14:09:50.045203 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e3a8aed-3e87-4572-a629-5f0283132153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE574F050>]}
[0m14:09:50.045916 [info ] [Thread-1 (]: 6 of 6 OK created sql view model marts.exercise3 ............................... [[32mCREATE VIEW (0 processed)[0m in 0.56s]
[0m14:09:50.046780 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m14:09:50.048329 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:09:50.049788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:09:50.050016 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m14:09:50.050209 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m14:09:50.050448 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m14:09:50.050791 [info ] [MainThread]: 
[0m14:09:50.051157 [info ] [MainThread]: Finished running 3 table models, 3 view models in 0 hours 0 minutes and 8.34 seconds (8.34s).
[0m14:09:50.052491 [debug] [MainThread]: Command end result
[0m14:09:50.073807 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:09:50.076580 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:09:50.082753 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m14:09:50.083105 [info ] [MainThread]: 
[0m14:09:50.083552 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:09:50.083876 [info ] [MainThread]: 
[0m14:09:50.084197 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m14:09:50.085018 [debug] [MainThread]: Command `dbt run` succeeded at 14:09:50.084923 after 11.72 seconds
[0m14:09:50.085319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE5081F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE49F60F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ADE574C8F0>]}
[0m14:09:50.085614 [debug] [MainThread]: Flushing usage events
[0m14:09:50.660358 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:10:46.677060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA1D962510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA1B7CC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA1FAA7ED0>]}


============================== 14:10:46.681198 | 154e9ec2-3a88-43fd-a49c-8959e0156814 ==============================
[0m14:10:46.681198 [info ] [MainThread]: Running with dbt=1.10.3
[0m14:10:46.681811 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt docs generate', 'send_anonymous_usage_stats': 'True'}
[0m14:10:49.319180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA1DE4DA70>]}
[0m14:10:49.368023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4B4C5590>]}
[0m14:10:49.368655 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m14:10:49.831889 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m14:10:49.965168 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:10:49.965577 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:10:49.998602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4B961750>]}
[0m14:10:50.023834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4B99B020>]}
[0m14:10:50.024319 [info ] [MainThread]: Found 6 models, 2 sources, 493 macros
[0m14:10:50.024730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4B94C210>]}
[0m14:10:50.026256 [info ] [MainThread]: 
[0m14:10:50.026661 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:10:50.026943 [info ] [MainThread]: 
[0m14:10:50.027635 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:10:50.031092 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m14:10:50.031432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:50.291074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '154e9ec2-3a88-43fd-a49c-8959e0156814', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4BB5C7A0>]}
[0m14:10:50.291470 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:10:50.297412 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise4
[0m14:10:50.297905 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.exercise4'
[0m14:10:50.298166 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise4
[0m14:10:50.307769 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise4"
[0m14:10:50.308617 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise4
[0m14:10:50.309056 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:10:50.310727 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise4
[0m14:10:50.311090 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise5
[0m14:10:50.311461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise4, now model.astrafy_project.exercise5)
[0m14:10:50.311743 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise5
[0m14:10:50.313900 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise5"
[0m14:10:50.314773 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise5
[0m14:10:50.315091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:10:50.316518 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise5
[0m14:10:50.316852 [debug] [Thread-1 (]: Began running node model.astrafy_project.sales_2023
[0m14:10:50.317239 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise5, now model.astrafy_project.sales_2023)
[0m14:10:50.317516 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.sales_2023
[0m14:10:50.319769 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.sales_2023"
[0m14:10:50.320386 [debug] [Thread-1 (]: Began executing node model.astrafy_project.sales_2023
[0m14:10:50.320677 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:10:50.322035 [debug] [Thread-1 (]: Finished running node model.astrafy_project.sales_2023
[0m14:10:50.322620 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise1
[0m14:10:50.322951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.sales_2023, now model.astrafy_project.exercise1)
[0m14:10:50.323357 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise1
[0m14:10:50.325029 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise1"
[0m14:10:50.325796 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise1
[0m14:10:50.326203 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:10:50.327751 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise1
[0m14:10:50.328079 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise2
[0m14:10:50.328595 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise1, now model.astrafy_project.exercise2)
[0m14:10:50.328897 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise2
[0m14:10:50.330707 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise2"
[0m14:10:50.331337 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise2
[0m14:10:50.331635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:10:50.332963 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise2
[0m14:10:50.333245 [debug] [Thread-1 (]: Began running node model.astrafy_project.exercise3
[0m14:10:50.333556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.astrafy_project.exercise2, now model.astrafy_project.exercise3)
[0m14:10:50.333806 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.exercise3
[0m14:10:50.335807 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.exercise3"
[0m14:10:50.336435 [debug] [Thread-1 (]: Began executing node model.astrafy_project.exercise3
[0m14:10:50.336742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:10:50.338069 [debug] [Thread-1 (]: Finished running node model.astrafy_project.exercise3
[0m14:10:50.339181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:10:50.339406 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m14:10:50.339607 [debug] [MainThread]: Connection 'model.astrafy_project.exercise3' was properly closed.
[0m14:10:50.340550 [debug] [MainThread]: Command end result
[0m14:10:50.395957 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:10:50.398378 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:10:50.404019 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m14:10:50.654846 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m14:10:50.655244 [info ] [MainThread]: Building catalog
[0m14:10:50.660059 [debug] [ThreadPool]: Acquiring new bigquery connection 'astrafy-464919.information_schema'
[0m14:10:50.676130 [debug] [ThreadPool]: On astrafy-464919.information_schema: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "astrafy-464919.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `astrafy-464919`.`marts`.__TABLES__ tables
    left join `astrafy-464919`.`marts`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `astrafy-464919`.`marts`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('exercise4')
                            ) or (
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('exercise5')
                            ) or (
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('exercise2')
                            ) or (
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('exercise3')
                            ) or (
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('sales_2023')
                            ) or (
                                upper(table_schema) = upper('marts')
                            and upper(table_name) = upper('exercise1')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `astrafy-464919`.`marts`.INFORMATION_SCHEMA.COLUMNS columns
    join `astrafy-464919`.`marts`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m14:10:50.676958 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:10:54.277776 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:dc401735-591e-4a61-9387-2eb87acbeb9f&page=queryresults
[0m14:10:55.168763 [debug] [ThreadPool]: On astrafy-464919.information_schema: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "connection_name": "astrafy-464919.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `astrafy-464919`.`raw`.__TABLES__ tables
    left join `astrafy-464919`.`raw`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `astrafy-464919`.`raw`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('orders_recrutement')
                            ) or (
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('sales_recrutement')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `astrafy-464919`.`raw`.INFORMATION_SCHEMA.COLUMNS columns
    join `astrafy-464919`.`raw`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m14:10:55.169316 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:10:55.522137 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:207ec6c9-be39-4661-9a2e-6270f9a19660&page=queryresults
[0m14:10:56.346161 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:10:56.357767 [debug] [MainThread]: Wrote artifact CatalogArtifact to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\catalog.json
[0m14:10:56.376128 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m14:10:56.378530 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m14:10:56.378883 [info ] [MainThread]: Catalog written to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\catalog.json
[0m14:10:56.379907 [debug] [MainThread]: Command `dbt docs generate` succeeded at 14:10:56.379792 after 9.82 seconds
[0m14:10:56.380171 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m14:10:56.380375 [debug] [MainThread]: Connection 'astrafy-464919.information_schema' was properly closed.
[0m14:10:56.380613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA1E9D8DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4BBB3EE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CA4BBB3E30>]}
[0m14:10:56.380885 [debug] [MainThread]: Flushing usage events
[0m14:10:56.879150 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:11:05.673445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024320092510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002431DF4C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000243221D3ED0>]}


============================== 14:11:05.677529 | 47e98ea7-818e-4db5-8816-dc3742c32fc3 ==============================
[0m14:11:05.677529 [info ] [MainThread]: Running with dbt=1.10.3
[0m14:11:05.678208 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:11:08.086409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47e98ea7-818e-4db5-8816-dc3742c32fc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002432057DA70>]}
[0m14:11:08.136751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47e98ea7-818e-4db5-8816-dc3742c32fc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002434CC31590>]}
[0m17:42:20.293115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCDA0E3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCB88CA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCE54C050>]}


============================== 17:42:20.296772 | acff6988-25b5-446e-9921-ced6df51fd36 ==============================
[0m17:42:20.296772 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:42:20.297315 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt ', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:42:20.421091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acff6988-25b5-446e-9921-ced6df51fd36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCDEE5940>]}
[0m17:42:20.440987 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:42:20.442257 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:42:20.443479 [debug] [MainThread]: Command `cli deps` succeeded at 17:42:20.443188 after 0.26 seconds
[0m17:42:20.443803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCE9FF130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCE9FFBD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021BCEA19F50>]}
[0m17:42:20.444120 [debug] [MainThread]: Flushing usage events
[0m17:42:20.847186 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:55:45.807675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023107D92510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023105BFC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023108F23ED0>]}


============================== 17:55:45.811554 | 5a740281-ded1-4c25-adec-eed4ccc9041f ==============================
[0m17:55:45.811554 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:55:45.812102 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select looker_orders', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:55:48.328323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002310827DA70>]}
[0m17:55:48.391576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231358F97B0>]}
[0m17:55:48.392332 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:55:48.916455 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:55:49.053356 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:55:49.053726 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:55:49.086660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135D8D650>]}
[0m17:55:49.151130 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:55:49.153418 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:55:49.173703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231358E3980>]}
[0m17:55:49.174192 [info ] [MainThread]: Found 8 models, 2 sources, 493 macros
[0m17:55:49.174770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135A4D010>]}
[0m17:55:49.176800 [info ] [MainThread]: 
[0m17:55:49.177269 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:55:49.177682 [info ] [MainThread]: 
[0m17:55:49.178167 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:55:49.179300 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m17:55:49.179662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:55:49.601276 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m17:55:49.601890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:55:49.834234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135F58A10>]}
[0m17:55:49.834664 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:55:49.839815 [debug] [Thread-1 (]: Began running node model.astrafy_project.looker_orders
[0m17:55:49.840383 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.looker_orders ............................... [RUN]
[0m17:55:49.840940 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.looker_orders'
[0m17:55:49.841224 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.looker_orders
[0m17:55:49.848853 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.looker_orders"
[0m17:55:49.850102 [debug] [Thread-1 (]: Began executing node model.astrafy_project.looker_orders
[0m17:55:49.884163 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.looker_orders"
[0m17:55:49.885589 [debug] [Thread-1 (]: On model.astrafy_project.looker_orders: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.looker_orders"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`looker_orders`
      
    
    

    OPTIONS()
    as (
      -- The tables in the folder "lookertables" are used to create Looker views that consolidate the results of the SQL queries in the "marts" folder.
-- Orders referes to the table "orders_recrutment" in the assignment, with the addition of the segmentation column.



WITH orders AS (
    SELECT
        date_date
        customers_id,
        orders_id,
        net_sales,
        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    date_date
    customers_id,
    orders_id,
    net_sales,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders
    );
  
[0m17:55:49.886094 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m17:55:50.388352 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:616264c8-99c4-421d-9c05-c83c62fe0bcb&page=queryresults
[0m17:55:50.520506 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:616264c8-99c4-421d-9c05-c83c62fe0bcb&page=queryresults
[0m17:55:50.527495 [debug] [Thread-1 (]: Database Error in model looker_orders (models\lookertables\looker_orders.sql)
  Unrecognized name: date_date at [35:5]
  compiled code at target\run\astrafy_project\models\lookertables\looker_orders.sql
[0m17:55:50.529898 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a740281-ded1-4c25-adec-eed4ccc9041f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135F259D0>]}
[0m17:55:50.530668 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model marts.looker_orders ...................... [[31mERROR[0m in 0.69s]
[0m17:55:50.531348 [debug] [Thread-1 (]: Finished running node model.astrafy_project.looker_orders
[0m17:55:50.531867 [debug] [Thread-4 (]: Marking all children of 'model.astrafy_project.looker_orders' to be skipped because of status 'error'.  Reason: Database Error in model looker_orders (models\lookertables\looker_orders.sql)
  Unrecognized name: date_date at [35:5]
  compiled code at target\run\astrafy_project\models\lookertables\looker_orders.sql.
[0m17:55:50.533588 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:55:50.535000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:55:50.535365 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m17:55:50.535691 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m17:55:50.536138 [debug] [MainThread]: Connection 'model.astrafy_project.looker_orders' was properly closed.
[0m17:55:50.536394 [info ] [MainThread]: 
[0m17:55:50.536751 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.36 seconds (1.36s).
[0m17:55:50.537482 [debug] [MainThread]: Command end result
[0m17:55:50.555002 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:55:50.557469 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:55:50.562776 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m17:55:50.563091 [info ] [MainThread]: 
[0m17:55:50.563556 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:55:50.563982 [info ] [MainThread]: 
[0m17:55:50.564385 [error] [MainThread]: [31mFailure in model looker_orders (models\lookertables\looker_orders.sql)[0m
[0m17:55:50.564764 [error] [MainThread]:   Database Error in model looker_orders (models\lookertables\looker_orders.sql)
  Unrecognized name: date_date at [35:5]
  compiled code at target\run\astrafy_project\models\lookertables\looker_orders.sql
[0m17:55:50.565044 [info ] [MainThread]: 
[0m17:55:50.565335 [info ] [MainThread]:   compiled code at target\compiled\astrafy_project\models\lookertables\looker_orders.sql
[0m17:55:50.565581 [info ] [MainThread]: 
[0m17:55:50.565905 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m17:55:50.567392 [debug] [MainThread]: Command `dbt run` failed at 17:55:50.567277 after 4.87 seconds
[0m17:55:50.567824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135F9AF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135FF96D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023135FF9A90>]}
[0m17:55:50.568160 [debug] [MainThread]: Flushing usage events
[0m17:55:51.006094 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:55:58.349099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D2F2FE3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D2D19CA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D2FE5C050>]}


============================== 17:55:58.352674 | e2505a1b-544a-4fb0-a245-2619d1e0bdec ==============================
[0m17:55:58.352674 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:55:58.353143 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt ', 'send_anonymous_usage_stats': 'True'}
[0m17:55:58.469141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2505a1b-544a-4fb0-a245-2619d1e0bdec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D2F7F9940>]}
[0m17:55:58.489081 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:55:58.490318 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m17:55:58.491349 [debug] [MainThread]: Command `cli deps` succeeded at 17:55:58.491218 after 0.24 seconds
[0m17:55:58.491644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D3030FAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D3030F8A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020D3032A050>]}
[0m17:55:58.491927 [debug] [MainThread]: Flushing usage events
[0m17:55:58.891746 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:56:42.782943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21CD52510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21ABAC910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21EEB3ED0>]}


============================== 17:56:42.786390 | 73116fb8-6451-4e83-9b5d-a427c9ed95e2 ==============================
[0m17:56:42.786390 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:56:42.787109 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select looker_orders', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:56:44.935454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B21D239A70>]}
[0m17:56:44.984862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24A8C97B0>]}
[0m17:56:44.985518 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:56:45.419358 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:56:45.535502 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:56:45.535835 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:56:45.563517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24AD5D650>]}
[0m17:56:45.623036 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:56:45.625152 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:56:45.643960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24A8B3980>]}
[0m17:56:45.644359 [info ] [MainThread]: Found 8 models, 2 sources, 493 macros
[0m17:56:45.644712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24AA1D010>]}
[0m17:56:45.645884 [info ] [MainThread]: 
[0m17:56:45.646349 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:56:45.646804 [info ] [MainThread]: 
[0m17:56:45.647407 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:56:45.648305 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m17:56:45.648577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:56:46.004904 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m17:56:46.005469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:56:46.238582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24AF28AE0>]}
[0m17:56:46.239029 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:56:46.244787 [debug] [Thread-1 (]: Began running node model.astrafy_project.looker_orders
[0m17:56:46.245206 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.looker_orders ............................... [RUN]
[0m17:56:46.245734 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.looker_orders'
[0m17:56:46.246003 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.looker_orders
[0m17:56:46.253354 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.looker_orders"
[0m17:56:46.254317 [debug] [Thread-1 (]: Began executing node model.astrafy_project.looker_orders
[0m17:56:46.285198 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.looker_orders"
[0m17:56:46.286148 [debug] [Thread-1 (]: On model.astrafy_project.looker_orders: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.looker_orders"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`looker_orders`
      
    
    

    OPTIONS()
    as (
      -- The tables in the folder "lookertables" are used to create Looker views that consolidate the results of the SQL queries in the "marts" folder.
-- Orders referes to the table "orders_recrutment" in the assignment, with the addition of the segmentation column.



WITH orders AS (
    SELECT
        date_date,
        customers_id,
        orders_id,
        net_sales,
        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT
    date_date,
    customers_id,
    orders_id,
    net_sales,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders
    );
  
[0m17:56:46.286611 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m17:56:46.769267 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:94ef8e78-f5fa-4141-b347-f6374b345fbd&page=queryresults
[0m17:56:48.300148 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73116fb8-6451-4e83-9b5d-a427c9ed95e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24AEF7410>]}
[0m17:56:48.300937 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts.looker_orders .......................... [[32mCREATE TABLE (2.6k rows, 114.4 KiB processed)[0m in 2.05s]
[0m17:56:48.301733 [debug] [Thread-1 (]: Finished running node model.astrafy_project.looker_orders
[0m17:56:48.303212 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:56:48.304424 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:56:48.304658 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m17:56:48.304850 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m17:56:48.305021 [debug] [MainThread]: Connection 'model.astrafy_project.looker_orders' was properly closed.
[0m17:56:48.305223 [info ] [MainThread]: 
[0m17:56:48.305641 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.66 seconds (2.66s).
[0m17:56:48.306342 [debug] [MainThread]: Command end result
[0m17:56:48.324758 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:56:48.327699 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:56:48.333475 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m17:56:48.333776 [info ] [MainThread]: 
[0m17:56:48.334372 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:56:48.334759 [info ] [MainThread]: 
[0m17:56:48.335089 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:56:48.335897 [debug] [MainThread]: Command `dbt run` succeeded at 17:56:48.335794 after 5.67 seconds
[0m17:56:48.336190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24AF6B800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24B56A710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B24B56A8F0>]}
[0m17:56:48.336485 [debug] [MainThread]: Flushing usage events
[0m17:56:48.832042 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:58:01.594257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020EE1DF2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020EDFC5C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020EE3F53ED0>]}


============================== 17:58:01.597799 | e4c5a1b5-2e27-4ecc-9aef-2d404bf38540 ==============================
[0m17:58:01.597799 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:58:01.598379 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select looker_orders', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:58:03.942108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020EE22D1A70>]}
[0m17:58:03.995378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E8F9A97B0>]}
[0m17:58:03.996328 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:58:04.511885 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:58:04.644162 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:58:04.644551 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:58:04.674589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E8FE3D650>]}
[0m17:58:04.735763 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:58:04.738201 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:58:04.757827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E8F993980>]}
[0m17:58:04.758271 [info ] [MainThread]: Found 8 models, 2 sources, 493 macros
[0m17:58:04.758809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E8FAFD010>]}
[0m17:58:04.760754 [info ] [MainThread]: 
[0m17:58:04.761317 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:58:04.761619 [info ] [MainThread]: 
[0m17:58:04.762068 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:58:04.762973 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m17:58:04.763297 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:58:05.109910 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m17:58:05.110342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:58:05.327365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E90008AE0>]}
[0m17:58:05.327780 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:58:05.332415 [debug] [Thread-1 (]: Began running node model.astrafy_project.looker_orders
[0m17:58:05.332983 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.looker_orders ............................... [RUN]
[0m17:58:05.333521 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.looker_orders'
[0m17:58:05.333792 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.looker_orders
[0m17:58:05.341504 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.looker_orders"
[0m17:58:05.342459 [debug] [Thread-1 (]: Began executing node model.astrafy_project.looker_orders
[0m17:58:05.354166 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m17:58:05.596475 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.looker_orders"
[0m17:58:05.597804 [debug] [Thread-1 (]: On model.astrafy_project.looker_orders: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.looker_orders"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`looker_orders`
      
    
    

    OPTIONS()
    as (
      -- The tables in the folder "lookertables" are used to create Looker views that consolidate the results of the SQL queries in the "marts" folder.
-- This table pulls data from the table "orders_recrutment" provided in the assignment, with the addition of the segmentation column.



WITH orders AS (
    SELECT
        date_date,
        customers_id,
        orders_id,
        net_sales,
        COUNT(*) OVER (
            PARTITION BY customers_id
            ORDER BY date_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
        ) AS previous_orders
    FROM 
        `astrafy-464919`.`raw`.`orders_recrutement`
)

SELECT
    date_date,
    customers_id,
    orders_id,
    net_sales,
    CASE
        WHEN previous_orders = 0 THEN 'New'
        WHEN previous_orders BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders >= 4 THEN 'VIP'
        ELSE 'Unknown' --shouldn't happen, but good to have a fallback
    END AS order_segmentation
FROM orders
    );
  
[0m17:58:05.822781 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:564bc8cf-e8f0-43d8-854c-a7d0b2c1213b&page=queryresults
[0m17:58:07.644832 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4c5a1b5-2e27-4ecc-9aef-2d404bf38540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E8FFD7590>]}
[0m17:58:07.645551 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts.looker_orders .......................... [[32mCREATE TABLE (3.7k rows, 114.4 KiB processed)[0m in 2.31s]
[0m17:58:07.646569 [debug] [Thread-1 (]: Finished running node model.astrafy_project.looker_orders
[0m17:58:07.648191 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:58:07.649597 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:58:07.649876 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m17:58:07.650070 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m17:58:07.650302 [debug] [MainThread]: Connection 'model.astrafy_project.looker_orders' was properly closed.
[0m17:58:07.650623 [info ] [MainThread]: 
[0m17:58:07.651088 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.89 seconds (2.89s).
[0m17:58:07.651848 [debug] [MainThread]: Command end result
[0m17:58:07.668522 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m17:58:07.671188 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m17:58:07.676712 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m17:58:07.677027 [info ] [MainThread]: 
[0m17:58:07.677499 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:58:07.677856 [info ] [MainThread]: 
[0m17:58:07.678199 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:58:07.679021 [debug] [MainThread]: Command `dbt run` succeeded at 17:58:07.678923 after 6.19 seconds
[0m17:58:07.679311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E9004B8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E9064ADF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020E9064AE90>]}
[0m17:58:07.679585 [debug] [MainThread]: Flushing usage events
[0m17:58:08.103720 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:11:11.417774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8263E2510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D82424C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D828543ED0>]}


============================== 18:11:11.421367 | 615934d4-e42f-4477-a648-d27b7d78d250 ==============================
[0m18:11:11.421367 [info ] [MainThread]: Running with dbt=1.10.3
[0m18:11:11.421932 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select looker_sales', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:11:13.734458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8268CDA70>]}
[0m18:11:13.786050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D853F597B0>]}
[0m18:11:13.786676 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m18:11:14.231558 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m18:11:14.352944 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:11:14.353285 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:11:14.381499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8543F1750>]}
[0m18:11:14.438863 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m18:11:14.441120 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m18:11:14.460606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D853F43980>]}
[0m18:11:14.461063 [info ] [MainThread]: Found 8 models, 2 sources, 493 macros
[0m18:11:14.461692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8540AD010>]}
[0m18:11:14.462999 [info ] [MainThread]: 
[0m18:11:14.463612 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:11:14.464144 [info ] [MainThread]: 
[0m18:11:14.464751 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:11:14.465865 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m18:11:14.466140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:11:14.866485 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m18:11:14.866967 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:11:15.108452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8545B8AE0>]}
[0m18:11:15.108871 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:11:15.113863 [debug] [Thread-1 (]: Began running node model.astrafy_project.looker_sales
[0m18:11:15.114400 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.looker_sales ................................ [RUN]
[0m18:11:15.115090 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.looker_sales'
[0m18:11:15.115405 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.looker_sales
[0m18:11:15.123088 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.looker_sales"
[0m18:11:15.124201 [debug] [Thread-1 (]: Began executing node model.astrafy_project.looker_sales
[0m18:11:15.156464 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.looker_sales"
[0m18:11:15.157589 [debug] [Thread-1 (]: On model.astrafy_project.looker_sales: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.looker_sales"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`looker_sales`
      
    
    

    OPTIONS()
    as (
      -- The tables in the folder "lookertables" are used to create Looker views that consolidate the results of the SQL queries in the "marts" folder.
-- This table pulls data from the table "sales_recrutment" provided in the assignment, with the addition of the segmentation column.



SELECT
    date_date,
    customer_id
    order_id,
    products_id,
    net_sales,
    qty,
    SUM(qty) OVER (PARTITION BY order_id, customer_id) AS total_order_qty
FROM
    `astrafy-464919`.`raw`.`sales_recrutement`
    );
  
[0m18:11:15.158008 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m18:11:15.610536 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:ea09f34c-b8f6-494b-89e1-b6e1cd7e874c&page=queryresults
[0m18:11:17.066271 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '615934d4-e42f-4477-a648-d27b7d78d250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D854587410>]}
[0m18:11:17.066875 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts.looker_sales ........................... [[32mCREATE TABLE (28.4k rows, 1.3 MiB processed)[0m in 1.95s]
[0m18:11:17.067633 [debug] [Thread-1 (]: Finished running node model.astrafy_project.looker_sales
[0m18:11:17.068908 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:11:17.070536 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:11:17.070751 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m18:11:17.070934 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m18:11:17.071103 [debug] [MainThread]: Connection 'model.astrafy_project.looker_sales' was properly closed.
[0m18:11:17.071327 [info ] [MainThread]: 
[0m18:11:17.071738 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.61 seconds (2.61s).
[0m18:11:17.072293 [debug] [MainThread]: Command end result
[0m18:11:17.090187 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m18:11:17.092433 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m18:11:17.097884 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m18:11:17.098271 [info ] [MainThread]: 
[0m18:11:17.098792 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:11:17.099194 [info ] [MainThread]: 
[0m18:11:17.099601 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m18:11:17.100847 [debug] [MainThread]: Command `dbt run` succeeded at 18:11:17.100689 after 5.80 seconds
[0m18:11:17.101225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8545FB800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D854BF6490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D854BF6670>]}
[0m18:11:17.101585 [debug] [MainThread]: Flushing usage events
[0m18:11:17.506999 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:13:50.565558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864A122510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018647F9C910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864C283ED0>]}


============================== 18:13:50.569153 | 9c8924ac-98b9-436c-b841-069ce4d04297 ==============================
[0m18:13:50.569153 [info ] [MainThread]: Running with dbt=1.10.3
[0m18:13:50.569815 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select looker_sales', 'send_anonymous_usage_stats': 'True'}
[0m18:13:52.817172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001864A60DA70>]}
[0m18:13:52.867338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018677C997B0>]}
[0m18:13:52.868010 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m18:13:53.328930 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m18:13:53.451447 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:13:53.451851 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:13:53.481280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001867812D750>]}
[0m18:13:53.541041 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m18:13:53.543353 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m18:13:53.566807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018677C83980>]}
[0m18:13:53.567383 [info ] [MainThread]: Found 8 models, 2 sources, 493 macros
[0m18:13:53.568183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018677DED010>]}
[0m18:13:53.569586 [info ] [MainThread]: 
[0m18:13:53.569978 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:13:53.570294 [info ] [MainThread]: 
[0m18:13:53.570878 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:13:53.572007 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919'
[0m18:13:53.572534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:13:53.974381 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_astrafy-464919_marts'
[0m18:13:53.974786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:13:54.214281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000186782F8AE0>]}
[0m18:13:54.214810 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:13:54.219268 [debug] [Thread-1 (]: Began running node model.astrafy_project.looker_sales
[0m18:13:54.219784 [info ] [Thread-1 (]: 1 of 1 START sql table model marts.looker_sales ................................ [RUN]
[0m18:13:54.220587 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.astrafy_project.looker_sales'
[0m18:13:54.221113 [debug] [Thread-1 (]: Began compiling node model.astrafy_project.looker_sales
[0m18:13:54.228542 [debug] [Thread-1 (]: Writing injected SQL for node "model.astrafy_project.looker_sales"
[0m18:13:54.229477 [debug] [Thread-1 (]: Began executing node model.astrafy_project.looker_sales
[0m18:13:54.241052 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m18:13:54.475483 [debug] [Thread-1 (]: Writing runtime sql for node "model.astrafy_project.looker_sales"
[0m18:13:54.476583 [debug] [Thread-1 (]: On model.astrafy_project.looker_sales: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "astrafy_project", "target_name": "dev", "node_id": "model.astrafy_project.looker_sales"} */

  
    

    create or replace table `astrafy-464919`.`marts`.`looker_sales`
      
    
    

    OPTIONS()
    as (
      -- The tables in the folder "lookertables" are used to create Looker views that consolidate the results of the SQL queries in the "marts" folder.
-- This table pulls data from the table "sales_recrutment" provided in the assignment, with the addition of the segmentation column.



SELECT
    date_date,
    customer_id,
    order_id,
    products_id,
    net_sales,
    qty,
    SUM(qty) OVER (PARTITION BY order_id, customer_id) AS total_order_qty
FROM
    `astrafy-464919`.`raw`.`sales_recrutement`
    );
  
[0m18:13:54.786211 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=astrafy-464919&j=bq:europe-southwest1:b1a0c534-2cfd-49f1-8ab6-e210d524b5c1&page=queryresults
[0m18:13:56.223525 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c8924ac-98b9-436c-b841-069ce4d04297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000186782C7590>]}
[0m18:13:56.224114 [info ] [Thread-1 (]: 1 of 1 OK created sql table model marts.looker_sales ........................... [[32mCREATE TABLE (28.4k rows, 1.3 MiB processed)[0m in 2.00s]
[0m18:13:56.224866 [debug] [Thread-1 (]: Finished running node model.astrafy_project.looker_sales
[0m18:13:56.226518 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:13:56.227810 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:13:56.228044 [debug] [MainThread]: Connection 'list_astrafy-464919' was properly closed.
[0m18:13:56.228239 [debug] [MainThread]: Connection 'list_astrafy-464919_marts' was properly closed.
[0m18:13:56.228416 [debug] [MainThread]: Connection 'model.astrafy_project.looker_sales' was properly closed.
[0m18:13:56.228616 [info ] [MainThread]: 
[0m18:13:56.229315 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.66 seconds (2.66s).
[0m18:13:56.230252 [debug] [MainThread]: Command end result
[0m18:13:56.248418 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\manifest.json
[0m18:13:56.250688 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\semantic_manifest.json
[0m18:13:56.255846 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\micha\OneDrive\Desktop\Astrafy\DBT\astrafy_project\target\run_results.json
[0m18:13:56.256182 [info ] [MainThread]: 
[0m18:13:56.256654 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:13:56.257069 [info ] [MainThread]: 
[0m18:13:56.257465 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m18:13:56.258341 [debug] [MainThread]: Command `dbt run` succeeded at 18:13:56.258223 after 5.81 seconds
[0m18:13:56.258653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001867833B8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001867893AB70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001867893AC10>]}
[0m18:13:56.259047 [debug] [MainThread]: Flushing usage events
[0m18:13:56.669897 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:52:25.402794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002274FF6E3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002274DDDCA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022750ACC050>]}


============================== 19:52:25.410279 | ca28735c-a173-4e5d-aba8-3222efc00a92 ==============================
[0m19:52:25.410279 [info ] [MainThread]: Running with dbt=1.10.3
[0m19:52:25.411468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt ', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:52:25.673110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca28735c-a173-4e5d-aba8-3222efc00a92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002275046D940>]}
[0m19:52:25.718972 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:52:25.722982 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:52:25.725986 [debug] [MainThread]: Command `cli deps` succeeded at 19:52:25.725707 after 0.54 seconds
[0m19:52:25.726607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022750F7FAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022750F7F8A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022750F9A050>]}
[0m19:52:25.727161 [debug] [MainThread]: Flushing usage events
[0m19:52:26.163558 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:45:35.832905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9DC4E3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9BAACA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9E7AC050>]}


============================== 21:45:35.836446 | c834b3af-4fa2-4dbb-b29e-4a599dc97eb5 ==============================
[0m21:45:35.836446 [info ] [MainThread]: Running with dbt=1.10.3
[0m21:45:35.836993 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt ', 'send_anonymous_usage_stats': 'True'}
[0m21:45:35.959448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c834b3af-4fa2-4dbb-b29e-4a599dc97eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9E149940>]}
[0m21:45:35.980184 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m21:45:35.981891 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m21:45:35.982975 [debug] [MainThread]: Command `cli deps` succeeded at 21:45:35.982852 after 0.26 seconds
[0m21:45:35.983306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9EC5FAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9EC5F8A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022A9EC7A050>]}
[0m21:45:35.983634 [debug] [MainThread]: Flushing usage events
[0m21:45:36.371249 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:29:43.536108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BBFF23C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293B9E4CA50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BCB4C050>]}


============================== 09:29:43.540176 | 55a0b0a2-cf86-4cd2-baf8-ee2bd064b495 ==============================
[0m09:29:43.540176 [info ] [MainThread]: Running with dbt=1.10.3
[0m09:29:43.540714 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'c:\\Users\\micha\\OneDrive\\Desktop\\Astrafy\\DBT\\astrafy_project\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\micha\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt ', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:29:43.672142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55a0b0a2-cf86-4cd2-baf8-ee2bd064b495', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BC4DD940>]}
[0m09:29:43.696052 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:29:43.697491 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m09:29:43.699092 [debug] [MainThread]: Command `cli deps` succeeded at 09:29:43.698896 after 0.27 seconds
[0m09:29:43.699791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BCFFFAC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BCFFF8A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000293BD01A050>]}
[0m09:29:43.700240 [debug] [MainThread]: Flushing usage events
[0m09:29:44.201389 [debug] [MainThread]: An error was encountered while trying to flush usage events
